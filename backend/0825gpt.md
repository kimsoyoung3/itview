List<VideoDTO> findByContentId(@Param("contentId") Integer contentId); 와
Optional<VideoEntity> findByContentId(Integer contentId); 차이점과 해석


요약 비교표
항목	List<VideoDTO> findByContentId(...)	Optional<VideoEntity> findByContentId(...)
반환 타입	List<VideoDTO>	Optional<VideoEntity>
조회 수	여러 개 (0개 이상)	하나만 (0 또는 1개)
DTO 변환 여부	이미 DTO 상태로 반환	Entity 그대로 반환
사용 용도	콘텐츠에 영상 여러 개 있는 경우	콘텐츠당 영상 하나만 있는 경우
JPA에서 메서드 작성 방법	JPQL/Native Query 필요 (@Query)	Spring Data JPA 메서드 쿼리로 가능
Null 처리 방식	비어 있는 리스트 ([])	Optional.empty() 또는 Optional.of(...)
✅ 각각의 예시와 해석
🔹 1. List<VideoDTO> findByContentId(...)
@Query("SELECT new com.example.VideoDTO(v) FROM VideoEntity v WHERE v.content.id = :contentId")
List<VideoDTO> findByContentId(@Param("contentId") Integer contentId);


✅ 설명:

이 메서드는 contentId로 해당 콘텐츠에 연결된 모든 영상(Video) 을 조회합니다.

결과는 VideoDTO 리스트로 반환됩니다.

영상이 없으면 [] 빈 리스트를 반환함.

✅ 사용 예시:

List<VideoDTO> videos = videoRepository.findByContentId(10);
if (videos.isEmpty()) {
System.out.println("영상이 없습니다.");
}


✅ 언제 사용?

콘텐츠 1개에 영상이 여러 개일 수 있을 때 (예: 강의 영상 목록)

프론트에 목록으로 보여줄 때

🔹 2. Optional<VideoEntity> findByContentId(...)
Optional<VideoEntity> findByContentId(Integer contentId);


✅ 설명:

Spring Data JPA의 네이밍 규칙을 따른 메서드로,

VideoEntity에서 content.id가 contentId인 영상 하나만 찾아옵니다.

결과가 없으면 Optional.empty()로, 있으면 Optional.of(entity)로 감싸서 반환.

✅ 사용 예시:

Optional<VideoEntity> videoOpt = videoRepository.findByContentId(10);
videoOpt.ifPresentOrElse(
video -> System.out.println("제목: " + video.getTitle()),
() -> System.out.println("영상 없음")
);


✅ 언제 사용?

콘텐츠마다 영상이 1:1 관계일 때

단일 등록/수정/삭제 화면에서 활용할 때

→ 현재 당신 프로젝트 상황에 적합!

✅ 결론: 당신의 경우 어떤 걸 써야 하나?

현재 코드 흐름을 보면:

콘텐츠 1건에 영상은 1개만 등록/수정/삭제 가능한 구조이므로
✅ Optional<VideoEntity> findByContentId(...) 가 맞습니다.

단일 영상 등록 폼에서 List<VideoDTO>로 받으면 오히려 복잡해지고 예외 발생 가능성 증가합니다.

필요하시면 두 메서드 모두 정의해서,

단일 영상 등록/수정에는 Optional<VideoEntity> findByContentId(...)를

영상 목록 페이지에는 List<VideoDTO> findByContentId(...)를

분리 사용할 수도 있어요 =====================================================================================================
///////////////////////////////
1. Controller (ContentController 의 장르 폼 메서드)

현재 showGenreForm 메서드는 선택된 장르를
List<String> (영문 이름) 으로 넘기고 있습니다.

수정 전
@GetMapping("/content/{contentId}/genre")
public String showGenreForm(@PathVariable Integer contentId, Model model) {
ContentCreateDTO contentDTO = contentService.read(contentId);
List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
List<String> selectedGenreNames = selectedGenres.stream()
.map(Enum::name)
.toList();

    model.addAttribute("contentDTO", contentDTO);
    model.addAttribute("contentId", contentId);
    model.addAttribute("allGenres", Genre.values());
    model.addAttribute("selectedGenres", selectedGenreNames);  // String 리스트
    model.addAttribute("genreTranslations", genreTranslations);

    return "content/genreForm";
}

수정 포인트

selectedGenres 를 문자열 리스트로 보낼 수도 있지만, 뷰에서 체크박스의 checked 여부를 쉽게 하려면 Enum 리스트로 보내는 것이 더 편합니다.

또는 HTML에서 문자열로 받고 비교할 때 문자열 비교로 해야 합니다.

방법 1) Enum 리스트를 그대로 전달

model.addAttribute("selectedGenres", selectedGenres); // Enum 리스트 그대로


방법 2) 문자열 리스트 전달 시 Thymeleaf에서 문자열 비교

2. View (genreForm.html)
   수정 전 (일부 발췌)
<div th:each="genre : ${allGenres}" class="form-check">
  <input class="form-check-input" type="checkbox" name="genres" 
         th:id="${'genre-' + genre.name()}" 
         th:value="${genre.name()}" 
         th:checked="${selectedGenres != null} ? ${selectedGenres.contains(genre)} : false">
  <label class="form-check-label" th:for="${'genre-' + genre.name()}" th:text="${genre.name()}">장르명</label>
</div>

<div class="mt-4">
  <h4>선택된 장르:</h4>
  <ul>
    <li th:each="genre : ${selectedGenres}" th:text="${genre.name()}"></li>
  </ul>
</div>

문제점

th:checked 부분에서 selectedGenres.contains(genre) 는 selectedGenres가 문자열 리스트면 Genre 타입과 비교 불일치.

선택된 장르 목록 표시 <li> 에서도 genre가 문자열이면 genre.name() 호출 시 오류 발생.

수정 방법

만약 selectedGenres가 Enum 리스트라면 다음과 같이:

<input class="form-check-input" type="checkbox" name="genres"
th:id="${'genre-' + genre.name()}"
th:value="${genre.name()}"
th:checked="${selectedGenres != null} ? ${selectedGenres.contains(genre)} : false">
<label class="form-check-label" th:for="${'genre-' + genre.name()}" th:text="${genreTranslations[genre.name()]}"></label>


선택된 장르 리스트 출력:

<ul>
  <li th:each="genre : ${selectedGenres}" th:text="${genreTranslations[genre.name()]}"></li>
</ul>


만약 selectedGenres가 문자열 리스트라면 체크박스의 checked 조건을 이렇게 수정:

th:checked="${selectedGenres != null} ? ${selectedGenres.contains(genre.name())} : false"


출력할 때도 문자열이므로 바로 출력 가능:

<ul>
  <li th:each="genre : ${selectedGenres}" th:text="${genreTranslations[genre]}"></li>
</ul>

정리
구분	수정 전	수정 후
Controller	model.addAttribute("selectedGenres", selectedGenreNames); (문자열 리스트)	model.addAttribute("selectedGenres", selectedGenres); (Enum 리스트) 혹은 그대로 문자열 리스트 사용
genreForm.html (체크박스)	th:checked="${selectedGenres.contains(genre)}" (Enum과 비교)	<ul><li>Enum 리스트면: th:checked="${selectedGenres.contains(genre)}"</li><li>문자열 리스트면: th:checked="${selectedGenres.contains(genre.name())}"</li></ul>
genreForm.html (선택된 장르 목록 출력)	<li th:text="${genre.name()}"> (Enum으로 가정)	<ul><li>Enum이면: <li th:text="${genreTranslations[genre.name()]}"></li><li>문자열이면: <li th:text="${genreTranslations[genre]}"></li></ul>
예시 코드 (Controller + HTML)
Controller (Enum 리스트 사용)
@GetMapping("/content/{contentId}/genre")
public String showGenreForm(@PathVariable Integer contentId, Model model) {
ContentCreateDTO contentDTO = contentService.read(contentId);
List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);

    Map<String, String> genreTranslations = Map.ofEntries(
        Map.entry("ACTION", "액션"),
        Map.entry("DRAMA", "드라마"),
        Map.entry("ROMANCE", "로맨스")
        // 생략
    );

    model.addAttribute("contentDTO", contentDTO);
    model.addAttribute("contentId", contentId);
    model.addAttribute("allGenres", Genre.values());
    model.addAttribute("selectedGenres", selectedGenres);
    model.addAttribute("genreTranslations", genreTranslations);

    return "content/genreForm";
}

genreForm.html (Thymeleaf)
<div th:each="genre : ${allGenres}" class="form-check">
  <input class="form-check-input" type="checkbox" name="genres"
         th:id="${'genre-' + genre.name()}"
         th:value="${genre.name()}"
         th:checked="${selectedGenres != null} ? ${selectedGenres.contains(genre)} : false" />
  <label class="form-check-label" th:for="${'genre-' + genre.name()}" th:text="${genreTranslations[genre.name()]}"></label>
</div>

<div class="mt-4">
  <h4>선택된 장르:</h4>
  <ul>
    <li th:each="genre : ${selectedGenres}" th:text="${genreTranslations[genre.name()]}"></li>
  </ul>
</div>