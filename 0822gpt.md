ì½˜í…ì¸ ë¡œ ê±´ë„ˆë›°ê¸°
ë‚˜ì˜ ë§:
public ContentDetailDTO getContentDetail(Integer contentId) {
ContentDetailDTO contentDetail = new ContentDetailDTO();

        // ì»¨í…ì¸  ì •ë³´ ì¡°íšŒ
        ContentResponseDTO contentResponseDTO = contentRepository.findContentWithAvgRating(contentId);
        // ì»¨í…ì¸  ì¥ë¥´ ì¡°íšŒ
        List<GenreDTO> genres = contentGenreRepository.findByContentId(contentId);
        genres.forEach(genre -> {
            contentResponseDTO.getGenres().add(genre.getGenre().getGenreName());
        });
        contentDetail.setContentInfo(contentResponseDTO);

        // ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì¡°íšŒ
        List<ImageDTO> images = galleryRepository.findByContentId(contentId);
        contentDetail.setGallery(images);

        // ë™ì˜ìƒ ì¡°íšŒ
        List<VideoDTO> videos = videoRepository.findByContentId(contentId);
        contentDetail.setVideos(videos);

        // ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¡°íšŒ
        List<ExternalServiceDTO> externalServices = externalServiceRepository.findByContentId(contentId);
        contentDetail.setExternalServices(externalServices);

        return contentDetail;
    } í•´ì„ í•´ì¤˜
ChatGPTì˜ ë§:
ì´ Java ë©”ì„œë“œëŠ” íŠ¹ì • ì½˜í…ì¸  IDì— ëŒ€í•œ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ , ê·¸ ì •ë³´ë¥¼ ContentDetailDTO ê°ì²´ë¡œ ë°˜í™˜í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤. ì „ì²´ì ìœ¼ë¡œëŠ” ì—¬ëŸ¬ ì €ì¥ì†Œ(repository)ë¥¼ í†µí•´ ì½˜í…ì¸ ì™€ ê´€ë ¨ëœ ì •ë³´ë“¤ì„ ëª¨ì•„ì„œ í•˜ë‚˜ì˜ DTOë¡œ êµ¬ì„±í•˜ëŠ” ì‘ì—…ì„ í•©ë‹ˆë‹¤. ê° ì¤„ì„ ìì„¸íˆ í•´ì„í•´ë“œë¦´ê²Œìš”.

ğŸ” ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜
public ContentDetailDTO getContentDetail(Integer contentId)
contentId: ì¡°íšŒí•˜ê³ ì í•˜ëŠ” ì½˜í…ì¸ ì˜ ê³ ìœ  ID

ë°˜í™˜ íƒ€ì…ì€ ContentDetailDTO: ì½˜í…ì¸ ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë‹´ëŠ” DTO í´ë˜ìŠ¤

ğŸ“¦ ê°ì²´ ìƒì„±
ContentDetailDTO contentDetail = new ContentDetailDTO();
ìµœì¢…ì ìœ¼ë¡œ ì •ë³´ë¥¼ ë‹´ì•„ ë°˜í™˜í•  ê°ì²´ë¥¼ ìƒì„±

1. ğŸ“„ ì½˜í…ì¸  ì •ë³´ + í‰ê·  í‰ì  ì¡°íšŒ
   ContentResponseDTO contentResponseDTO = contentRepository.findContentWithAvgRating(contentId);
   contentIdì— í•´ë‹¹í•˜ëŠ” ì½˜í…ì¸  ì •ë³´ë¥¼ ì¡°íšŒ

í‰ê·  í‰ì  ì •ë³´ë„ í•¨ê»˜ ì¡°íšŒ (findContentWithAvgRating ë¼ëŠ” ì´ë¦„ì—ì„œ ì¶”ì •ë¨)

2. ğŸ­ ì½˜í…ì¸  ì¥ë¥´ ì¡°íšŒ ë° ì¶”ê°€
   List<GenreDTO> genres = contentGenreRepository.findByContentId(contentId);
   genres.forEach(genre -> {
   contentResponseDTO.getGenres().add(genre.getGenre().getGenreName());
   });
   í•´ë‹¹ ì½˜í…ì¸ ê°€ ê°€ì§„ ì¥ë¥´ ëª©ë¡ì„ ê°€ì ¸ì˜´

ê°ê°ì˜ ì¥ë¥´ ì´ë¦„ì„ contentResponseDTOì˜ genres ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€

3. ğŸ“· ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì¡°íšŒ
   List<ImageDTO> images = galleryRepository.findByContentId(contentId);
   contentDetail.setGallery(images);
   ì½˜í…ì¸ ì— ì—°ê´€ëœ ì´ë¯¸ì§€ë“¤ì„ ì¡°íšŒí•˜ê³  contentDetail ê°ì²´ì— ì„¤ì •

4. ğŸ¥ ë™ì˜ìƒ ì¡°íšŒ
   List<VideoDTO> videos = videoRepository.findByContentId(contentId);
   contentDetail.setVideos(videos);
   ì½˜í…ì¸ ì— ì—°ê´€ëœ ë™ì˜ìƒë“¤ì„ ì¡°íšŒí•˜ê³  contentDetail ê°ì²´ì— ì„¤ì •

5. ğŸŒ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¡°íšŒ
   List<ExternalServiceDTO> externalServices = externalServiceRepository.findByContentId(contentId);
   contentDetail.setExternalServices(externalServices);
   ì½˜í…ì¸ ì™€ ì—°ê²°ëœ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì •ë³´ ì¡°íšŒ í›„ ì„¤ì •

âœ… ìµœì¢… ê²°ê³¼ ë°˜í™˜
return contentDetail;
ëª¨ë“  ì •ë³´ë¥¼ ë‹´ì€ ContentDetailDTO ê°ì²´ë¥¼ ë°˜í™˜

ğŸ§¾ ìš”ì•½
ì´ ë©”ì„œë“œëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ ì¢…í•©í•´ì„œ í•˜ë‚˜ì˜ DTOì— ë‹´ì•„ ë°˜í™˜í•©ë‹ˆë‹¤:

í•­ëª©	ì„¤ëª…
ì½˜í…ì¸  ê¸°ë³¸ ì •ë³´	ì´ë¦„, ì„¤ëª…, í‰ê·  í‰ì  ë“±
ì¥ë¥´	ì½˜í…ì¸ ì— ì—°ê²°ëœ ì¥ë¥´ëª…
ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€	ì½˜í…ì¸ ì˜ ì´ë¯¸ì§€ ëª©ë¡
ë™ì˜ìƒ	ì½˜í…ì¸  ê´€ë ¨ ì˜ìƒ ë¦¬ìŠ¤íŠ¸
ì™¸ë¶€ ì„œë¹„ìŠ¤	ë„·í”Œë¦­ìŠ¤, ì™“ì±  ë“± ì™¸ë¶€ í”Œë«í¼ ì •ë³´ ë“±
í•„ìš”í•˜ì‹œë©´ ì´ êµ¬ì¡°ë¥¼ ë„ì‹í™”í•´ ë“œë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë‚˜ì˜ ë§:
êµ¬ì¡°ë¥¼ ë„ì‹í™”
ChatGPTì˜ ë§:
ì•„ë˜ëŠ” í•´ë‹¹ ë©”ì„œë“œê°€ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ContentDetailDTOì— ì–´ë–»ê²Œ êµ¬ì„±í•˜ëŠ”ì§€ ë„ì‹í™”í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.

ğŸ“¦ ContentDetailDTO êµ¬ì¡° (ìµœì¢… ë°˜í™˜ ê°ì²´)
ContentDetailDTO
â”‚
â”œâ”€â”€ contentInfo: ContentResponseDTO
â”‚   â”œâ”€â”€ title
â”‚   â”œâ”€â”€ description
â”‚   â”œâ”€â”€ avgRating
â”‚   â””â”€â”€ genres: List<String>
â”‚         â””â”€â”€ [ "ë“œë¼ë§ˆ", "ì•¡ì…˜", "SF", ... ] â† ì½˜í…ì¸  ì¥ë¥´ ì´ë¦„ ëª©ë¡
â”‚
â”œâ”€â”€ gallery: List<ImageDTO>
â”‚     â””â”€â”€ [ ì´ë¯¸ì§€1, ì´ë¯¸ì§€2, ... ]
â”‚
â”œâ”€â”€ videos: List<VideoDTO>
â”‚     â””â”€â”€ [ ì˜ìƒ1, ì˜ìƒ2, ... ]
â”‚
â””â”€â”€ externalServices: List<ExternalServiceDTO>
â””â”€â”€ [ ì„œë¹„ìŠ¤1, ì„œë¹„ìŠ¤2, ... ]
ğŸ”„ ë°ì´í„° íë¦„ë„
contentId
â”‚
â–¼
contentRepository.findContentWithAvgRating(contentId)
â””â”€â”€> ContentResponseDTO â† ì½˜í…ì¸  ê¸°ë³¸ ì •ë³´ + í‰ê·  í‰ì 
(ì´ˆê¸°í™”ëœ genres ë¦¬ìŠ¤íŠ¸ í¬í•¨)
â”‚
â–¼
contentGenreRepository.findByContentId(contentId)
â””â”€â”€> List<GenreDTO>
â””â”€â”€> ê° GenreDTOì—ì„œ genreName ì¶”ì¶œí•˜ì—¬
ContentResponseDTO.genres ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
â”‚
â–¼
ContentDetailDTO.contentInfo = ContentResponseDTO
â”‚
â–¼
galleryRepository.findByContentId(contentId)
â””â”€â”€> List<ImageDTO>
â–¼
ContentDetailDTO.gallery = List<ImageDTO>
â”‚
â–¼
videoRepository.findByContentId(contentId)
â””â”€â”€> List<VideoDTO>
â–¼
ContentDetailDTO.videos = List<VideoDTO>
â”‚
â–¼
externalServiceRepository.findByContentId(contentId)
â””â”€â”€> List<ExternalServiceDTO>
â–¼
ContentDetailDTO.externalServices = List<ExternalServiceDTO>

â–¼
return ContentDetailDTO
ì´ êµ¬ì¡°ë¥¼ í†µí•´ í•œ ì½˜í…ì¸ ì— ëŒ€í•œ ëª¨ë“  ì—°ê´€ ì •ë³´ë¥¼ í†µí•©í•´ í•˜ë‚˜ì˜ DTOì— ë‹´ê³ , í”„ë¡ íŠ¸ì—”ë“œë‚˜ API í˜¸ì¶œìì—ê²Œ í’ë¶€í•œ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

í•„ìš”í•˜ë‹¤ë©´ ì´ê±¸ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ í˜•íƒœë¡œë„ ê·¸ë ¤ë“œë¦´ ìˆ˜ ìˆì–´ìš”.

ë‚˜ì˜ ë§:
êµ¬ì¡°ë¥¼ ë„ì‹í™”
ChatGPTì˜ ë§:
ì•Œê² ì–´ìš”! ì¢€ ë” ê¹”ë”í•œ ë„ì‹í™”(ë‹¤ì´ì–´ê·¸ë¨) í˜•íƒœë¡œ ë³´ì—¬ë“œë¦´ê²Œìš”.

ğŸ“Š ì½˜í…ì¸  ìƒì„¸ ì •ë³´ ë°ì´í„° íë¦„ë„
+------------------+
|   contentId (ì…ë ¥)   |
+---------+--------+
|
v
+------------------------------+
| contentRepository.findContentWithAvgRating(contentId) |
+------------------------------+
|
v
+---------------------+
| ContentResponseDTO   |
| - title             |
| - description       |
| - avgRating         |
| - genres (ë¹ˆ ë¦¬ìŠ¤íŠ¸) |
+---------------------+
|
v
+------------------------------+
| contentGenreRepository.findByContentId(contentId) |
+------------------------------+
|
v
+-----------------+
| List<GenreDTO>  |
| (ì¥ë¥´ ë¦¬ìŠ¤íŠ¸)    |
+-----------------+
|
ì¥ë¥´ ì´ë¦„ì„ ContentResponseDTO.genresì— ì¶”ê°€
|
v
+---------------------+
| ContentResponseDTO   |
| - genres (ì¥ë¥´ëª… í¬í•¨)|
+---------------------+
|
v
+---------------------+
| ContentDetailDTO     |
| - contentInfo       |
+---------------------+
|
v
+------------------------------+
| galleryRepository.findByContentId(contentId) |
+------------------------------+
|
v
+---------------------+
| List<ImageDTO>      |
+---------------------+
|
v
+---------------------+
| ContentDetailDTO     |
| - gallery           |
+---------------------+
|
v
+------------------------------+
| videoRepository.findByContentId(contentId) |
+------------------------------+
|
v
+---------------------+
| List<VideoDTO>      |
+---------------------+
|
v
+---------------------+
| ContentDetailDTO     |
| - videos            |
+---------------------+
|
v
+------------------------------+
| externalServiceRepository.findByContentId(contentId) |
+------------------------------+
|
v
+---------------------------+
| List<ExternalServiceDTO>  |
+---------------------------+
|
v
+---------------------+
| ContentDetailDTO     |
| - externalServices  |
+---------------------+
|
v
+---------------------+
|  ìµœì¢… ë°˜í™˜ (return)  |
+---------------------+
ì´ ê·¸ë¦¼ì€ ì½˜í…ì¸  IDë¥¼ ë°›ì•„ì„œ ì—¬ëŸ¬ ì €ì¥ì†Œ(repository)ì—ì„œ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ , ì´ ì •ë³´ë¥¼ ëª¨ì•„ì„œ ContentDetailDTO ê°ì²´ì— ì±„ì›Œ ìµœì¢… ë°˜í™˜í•˜ëŠ” íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

í•„ìš”í•˜ë©´ UML í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ë„ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”!

ë‚˜ì˜ ë§:
UML í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
ChatGPTì˜ ë§:
ì¢‹ì•„ìš”! ì•„ë˜ëŠ” ë©”ì„œë“œì—ì„œ ì‚¬ìš©ëœ ì£¼ìš” DTOë“¤ê³¼ ê·¸ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ UML í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.

+-----------------------+
|   ContentDetailDTO    |
+-----------------------+
| - contentInfo: ContentResponseDTO  |
| - gallery: List<ImageDTO>           |
| - videos: List<VideoDTO>            |
| - externalServices: List<ExternalServiceDTO> |
+-----------------------+

            1
            |
            |
            | 1
+--------------------------+
| ContentResponseDTO        |
+--------------------------+
| - title: String           |
| - description: String     |
| - avgRating: Float        |
| - genres: List<String>    |  <---------+
+--------------------------+            |
*|  
0..*                       +----------------+
+-----------------------+             |   GenreDTO     |
|      GenreDTO         |             +----------------+
+-----------------------+             | - genre: Genre |
| - genre: Genre         |             +----------------+
+-----------------------+
|
| 1
|
+-----------------------+
|       Genre           |
+-----------------------+
| - genreName: String   |
+-----------------------+

+-----------------------+
|      ImageDTO         |
+-----------------------+
| - imageUrl: String    |
| - description: String |
+-----------------------+

+-----------------------+
|      VideoDTO         |
+-----------------------+
| - videoUrl: String    |
| - title: String       |
+-----------------------+

+-----------------------------+
|   ExternalServiceDTO        |
+-----------------------------+
| - serviceName: String       |
| - serviceUrl: String        |
+-----------------------------+
ì„¤ëª…
ContentDetailDTO ê°€ ìµœìƒìœ„ ê°ì²´ë¡œ, ì—¬ëŸ¬ ë¦¬ìŠ¤íŠ¸ì™€ ìƒì„¸ ì½˜í…ì¸  ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ContentResponseDTO ëŠ” ì½˜í…ì¸ ì˜ ê¸°ë³¸ ì •ë³´ + ì¥ë¥´ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

ì¥ë¥´ëŠ” GenreDTO ì™€ Genre í´ë˜ìŠ¤ë¥¼ í†µí•´ ê´€ë¦¬ë˜ê³ , ìµœì¢…ì ìœ¼ë¡œ ì¥ë¥´ ì´ë¦„(genreName)ì´ ContentResponseDTOì˜ ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.

ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€(ImageDTO), ë™ì˜ìƒ(VideoDTO), ì™¸ë¶€ ì„œë¹„ìŠ¤(ExternalServiceDTO)ëŠ” ê°ê° ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ContentDetailDTOì— í¬í•¨ë©ë‹ˆë‹¤.

í•„ìš”í•˜ë©´ ì´ê±¸ ì‹œê°ì ì¸ UML ë‹¤ì´ì–´ê·¸ë¨ ì´ë¯¸ì§€ë¡œë„ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.Entity;

import lombok.Getter;
import lombok.Setter;

import java.time.LocalDateTime;
import java.util.List;

import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.EntityListeners;
import jakarta.persistence.FetchType;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import jakarta.persistence.OneToMany;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@EntityListeners(AuditingEntityListener.class)
public class CollectionEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    // ì»¬ë ‰ì…˜ ì†Œìœ ì
    @JoinColumn(name = "user_id", nullable = false)
    @ManyToOne(fetch = FetchType.LAZY)
    private UserEntity user;

    // ì»¬ë ‰ì…˜ ì´ë¦„
    @Column(nullable = false, length = 255)
    private String title;

    // ì»¬ë ‰ì…˜ ìƒì„± ì‹œê°„
    @CreatedDate
    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    // ì»¬ë ‰ì…˜ ìˆ˜ì • ì‹œê°„
    @LastModifiedDate
    @Column(nullable = false)
    private LocalDateTime updatedAt;

    // ì»¬ë ‰ì…˜ ì„¤ëª…
    @Column(length = 1024)
    private String description;

    // ì»¬ë ‰ì…˜ì˜ ì•„ì´í…œ
    @OneToMany(mappedBy = "collection", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CollectionItemEntity> items;
} ìˆ˜ì •í• ê³³ì€ ?
ChatGPTì˜ ë§:
ì „ì²´ì ìœ¼ë¡œ ì˜ ì‘ì„±ëœ JPA ì—”í‹°í‹°ì…ë‹ˆë‹¤!
ë‹¤ë§Œ, ëª‡ ê°€ì§€ ìµœì í™”ë‚˜ ê°œì„ í•  ë¶€ë¶„ ë° ì£¼ì˜í•´ì•¼ í•  ì ì„ ì§šì–´ë“œë¦´ê²Œìš”.

1. @EntityListenersì™€ Auditing ì„¤ì • ê´€ë ¨
   @EntityListeners(AuditingEntityListener.class) ë¥¼ ì¼ìœ¼ë©´, ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ JPA Auditing í™œì„±í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.
   ë³´í†µ @EnableJpaAuditingì„ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤ë‚˜ ì„¤ì • í´ë˜ìŠ¤ì— ë‹¬ì•„ì•¼ í•©ë‹ˆë‹¤.
   (ì´ê±´ ì½”ë“œê°€ ì•„ë‹ˆë¼ ì„¤ì • ì²´í¬ì‚¬í•­ì…ë‹ˆë‹¤.)

2. @ManyToOne(fetch = FetchType.LAZY)ì™€ @JoinColumn
   ì§€ê¸ˆì²˜ëŸ¼ @ManyToOne(fetch = FetchType.LAZY) ì„¤ì •ì€ ì¢‹ìŠµë‹ˆë‹¤.

ë‹¤ë§Œ nullable = false ë¥¼ @JoinColumnì— ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. í˜„ì¬ë„ ëª…ì‹œë˜ì–´ ìˆëŠ”ë°, @ManyToOneì—ë„ optional = falseë¥¼ ì¶”ê°€í•˜ë©´ JPAê°€ ì¢€ ë” ëª…í™•íˆ ì¸ì‹í•©ë‹ˆë‹¤.

@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "user_id", nullable = false)
private UserEntity user;
3. @OneToMany ë§¤í•‘
   mappedBy = "collection" ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì€ ë¶€ë¶„ì´ ë¬¸ì œ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ ë‘ë©´ ë©ë‹ˆë‹¤.

cascade = CascadeType.ALL, orphanRemoval = true ëŠ” ì»¬ë ‰ì…˜ ë‚´ ì•„ì´í…œ ìƒëª…ì£¼ê¸° ê´€ë¦¬ë¥¼ ì˜ ì²˜ë¦¬í•´ì¤˜ì„œ ì ì ˆí•´ ë³´ì…ë‹ˆë‹¤.

4. ìƒì„±/ìˆ˜ì • ë‚ ì§œ í•„ë“œ íƒ€ì…ê³¼ ê¸°ë³¸ê°’
   @CreatedDate, @LastModifiedDateëŠ” LocalDateTimeê³¼ ì˜ ë§ìŠµë‹ˆë‹¤.

ê·¼ë° ë°ì´í„°ë² ì´ìŠ¤ì— ë”°ë¼ TIMESTAMP íƒ€ì…ìœ¼ë¡œ ë§¤í•‘ë˜ëŠ”ì§€, í•„ìš”í•œ ê²½ìš° @Column(columnDefinition = "TIMESTAMP")ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒë„ ê³ ë ¤í•˜ì„¸ìš”. (í•„ìˆ˜ëŠ” ì•„ë‹˜)

5. ì¶”ê°€ ê¶Œì¥ì‚¬í•­: toString(), equals(), hashCode() ì²˜ë¦¬
   Lombokì„ ì“°ì…¨ìœ¼ë‹ˆ @ToString(exclude = "user"), @EqualsAndHashCode(exclude = "user") ê°™ì€ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë¬´í•œì°¸ì¡° ë°©ì§€ ê¶Œì¥í•©ë‹ˆë‹¤.

íŠ¹íˆ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—ì„œ toString í˜¸ì¶œ ì‹œ StackOverflowError ë°œìƒ ê°€ëŠ¥ì„± ìˆìŒ.

ì˜ˆì‹œ:

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@EntityListeners(AuditingEntityListener.class)
@ToString(exclude = "user")
@EqualsAndHashCode(exclude = "user")
public class CollectionEntity {
...
}
6. Optional: í•„ë“œ ì£¼ì„ í•œê¸€ â†’ ì˜ì–´ (íŒ€ í˜‘ì—… ì‹œ)
   ì½”ë“œ ì£¼ì„ì„ ì˜ì–´ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ê¸€ë¡œë²Œ ìŠ¤íƒ ë‹¤ë“œì— ë§ì¶° ì¶”ì²œë˜ê¸´ í•©ë‹ˆë‹¤.

(íŒ€ ë¬¸í™”ë‚˜ í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ)

ì •ë¦¬
@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "user_id", nullable = false)
private UserEntity user;
@ToString(exclude = "user")
@EqualsAndHashCode(exclude = "user")
JPA Auditing í™œì„±í™” ì—¬ë¶€ í™•ì¸(@EnableJpaAuditing)

í•„ìš” ì‹œ ë‚ ì§œ íƒ€ì… ì»¬ëŸ¼ ì •ì˜ í™•ì¸

í•„ìš”í•˜ë©´ UserEntityì™€ CollectionItemEntity ê´€ê³„ë„ ê°™ì´ ë´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê¶ê¸ˆí•œ ì  ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.Entity;

import lombok.Getter;
import lombok.Setter;

import java.util.List;

import com.example.itview_spring.Constant.Role;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.EnumType;
import jakarta.persistence.Enumerated;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToMany;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
public class UserEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    // ìœ ì € ì—­í•  (ì˜ˆ: ADMIN, USER ë“±)
    @Column(nullable = false, length = 255)
    @Enumerated(EnumType.STRING)
    private Role role;

    // ìœ ì € ë‹‰ë„¤ì„
    @Column(nullable = false, length = 255)
    private String nickname;

    // ìœ ì € ì´ë©”ì¼
    @Column(nullable = false, length = 255)
    private String email;

    // ìœ ì € ë¹„ë°€ë²ˆí˜¸
    @Column(nullable = false, length = 255)
    private String password;

    // ìœ ì € í”„ë¡œí•„ ì‚¬ì§„ ë§í¬
    @Column(length = 1024)
    private String profile;

    // ìœ ì € ì†Œê°œ
    @Column(length = 1024)
    private String introduction;

    // ìœ ì €ì˜ ì»¬ë ‰ì…˜ ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CollectionEntity> collections;

    // ìœ ì €ì˜ ì½”ë©˜íŠ¸ ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CommentEntity> comments;

    // ìœ ì €ì˜ í‰ì  ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<RatingEntity> ratings;

    // ìœ ì €ì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<WishlistEntity> wishlists;

    // ìœ ì €ì˜ ëŒ“ê¸€ ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ReplyEntity> replies;

    // ìœ ì €ì˜ ì¢‹ì•„ìš” ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<LikeEntity> likes;

    // ìœ ì €ì˜ ì´ë©”ì¼ ì¸ì¦ ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<EmailVerificationEntity> emailVerifications;

    // ìœ ì €ì˜ ì†Œì…œ ê³„ì • ëª©ë¡
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<SocialEntity> socials;
} ìˆ˜ì •í• ê³³ì€  
ChatGPTì˜ ë§:
ì˜ ì‘ì„±ëœ UserEntityì…ë‹ˆë‹¤!
ë‹¤ë§Œ, ë‹¤ìŒ ë¶€ë¶„ë“¤ì€ ê°œì„  ë˜ëŠ” ì£¼ì˜ê°€ í•„ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.

1. ì—°ê´€ê´€ê³„ì— ì˜í•œ ì„±ëŠ¥ ë¬¸ì œ ë° ë¬´í•œì°¸ì¡° ì£¼ì˜
   @OneToMany ê´€ê³„ê°€ ë§¤ìš° ë§ìŠµë‹ˆë‹¤. (9ê°œ ì´ìƒ)

ì´ëŸ° ë‹¤ìˆ˜ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì—”í‹°í‹° ë¡œë”© ì‹œ ì„±ëŠ¥ ì´ìŠˆë‚˜, JSON ì§ë ¬í™” ì‹œ ë¬´í•œì°¸ì¡°(StackOverflowError) ë¬¸ì œë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ê²°ì±…
ì§ë ¬í™” ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€

ì˜ˆë¥¼ ë“¤ì–´, Jackson ì‚¬ìš©í•  ê²½ìš° @JsonManagedReference / @JsonBackReference

í˜¹ì€ @JsonIgnoreë¥¼ í†µí•´ ì§ë ¬í™” ì œì™¸ ì²˜ë¦¬

Lombok @ToStringê³¼ @EqualsAndHashCodeì—ì„œ ì—°ê´€ê´€ê³„ í•„ë“œ ì œì™¸

ë¬´í•œì°¸ì¡° ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ ì˜ˆì‹œì²˜ëŸ¼ ì‚¬ìš©í•˜ì„¸ìš”:

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@ToString(exclude = {"collections", "comments", "ratings", "wishlists", "replies", "likes", "emailVerifications", "socials"})
@EqualsAndHashCode(exclude = {"collections", "comments", "ratings", "wishlists", "replies", "likes", "emailVerifications", "socials"})
public class UserEntity {
//...
}
2. ì—°ê´€ê´€ê³„ì˜ Fetch íƒ€ì… ì§€ì •
   ê¸°ë³¸ì ìœ¼ë¡œ @OneToManyëŠ” FetchType.LAZYê°€ ê¸°ë³¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

@OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
private List<CollectionEntity> collections;
// ë‚˜ë¨¸ì§€ë„ ë™ì¼í•˜ê²Œ
3. ì»¬ë ‰ì…˜ íƒ€ì… ì´ˆê¸°í™”
   ì»¬ë ‰ì…˜ í•„ë“œëŠ” ë³´í†µ nullì´ ì•„ë‹Œ ë¹ˆ ì»¬ë ‰ì…˜ìœ¼ë¡œ ì´ˆê¸°í™”í•´ë‘ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤. (ì˜ˆ: private List<CollectionEntity> collections = new ArrayList<>();)

ì´ ë°©ë²•ì€ NPE ë°©ì§€ì— ë„ì›€ë©ë‹ˆë‹¤.

4. í•„ë“œ ì£¼ì„ ì˜ì–´í™” (ì„ íƒì‚¬í•­)
   í˜‘ì—… ì‹œ ì˜ì–´ ì£¼ì„ ê¶Œì¥

5. íŒ¨ìŠ¤ì›Œë“œ ë³´ì•ˆ
   password í•„ë“œëŠ” ì•”í˜¸í™”ëœ ê°’ì´ ì €ì¥ë˜ì–´ì•¼ í•˜ë©°, ì‹¤ì œ ì•”í˜¸í™” ë¡œì§ì€ ë³„ë„ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤. (ì½”ë“œìƒ ë¬¸ì œëŠ” ì•„ë‹ˆì§€ë§Œ ì£¼ì˜ì‚¬í•­)

6. Optional: UserEntity í´ë˜ìŠ¤ì— Auditing ì¶”ê°€
   ìƒì„±/ìˆ˜ì •ì¼ í•„ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ í•„ìš”í•˜ë©´ ì¶”ê°€ ê°€ëŠ¥ (ì§€ê¸ˆì€ ì—†ì–´ë„ ë¬´ë°©)

ì¢…í•© ìˆ˜ì • ì˜ˆì‹œ (ì¼ë¶€ ë°œì·Œ)
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@ToString(exclude = {"collections", "comments", "ratings", "wishlists", "replies", "likes", "emailVerifications", "socials"})
@EqualsAndHashCode(exclude = {"collections", "comments", "ratings", "wishlists", "replies", "likes", "emailVerifications", "socials"})
public class UserEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(nullable = false, length = 255)
    @Enumerated(EnumType.STRING)
    private Role role;

    @Column(nullable = false, length = 255)
    private String nickname;

    @Column(nullable = false, length = 255)
    private String email;

    @Column(nullable = false, length = 255)
    private String password;

    @Column(length = 1024)
    private String profile;

    @Column(length = 1024)
    private String introduction;

    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
    private List<CollectionEntity> collections = new ArrayList<>();

    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
    private List<CommentEntity> comments = new ArrayList<>();

    // ë‚˜ë¨¸ì§€ í•„ë“œë“¤ë„ ë™ì¼í•˜ê²Œ fetch=LAZY, ì´ˆê¸°í™”
    ...
}
í•„ìš”í•˜ë©´ @JsonIgnoreë‚˜ @JsonManagedReference ì¶”ê°€í•˜ëŠ” ë°©ë²•ë„ ì•Œë ¤ë“œë¦´ê²Œìš”!
ê¶ê¸ˆí•œ ì  ìˆìœ¼ë©´ í¸í•˜ê²Œ ë¬¼ì–´ë´ ì£¼ì„¸ìš” :)

ë‚˜ì˜ ë§:
package com.example.itview_spring.Entity;

import lombok.Getter;
import lombok.Setter;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.ManyToOne;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
public class VideoEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    // ì»¨í…ì¸ 
    @JoinColumn(name = "content_id", nullable = false)
    @ManyToOne(fetch = FetchType.LAZY)
    private ContentEntity content;

    // ë¹„ë””ì˜¤ ì œëª©
    @Column(nullable = false, length = 255)
    private String title;

    // ë¹„ë””ì˜¤ ì¸ë„¤ì¼ URL
    @Column(nullable = false, length = 1024)
    private String image;

    // ë¹„ë””ì˜¤ URL
    @Column(nullable = false, length = 1024)
    private String url;
} ìˆ˜ì •í• ê³³ì€  
ChatGPTì˜ ë§:
VideoEntity ì½”ë“œë„ ì „ë°˜ì ìœ¼ë¡œ ì˜ ì‘ì„±ë˜ì—ˆì–´ìš”!
ë‹¤ë§Œ, ëª‡ ê°€ì§€ ê¶Œì¥ ì‚¬í•­ ë° ê°œì„ ì  ì§šì–´ë“œë¦´ê²Œìš”.

1. @ManyToOneì— optional = false ëª…ì‹œ
   nullable = falseë¥¼ @JoinColumnì— ì§€ì •í–ˆìœ¼ë‹ˆ, @ManyToOneì—ë„ optional = falseë¥¼ ì¶”ê°€í•˜ëŠ” ê²Œ ëª…í™•í•©ë‹ˆë‹¤.

@ManyToOne(fetch = FetchType.LAZY, optional = false)
@JoinColumn(name = "content_id", nullable = false)
private ContentEntity content;
2. í•„ë“œ ì£¼ì„ ì˜ì–´í™” (ì„ íƒ ì‚¬í•­)
   íŒ€ í˜‘ì—… í™˜ê²½ì— ë”°ë¼ ì˜ì–´ ì£¼ì„ ê¶Œì¥

3. (ì„ íƒ) Lombok @ToStringê³¼ @EqualsAndHashCodeì—ì„œ ì—°ê´€ê´€ê³„ í•„ë“œ ì œì™¸
   ë§Œì•½ ì—”í‹°í‹°ë¥¼ toString()ìœ¼ë¡œ ì¶œë ¥í•  ì¼ì´ ìˆìœ¼ë©´, LAZY ë¡œë”©ëœ ì—°ê´€ í•„ë“œê°€ ë¬¸ì œë  ìˆ˜ ìˆì–´ ì œì™¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

@ToString(exclude = "content")
@EqualsAndHashCode(exclude = "content")
4. (ì„ íƒ) URL í•„ë“œ ê¸¸ì´ ì ì ˆì„± ê²€í† 
   URL ê¸¸ì´ê°€ 1024ë¡œ ë„‰ë„‰í•œ í¸ì´ê¸´ í•œë°, ì‹¤ì œ í•„ìš”ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥ (í˜„ì¬ëŠ” ë¬¸ì œ ì—†ìŒ)

ìˆ˜ì •ëœ ì½”ë“œ ì˜ˆì‹œ
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@ToString(exclude = "content")
@EqualsAndHashCode(exclude = "content")
public class VideoEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @ManyToOne(fetch = FetchType.LAZY, optional = false)
    @JoinColumn(name = "content_id", nullable = false)
    private ContentEntity content;

    @Column(nullable = false, length = 255)
    private String title;

    @Column(nullable = false, length = 1024)
    private String image;

    @Column(nullable = false, length = 1024)
    private String url;
}
í•„ìš”í•˜ë©´ ContentEntityì™€ì˜ ê´€ê³„ ì„¤ì •ë„ ê°™ì´ ë´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¶”ê°€ ì§ˆë¬¸ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.Entity;

import lombok.Getter;
import lombok.Setter;

import java.time.LocalDate;
import java.util.List;

import com.example.itview_spring.Constant.Channel;
import com.example.itview_spring.Constant.ContentType;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.EnumType;
import jakarta.persistence.Enumerated;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.Lob;
import jakarta.persistence.OneToMany;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
public class ContentEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    // ì»¨í…ì¸  ì œëª©
    @Column(nullable = false, length = 255)
    private String title;

    // ì»¨í…ì¸  íƒ€ì…
    @Column(nullable = false, length = 255)
    @Enumerated(EnumType.STRING)
    private ContentType contentType;

    // ì»¨í…ì¸  ê³µê°œì¼
    @Column(nullable = false)
    private LocalDate releaseDate;

    // ì»¨í…ì¸  í¬ìŠ¤í„° ì´ë¯¸ì§€ URL
    @Column(nullable = false, length = 1024)
    private String poster;

    // ì»¨í…ì¸  êµ­ê°€
    @Column(nullable = false, length = 255)
    private String nation;

    // ì»¨í…ì¸  ì„¤ëª…
    @Lob
    private String description;

    // ì»¨í…ì¸  ê¸¸ì´
    @Column(nullable = false, length = 255)
    private String duration;

    // ì»¨í…ì¸  ì—°ë ¹ ë“±ê¸‰
    @Column(nullable = false, length = 255)
    private String age;

    // ì˜í™”-ê°ë…ì´ë¦„, ì±…-ì‘ê°€ì´ë¦„, ìŒë°˜-ì•„í‹°ìŠ¤íŠ¸ì´ë¦„
    @Column(length = 255)
    private String creatorName;

    // í”Œë«í¼ ì´ë¦„
    @Column(length = 255)
    @Enumerated(EnumType.STRING)
    private Channel channelName;

    // ì»¨í…ì¸ ì˜ ì¥ë¥´
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ContentGenreEntity> genres;

    // ì»¨í…ì¸ ì˜ ì¶œì—°ì§„
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CreditEntity> credits;

    // ì»¨í…ì¸ ì˜ ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<GalleryEntity> galleries;

    // ì»¨í…ì¸ ì˜ ë¹„ë””ì˜¤
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<VideoEntity> videos;

    // ì»¨í…ì¸ ì˜ ì™¸ë¶€ ì„œë¹„ìŠ¤
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ExternalServiceEntity> externalServices;

    // ì»¨í…ì¸ ì˜ ì½”ë©˜íŠ¸
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CommentEntity> comments;

    // ì»¨í…ì¸ ì˜ í‰ì 
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<RatingEntity> ratings;

    // ì»¨í…ì¸ ì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<WishlistEntity> wishlists;

    // ì»¨í…ì¸ ì˜ ì»¬ë ‰ì…˜ ì•„ì´í…œ
    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CollectionItemEntity> collectionItems;
} ìˆ˜ì •í• ê³³ì€
ChatGPTì˜ ë§:
ContentEntityë„ ì•„ì£¼ ì˜ ì‘ì„±ë˜ì–´ ìˆì–´ìš”!
ëª‡ ê°€ì§€ ê°œì„  í¬ì¸íŠ¸ì™€ ê¶Œì¥ì‚¬í•­ë§Œ ì•ˆë‚´í•´ ë“œë¦´ê²Œìš”.

1. @OneToMany í•„ë“œì˜ FetchType ëª…ì‹œ
   ê¸°ë³¸ì ìœ¼ë¡œ @OneToManyëŠ” FetchType.LAZYì´ì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ ì ì–´ì£¼ë©´ ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒì— ë„ì›€ì´ ë©ë‹ˆë‹¤.

@OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
private List<ContentGenreEntity> genres;
ëª¨ë“  @OneToMany í•„ë“œì— ë™ì¼í•˜ê²Œ ì ìš©í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”.

2. @Lob ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­
   description í•„ë“œì— @Lobì´ ì ì ˆíˆ ì‚¬ìš©ë˜ì—ˆëŠ”ë°,
   DBì— ë”°ë¼ TEXT ë˜ëŠ” CLOB íƒ€ì…ìœ¼ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.

ë§Œì•½ descriptionì´ í¬ê²Œ ê¸¸ì–´ì§ˆ ê°€ëŠ¥ì´ ì—†ìœ¼ë©´ ê·¸ëƒ¥ @Column(length=...)ë„ ì¶©ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. duration í•„ë“œ íƒ€ì… ê²€í† 
   durationì„ Stringìœ¼ë¡œ ì •ì˜í–ˆëŠ”ë°,
   ë§Œì•½ ì»¨í…ì¸  ê¸¸ì´ê°€ ì‹œê°„/ë¶„ ë‹¨ìœ„ ìˆ«ìë¼ë©´ intë‚˜ Duration íƒ€ì…ë„ ê³ ë ¤í•´ ë³´ì„¸ìš”.

4. @Enumerated(EnumType.STRING) ìœ„ì¹˜
   channelName í•„ë“œëŠ” @Columnê³¼ @Enumeratedê°€ í•¨ê»˜ ìˆëŠ”ë°, ìˆœì„œê°€ ë³´í†µ @Enumeratedê°€ ë¨¼ì € ì˜µë‹ˆë‹¤.

@Enumerated(EnumType.STRING)
@Column(length = 255)
private Channel channelName;
ì´ ë¶€ë¶„ì€ í° ë¬¸ì œëŠ” ì•„ë‹ˆì§€ë§Œ ë³´í†µ ì´ë ‡ê²Œ ì”ë‹ˆë‹¤.

5. Lombok @ToString / @EqualsAndHashCodeì—ì„œ ì—°ê´€ í•„ë“œ ì œì™¸ ê¶Œì¥
   ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ë§ì•„ì„œ toString()ì´ë‚˜ equals() í˜¸ì¶œ ì‹œ ë¬´í•œì°¸ì¡° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

@ToString(exclude = {
"genres", "credits", "galleries", "videos", "externalServices",
"comments", "ratings", "wishlists", "collectionItems"
})
@EqualsAndHashCode(exclude = {
"genres", "credits", "galleries", "videos", "externalServices",
"comments", "ratings", "wishlists", "collectionItems"
})
6. ì»¬ë ‰ì…˜ í•„ë“œ ì´ˆê¸°í™” (ì„ íƒì‚¬í•­)
   ì»¬ë ‰ì…˜ í•„ë“œë¥¼ nullì´ ì•„ë‹Œ ë¹ˆ ì»¬ë ‰ì…˜(new ArrayList<>();)ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒë„ NPE ë°©ì§€ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.

7. (ì„ íƒ) Auditing ì»¬ëŸ¼ ì¶”ê°€
   createdAt, updatedAt ê°™ì€ ìƒì„±/ìˆ˜ì • ì¼ì ì»¬ëŸ¼ ì¶”ê°€ ê³ ë ¤ ê°€ëŠ¥

ìµœì¢… ìˆ˜ì • ì˜ˆì‹œ (í•µì‹¬ ë¶€ë¶„ë§Œ ë°œì·Œ)
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Entity
@ToString(exclude = {
"genres", "credits", "galleries", "videos", "externalServices",
"comments", "ratings", "wishlists", "collectionItems"
})
@EqualsAndHashCode(exclude = {
"genres", "credits", "galleries", "videos", "externalServices",
"comments", "ratings", "wishlists", "collectionItems"
})
public class ContentEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(nullable = false, length = 255)
    private String title;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false, length = 255)
    private ContentType contentType;

    @Column(nullable = false)
    private LocalDate releaseDate;

    @Column(nullable = false, length = 1024)
    private String poster;

    @Column(nullable = false, length = 255)
    private String nation;

    @Lob
    private String description;

    @Column(nullable = false, length = 255)
    private String duration;

    @Column(nullable = false, length = 255)
    private String age;

    @Column(length = 255)
    private String creatorName;

    @Enumerated(EnumType.STRING)
    @Column(length = 255)
    private Channel channelName;

    @OneToMany(mappedBy = "content", cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
    private List<ContentGenreEntity> genres;

    // ë‚˜ë¨¸ì§€ë„ ë™ì¼í•˜ê²Œ fetch = FetchType.LAZY ì¶”ê°€
}
í•„ìš”í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹° ê´€ê³„ ì„¤ì •ë„ ê°™ì´ ì ê²€í•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê¶ê¸ˆí•œ ì  ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.DTO;

import com.example.itview_spring.Constant.Channel;
import com.example.itview_spring.Constant.ContentType;
import com.example.itview_spring.Constant.Genre;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

import java.time.LocalDate;
import java.util.List;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class ContentCreateDTO {
private Integer id;
private String title;
private ContentType contentType;
private LocalDate releaseDate;
private String poster;
private String nation;
private String description;
private String duration;
private String age;
private String creatorName;
private Channel channelName;
// ì„ íƒ ì‚¬í•­: genre í•„ë“œ ì¶”ê°€
private List<Genre> genres;
}  ìˆ˜ì •í• ê³³ ì€  
ChatGPTì˜ ë§:
ContentCreateDTOëŠ” DTOë¼ í¬ê²Œ ë¬¸ì œê°€ ì—†ì§€ë§Œ, ëª‡ ê°€ì§€ ê°œì„  í¬ì¸íŠ¸ë§Œ ë§ì”€ë“œë¦´ê²Œìš”.

1. id í•„ë“œ ì œê±° ê³ ë ¤
   ë³´í†µ ìƒì„±ìš© DTO(CreateDTO)ì—ëŠ” id í•„ë“œê°€ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì™œëƒí•˜ë©´ ìƒì„± ì‹œ DBì—ì„œ ìë™ ìƒì„±ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì—ì„œ IDë¥¼ ì „ë‹¬í•  íŠ¹ë³„í•œ ì´ìœ ê°€ ì—†ë‹¤ë©´ ì œê±°í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

2. genres í•„ë“œ íƒ€ì… ê²€í† 
   í˜„ì¬ List<Genre>ì¸ë°, Genreê°€ Enumì´ë¼ë©´ ê´œì°®ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ, ë³´í†µ ì¥ë¥´ëŠ” DBì—ì„œ ë³„ë„ ì—”í‹°í‹°ë¡œ ê´€ë¦¬ë˜ëŠ” ê²½ìš°ê°€ ë§ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸(List<String>)ë¡œ ë³´ë‚´ê¸°ë„ í•©ë‹ˆë‹¤.

ë§Œì•½ Genreê°€ Enumì´ ë§ë‹¤ë©´ ê´œì°®ê³ , ì•„ë‹ˆë¼ë©´ DTO ì„¤ê³„ì— ë§ê²Œ ë³€ê²½ ê³ ë ¤.

3. (ì„ íƒ) @Builder ì¶”ê°€ ê³ ë ¤
   DTO ìƒì„± í¸ì˜ ìœ„í•´ Lombokì˜ @Builderë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class ContentCreateDTO {
// ...
}
4. (ì„ íƒ) ì…ë ¥ ê²€ì¦ ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
   ì˜ˆë¥¼ ë“¤ì–´, javax.validation.constraints ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ ì…ë ¥ ê²€ì¦ ì¶”ê°€ ê°€ëŠ¥

@NotNull
@Size(min = 1, max = 255)
private String title;
ìˆ˜ì • ì˜ˆì‹œ
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
//@Builder  // í•„ìš” ì‹œ í™œì„±í™”
public class ContentCreateDTO {
// idëŠ” ìƒì„±ìš© DTOì—ì„œëŠ” ë³´í†µ ì œì™¸
private String title;
private ContentType contentType;
private LocalDate releaseDate;
private String poster;
private String nation;
private String description;
private String duration;
private String age;
private String creatorName;
private Channel channelName;

    // Enum íƒ€ì…ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
    private List<Genre> genres;
}
í•„ìš”í•˜ë©´ ContentUpdateDTOë„ ê°™ì´ ì„¤ê³„í•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¶”ê°€ ì§ˆë¬¸ í™˜ì˜í•´ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.DTO;

import com.example.itview_spring.Constant.Channel;
import com.example.itview_spring.Constant.ContentType;
import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.Entity.ContentEntity;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import org.hibernate.mapping.List;

import java.time.LocalDate;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class GenreListDTO {
private Integer id;            // ì¥ë¥´ ID (ìˆ˜ì • ì‹œ í•„ìš”)
private ContentEntity content; //ì»¨í…ì¸ 
private Genre genre;           // ì¥ë¥´ ENUM
}  ìˆ˜ì •í• ê³³ì€  
ChatGPTì˜ ë§:
GenreListDTO ì½”ë“œì— ëª‡ ê°€ì§€ ìˆ˜ì • ë° ê°œì„ í•  ë¶€ë¶„ì´ ë³´ì—¬ìš”.
ì•„ë˜ ì°¸ê³ í•˜ì„¸ìš”!

1. import org.hibernate.mapping.List; ì‚­ì œ
   DTOì—ì„œ java.util.Listê°€ ì•„ë‹Œ org.hibernate.mapping.Listë¥¼ import í•˜ì…¨ë„¤ìš”.

DTO ë‚´ë¶€ì— List íƒ€ì… í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ ì´ import ìì²´ê°€ í•„ìš” ì—†ì–´ ë³´ì…ë‹ˆë‹¤. ì‚­ì œí•˜ì„¸ìš”.

2. DTOì— ContentEntity í•„ë“œê°€ ìˆëŠ” ê²ƒ ì¬ê²€í† 
   DTOëŠ” Entityë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ëŠ” ëŒ€ì‹  ë³„ë„ì˜ DTOë¡œ ë§¤í•‘í•˜ëŠ” ê²Œ ì¼ë°˜ì ì¸ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ì…ë‹ˆë‹¤.

ContentEntity ëŒ€ì‹  ContentDTO í˜¹ì€ ë‹¨ìˆœíˆ contentIdë§Œ ê°€ì§€ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

Entity ì°¸ì¡°ëŠ” ì§ë ¬í™”, ê³„ì¸µ ë¶„ë¦¬ì—ì„œ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. DTO ì´ë¦„ê³¼ ìš©ë„ ì •ë¦¬
   í´ë˜ìŠ¤ ì´ë¦„ì´ GenreListDTOì¸ë° ì‹¤ì œ í•„ë“œëŠ” ì¥ë¥´ í•˜ë‚˜ì— ëŒ€í•œ ì •ë³´ ê°™ìŠµë‹ˆë‹¤.

ë³µìˆ˜í˜• ì´ë¦„ ëŒ€ì‹  GenreDTO ë˜ëŠ” ContentGenreDTO ê°™ì€ ì´ë¦„ì´ ë” ëª…í™•í•©ë‹ˆë‹¤.

4. id í•„ë“œ ì„¤ëª…
   ì£¼ì„ì— â€˜ì¥ë¥´ ID (ìˆ˜ì • ì‹œ í•„ìš”)â€™ë¼ê³  í•˜ì…¨ëŠ”ë°, DTO ìƒì„± ëª©ì ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

ìƒì„±ìš© DTOë©´ id ì œì™¸, ìˆ˜ì •ìš©ì´ë©´ í¬í•¨.

5. (ì„ íƒ) Lombok Builder ì¶”ê°€ ê³ ë ¤
   ìˆ˜ì • ì˜ˆì‹œ
   @Getter
   @Setter
   @AllArgsConstructor
   @NoArgsConstructor
   public class ContentGenreDTO {
   private Integer id;        // ì¥ë¥´ ID (í•„ìš” ì‹œ í¬í•¨)
   private Integer contentId; // contentIdë¡œ ëŒ€ì²´ (Entity ì§ì ‘ ì°¸ì¡° ëŒ€ì‹ )
   private Genre genre;       // ì¥ë¥´ ENUM
   }
   í•„ìš”í•˜ë©´ ê´€ë ¨ ì»¨í…ì¸  DTOì™€ ë§¤í•‘ ì½”ë“œë„ ê°™ì´ ë„ì™€ë“œë¦´ê²Œìš”!
   ë” ê¶ê¸ˆí•œ ì  ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš” :)

ë‚˜ì˜ ë§:
ìœ„ìë£Œ ì°¸ì¡°í•´ì„œ videoDTO ì‘ì„±í•´ì¤˜
ChatGPTì˜ ë§:
ì•„ë˜ëŠ” VideoEntityë¥¼ ì°¸ê³ í•´ì„œ ë§Œë“  VideoDTO ì˜ˆì‹œì…ë‹ˆë‹¤.
DTOëŠ” ì—”í‹°í‹°ì™€ ê±°ì˜ ë™ì¼í•˜ì§€ë§Œ, ë³´í†µ ì—°ê´€ ì—”í‹°í‹°ëŠ” ID ë˜ëŠ” ë³„ë„ì˜ DTOë¡œ ëŒ€ì²´í•˜ê³ , ë¶ˆí•„ìš”í•œ JPA ì–´ë…¸í…Œì´ì…˜ì€ ì œì™¸í•©ë‹ˆë‹¤.

package com.example.itview_spring.DTO;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class VideoDTO {

    private Integer id;

    // ì—°ê´€ëœ ì»¨í…ì¸  IDë§Œ í¬í•¨ (ContentEntity ëŒ€ì‹ )
    private Integer contentId;

    private String title;

    private String image;  // ì¸ë„¤ì¼ URL

    private String url;    // ë¹„ë””ì˜¤ URL
}
ì„¤ëª…
contentId í•„ë“œë¥¼ ì¶”ê°€í•´ VideoEntityì˜ content ì°¸ì¡° ëŒ€ì‹  ì»¨í…ì¸  IDë§Œ ì €ì¥í•©ë‹ˆë‹¤.

Lombokìœ¼ë¡œ ê¸°ë³¸ ìƒì„±ì, ì „ì²´ ìƒì„±ì, getter/setter ìë™ ìƒì„±.

JPA ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ì€ ì œê±°í•˜ì—¬ DTO ì—­í• ì— ì§‘ì¤‘.

í•„ìš” ì‹œ ë³€í™˜ ë©”ì„œë“œ(converter)ë„ ê°™ì´ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
ë” ìš”ì²­ì‚¬í•­ ìˆìœ¼ë©´ ì•Œë ¤ ì£¼ì„¸ìš”.

ë‚˜ì˜ ë§:
videoreporstrory ì‘ì„± ìš”
ChatGPTì˜ ë§:
VideoRepositoryëŠ” VideoEntityì— ëŒ€í•œ ë°ì´í„° ì ‘ê·¼ì„ ë‹´ë‹¹í•˜ëŠ” JPA ë¦¬í¬ì§€í† ë¦¬ì…ë‹ˆë‹¤.

ì•„ë˜ëŠ” ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ì ì¸ VideoRepository ì˜ˆì œì…ë‹ˆë‹¤:

package com.example.itview_spring.Repository;

import com.example.itview_spring.Entity.VideoEntity;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface VideoRepository extends JpaRepository<VideoEntity, Integer> {

    // contentIdë¡œ Video ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
    List<VideoEntity> findByContentId(Integer contentId);

}
ì„¤ëª…
JpaRepository<VideoEntity, Integer>: VideoEntityë¥¼ ê¸°ë³¸ Entityë¡œ, ê¸°ë³¸í‚¤ íƒ€ì…ì€ Integerì„ì„ ì§€ì •.

findByContentId(Integer contentId):
VideoEntity ë‚´ë¶€ì˜ content í•„ë“œì—ì„œ content_id ê¸°ì¤€ìœ¼ë¡œ ë™ì˜ìƒ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œ.
(JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ content.idì™€ ë§¤ì¹­)

í•„ìš”í•˜ë‹¤ë©´ ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ì‘ì„±, í˜ì´ì§• ì²˜ë¦¬ ë“±ë„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¶”ê°€ ìš”ì²­ ìˆìœ¼ë©´ í¸í•˜ê²Œ ë§ì”€í•´ ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
ì—…ë¡œë“œí•œ ì´ë¯¸ì§€
ì™€ ê°™ì´ ì‘ì„±í• ë•Œ service ì…ë ¥ ìˆ˜ì •  ì‘ì„±ìš”í•¨
ChatGPTì˜ ë§:
ì´ë¯¸ì§€ì— ë‚˜íƒ€ë‚œ UIëŠ” ë™ì˜ìƒ ë“±ë¡/ìˆ˜ì • í™”ë©´ìœ¼ë¡œ, ì‚¬ìš©ì ì…ë ¥ì— ë”°ë¼ ì¸ë„¤ì¼ ë§í¬, ì˜ìƒ ë§í¬, ì œëª©ì„ ì‘ì„±í•˜ê³  ì—¬ëŸ¬ ê°œì˜ ë™ì˜ìƒì„ ë“±ë¡í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ° ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ VideoService ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âœ… 1. Video ë“±ë¡/ìˆ˜ì •ìš© DTO ì˜ˆì‹œ (VideoDTO or VideoCreateDTO)
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class VideoCreateDTO {
private Integer id;          // ìˆ˜ì • ì‹œ í•„ìš”
private Integer contentId;   // ì–´ëŠ ì½˜í…ì¸ ì— ì†í•˜ëŠ” ë¹„ë””ì˜¤ì¸ì§€
private String title;        // ì œëª©
private String image;        // ì¸ë„¤ì¼ ë§í¬
private String url;          // ì˜ìƒ ë§í¬
}
âœ… 2. VideoService ì‘ì„± ì˜ˆì‹œ
package com.example.itview_spring.Service;

import com.example.itview_spring.DTO.VideoCreateDTO;
import com.example.itview_spring.Entity.ContentEntity;
import com.example.itview_spring.Entity.VideoEntity;
import com.example.itview_spring.Repository.ContentRepository;
import com.example.itview_spring.Repository.VideoRepository;
import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class VideoService {

    private final VideoRepository videoRepository;
    private final ContentRepository contentRepository;

    // ë™ì˜ìƒ ë“±ë¡
    @Transactional
    public void createVideos(List<VideoCreateDTO> videoDTOList) {
        for (VideoCreateDTO dto : videoDTOList) {
            ContentEntity content = contentRepository.findById(dto.getContentId())
                .orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ì½˜í…ì¸ ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

            VideoEntity video = new VideoEntity();
            video.setContent(content);
            video.setTitle(dto.getTitle());
            video.setImage(dto.getImage());
            video.setUrl(dto.getUrl());

            videoRepository.save(video);
        }
    }

    // ë™ì˜ìƒ ìˆ˜ì •
    @Transactional
    public void updateVideos(List<VideoCreateDTO> videoDTOList) {
        for (VideoCreateDTO dto : videoDTOList) {
            VideoEntity video = videoRepository.findById(dto.getId())
                .orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ë™ì˜ìƒì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));

            video.setTitle(dto.getTitle());
            video.setImage(dto.getImage());
            video.setUrl(dto.getUrl());

            // contentIdë„ ìˆ˜ì •í•˜ë ¤ë©´ ì•„ë˜ ë¼ì¸ ì¶”ê°€
            if (dto.getContentId() != null && !dto.getContentId().equals(video.getContent().getId())) {
                ContentEntity content = contentRepository.findById(dto.getContentId())
                    .orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ì½˜í…ì¸ ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
                video.setContent(content);
            }

            videoRepository.save(video);
        }
    }

    // ì½˜í…ì¸  ID ê¸°ì¤€ìœ¼ë¡œ ë™ì˜ìƒ ëª©ë¡ ì¡°íšŒ
    public List<VideoCreateDTO> getVideosByContentId(Integer contentId) {
        return videoRepository.findByContentId(contentId).stream()
                .map(video -> new VideoCreateDTO(
                        video.getId(),
                        video.getContent().getId(),
                        video.getTitle(),
                        video.getImage(),
                        video.getUrl()
                ))
                .collect(Collectors.toList());
    }

    // ì‚­ì œ
    @Transactional
    public void deleteVideo(Integer id) {
        videoRepository.deleteById(id);
    }
}
âœ… 3. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš© ì˜ˆ
@PostMapping("/admin/videos")
public ResponseEntity<Void> createVideos(@RequestBody List<VideoCreateDTO> videoDTOList) {
videoService.createVideos(videoDTOList);
return ResponseEntity.ok().build();
}
ğŸ”§ ì°¸ê³  ì‚¬í•­
ë“±ë¡ê³¼ ìˆ˜ì •ì€ ê°ê° ë‚˜ëˆŒ ìˆ˜ë„ ìˆê³ , í”„ë¡ íŠ¸ì—ì„œ id ì¡´ì¬ ì—¬ë¶€ë¡œ íŒë‹¨í•´ í•˜ë‚˜ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì²˜ë¦¬í•´ë„ ë©ë‹ˆë‹¤.

UIì—ì„œëŠ” ë°˜ë³µ ì…ë ¥ì„ ìœ„í•œ ë°°ì—´ ì „ì†¡ ë°©ì‹ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë¯€ë¡œ, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë„ List<VideoCreateDTO>ë¡œ ë°›ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

ì¸ë„¤ì¼, ì˜ìƒ ë§í¬, ì œëª© í•„ë“œëŠ” í”„ë¡ íŠ¸ì—ì„œ ìœ íš¨ì„± ê²€ì‚¬ì™€ í•¨ê»˜ null ë˜ëŠ” ë¹ˆê°’ ì²´í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

í•„ìš”í•˜ë©´ ë“±ë¡/ìˆ˜ì • í†µí•© APIë‚˜ ê´€ë ¨ ì˜ˆì™¸ ì²˜ë¦¬ë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ì¶”ê°€ ìš”ì²­ ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.Service;

import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.ContentResponseDTO;
import com.example.itview_spring.DTO.ExternalServiceDTO;
import com.example.itview_spring.DTO.GenreDTO;
import com.example.itview_spring.DTO.ImageDTO;
import com.example.itview_spring.DTO.VideoDTO;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.Entity.ContentEntity;
import com.example.itview_spring.Repository.ContentGenreRepository;
import com.example.itview_spring.Entity.ContentGenreEntity;
import com.example.itview_spring.Entity.RatingEntity;
import com.example.itview_spring.Repository.ContentGenreRepository;
import com.example.itview_spring.Repository.ContentRepository;
import com.example.itview_spring.Repository.ExternalServiceRepository;
import com.example.itview_spring.Repository.GalleryRepository;
import com.example.itview_spring.Repository.RatingRepository;
import com.example.itview_spring.Repository.UserRepository;
import com.example.itview_spring.Repository.VideoRepository;

import lombok.RequiredArgsConstructor;
import org.modelmapper.ModelMapper;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;
import java.util.stream.Collectors;


@Service
@RequiredArgsConstructor
@Transactional
public class ContentService {
private final ContentRepository contentRepository;
private final ContentGenreRepository contentGenreRepository;
private final GalleryRepository galleryRepository;
private final VideoRepository videoRepository;
private final ExternalServiceRepository externalServiceRepository;
private final RatingRepository ratingRepository;
private final UserRepository userRepository;
private final ModelMapper modelMapper;

    //ì „ì²´ì¡°íšŒ
    //ëª©ë¡(ì „ì²´ì¡°íšŒ)
    //ëª¨ë‘ ì½ì–´ì„œ list<ë°©ê¸ˆ ì‘ì„±í•œ DTO> ì „ë‹¬
    //public ì „ë‹¬í•  ëª¨ì–‘ ì´ë¦„ì€ ë§ˆìŒëŒ€ë¡œ(ë°›ì„ê²ƒ{
    //
    //     ì‚¬ìš©í•œ Repository.ì‘ì—…í•  í•¨ìˆ˜.var
    //     return ì „ë‹¬í•  ê°’;
    //}
    // public List<ProductDTO> ì•ˆì•Œë ¤ì¤Œ() {
    // public List<ProductDTO> List() {      ex)
    /**
     * ì „ì²´ ëª©ë¡ì¡°íšŒ
     *
     * @param page ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸
     * @return ê²°ê³¼
     */

    public Page<ContentCreateDTO> getAllContents(Pageable page) {
        int currentPage = page.getPageNumber()-1;
        int pageLimits = 10 ;

        Pageable pageable = PageRequest.of(currentPage,pageLimits, Sort.by(Sort.Direction.DESC, "id"));
        Page<ContentEntity> contentEntities = contentRepository.findAll(pageable) ;
        Page<ContentCreateDTO> contentDTOS = contentEntities.map(data->modelMapper.map(
                data, ContentCreateDTO.class));
        return contentDTOS;
    }
//    public List<ContentCreateDTO> List() {
//        //ì½ê¸°,ìˆ˜ì •/ì €ì¥/ì‚­ì œ ==>Repository
//        List<ContentEntity> contentEntities = contentRepository.findAll();
//        //Entity =ìˆìœ¼ë©´ ë°‘ì— DTOë³€í™˜
//        List<ContentCreateDTO> contentDTOs = Arrays.asList(modelMapper.map(contentEntities, ContentCreateDTO[].class));
//        //DTOê°€ ë³´ì´ë©´ return DTOë¥¼ì§€ì •
//        return contentDTOs;
//    }



    //ìƒì„¸ë³´ê¸°,ìˆ˜ì •(ê°œë³„ì¡°íšŒ)
    //ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë°›ì•„ì„œ í•´ë‹¹í•˜ëŠ” DTOì— ì „ë‹¬
    //public ProductDTO ì—­ì‹œ ì•ˆì•Œë ¤ì¤Œ(Integer id) {
    //public ProductDTO read(Integer id) {    ex)
    public ContentCreateDTO read(Integer id) {
        //í•´ë‹¹ë‚´ìš©ì„ ì¡°íšŒ
        if (id == null) {
            throw new IllegalArgumentException("idëŠ” nullì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        Optional<ContentEntity> contentEntity = contentRepository.findById(id);
        if (contentEntity.isEmpty()) {
            throw new NoSuchElementException("í•´ë‹¹ IDì— ëŒ€í•œ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + id);
        }
        ContentCreateDTO adminContentDTO = modelMapper.map(contentEntity.get(), ContentCreateDTO.class);
        return adminContentDTO;
    }

    //ë“±ë¡(ì €ì¥)
    //DTOë¥¼ ë°›ì•„ì„œ ì €ì¥
    //public void ë‚´ë§˜ëŒ€ë¡œ (ProductDTO productDTO) {
    //public void create (ProductDTO productDTO) {  ex)
    public ContentCreateDTO create(ContentCreateDTO dto) {
        //DTOê°€ ì´ìˆìœ¼ë©´ ë°˜ë“œì‹œ Entity ë³€í™˜

        ContentEntity contentEntity = modelMapper.map(dto, ContentEntity.class);
        System.out.println("service add dto:"+dto);
        System.out.println("service add entity:"+contentEntity);

        contentRepository.save(contentEntity);
        return modelMapper.map(contentEntity, ContentCreateDTO.class);
    }

    //ìˆ˜ì •
    //ì£¼ë¬¸ë²ˆí˜¸ì™€ DTOë¥¼ ë°›ì•„ì„œ, ì£¼ë¬¸ë²ˆí˜¸ë¡œ ì¡°íšŒí•´ì„œ DTOì˜ ë‚´ìš©ì„ ì €ì¥
    // public void ìˆ˜ì •í• ê¹Œ(Integer orderId, ProductDTO productDTO) {
    // public void update(Integer orderId, ProductDTO productDTO) {   ex)
    public ContentCreateDTO update(Integer id, ContentCreateDTO dto) {
        //í•´ë‹¹ë‚´ìš©ì°¾ê¸°
//        System.out.println("dto:"+dto);
ContentEntity contentEntity = modelMapper.map(dto, ContentEntity.class);

        if (contentEntity == null) {
            return null;
        }
//        System.out.println("entity:"+contentEntity);
//ë‚´ìš©ì„ ì €ì¥(@Idê°€ ìˆëŠ” ë³€ìˆ˜ëŠ” ì €ì¥ ë¶ˆê°€)
contentEntity.setTitle(dto.getTitle());
contentEntity.setContentType(dto.getContentType());
contentEntity.setReleaseDate(dto.getReleaseDate());
contentEntity.setPoster(dto.getPoster());
contentEntity.setNation(dto.getNation());
contentEntity.setDescription(dto.getDescription());
contentEntity.setDuration(dto.getDuration());
contentEntity.setAge(dto.getAge());
contentEntity.setCreatorName(dto.getCreatorName());
contentEntity.setChannelName(dto.getChannelName());

        contentRepository.save(contentEntity);
        return modelMapper.map(contentEntity, ContentCreateDTO .class);
    }

    //ì‚­ì œ
    //ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë°›ì•„ì„œ ì‚­ì œ
    //  public void ì‚­ì œê°€ë ê¹Œ(Integer id) {
    //  public void delete(Integer id) {
//    public boolean delete(Integer id) {
//        // First delete related entries in content_genre_entity
//        if(contentRepository.existsById(id)) { //ë°ì´í„°ê°€ ì¡´ì¬í•˜ë©´
//            contentGenreRepository.deleteByContentId(id); // Assuming you have a method in repository for this
//
//            // Then delete the content entity
//            contentRepository.deleteById(id); //ì‚­ì œ
//            return true;
//        }
//        return false;
//    }


    @Transactional
    public void delete(Integer id) {
        ContentEntity content = contentRepository.findById(id)
                .orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + id));

        // Delete the related genres first
        contentGenreRepository.deleteByContent(content);

        // Now delete the content entity
        contentRepository.delete(content);
    }


    // ì»¨í…ì¸  ìƒì„¸ ì •ë³´ ì¡°íšŒ
    public ContentDetailDTO getContentDetail(Integer contentId) {
        ContentDetailDTO contentDetail = new ContentDetailDTO();

        // ì»¨í…ì¸  ì •ë³´ ì¡°íšŒ
        ContentResponseDTO contentResponseDTO = contentRepository.findContentWithAvgRating(contentId);
        // ì»¨í…ì¸  ì¥ë¥´ ì¡°íšŒ
        List<GenreDTO> genres = contentGenreRepository.findByContentId(contentId);
        genres.forEach(genre -> {
            contentResponseDTO.getGenres().add(genre.getGenre().getGenreName());
        });
        contentDetail.setContentInfo(contentResponseDTO);

        // ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì¡°íšŒ
        List<ImageDTO> images = galleryRepository.findByContentId(contentId);
        contentDetail.setGallery(images);

        // ë™ì˜ìƒ ì¡°íšŒ
        List<VideoDTO> videos = videoRepository.findByContentId(contentId);
        contentDetail.setVideos(videos);

        // ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¡°íšŒ
        List<ExternalServiceDTO> externalServices = externalServiceRepository.findByContentId(contentId);
        contentDetail.setExternalServices(externalServices);

        return contentDetail;
    }
    //////////////////////////////////////////////////////////////////////////////////////////
    /**
     * ì½˜í…ì¸ ì— ì¥ë¥´ ì¶”ê°€
     *///
    //ì¥ë¥´ì¡°íšŒ
    @Transactional
    public List<Genre> getGenresByContentId(Integer contentId) {
        ContentEntity content = contentRepository.findById(contentId)
                .orElseThrow(() -> new NoSuchElementException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));

        List<ContentGenreEntity> genreEntities = contentGenreRepository.findByContent(content);

        return genreEntities.stream()
                .map(ContentGenreEntity::getGenre)
                .collect(Collectors.toList());
    }

    @Transactional
    public void addGenres(Integer contentId, List<Genre> genres) {
        ContentEntity content = contentRepository.findById(contentId)
                .orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));
        List<Genre> existingGenres = getGenresByContentId(contentId);

        for (Genre genre : genres) {
            if (existingGenres.contains(genre)) {
                continue; // ì´ë¯¸ ìˆëŠ” ì¥ë¥´ëŠ” ê±´ë„ˆëœ€
            }
            System.out.println(" add contentId :"+contentId);
            System.out.println(" add content :"+content);
            System.out.println(" add genre :"+genre);
            System.out.println(" -----------------");

            ContentGenreEntity contentGenre = new ContentGenreEntity();
            contentGenre.setContent(content);// âœ… null ì•„ë‹˜
            contentGenre.setGenre(genre);  // âœ… ì—¬ê¸°ì„œ contentê°€ nullì´ë©´ ì—ëŸ¬ ë°œìƒ

            contentGenreRepository.save(contentGenre);
        }

    }

    /**
     * ì½˜í…ì¸  ì¥ë¥´ ìˆ˜ì • (ê¸°ì¡´ ì¥ë¥´ ëª¨ë‘ ì‚­ì œ í›„, ìƒˆë¡œ ì¶”ê°€)
     */
    @Transactional
    public void updateGenres(Integer contentId, List<Genre> newGenres) {
        ContentEntity content = contentRepository.findById(contentId)
                .orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));

        // ê¸°ì¡´ ì¥ë¥´ ì‚­ì œ
        List<Genre> oldGenres = getGenresByContentId(contentId);  // ê¸°ì¡´ ì¥ë¥´ ê°€ì ¸ì˜¤ê¸°
        contentGenreRepository.deleteByContent(content);  // ê¸°ì¡´ ì¥ë¥´ ì‚­ì œ

        // ìƒˆë¡œìš´ ì¥ë¥´ ì¶”ê°€
        for (Genre genre : newGenres) {
//            System.out.println(" update contentId :"+contentId);
//            System.out.println(" update content :"+content);
//            System.out.println(" update genre :"+genre);
//            System.out.println(" -----------------");

            ContentGenreEntity contentGenre = new ContentGenreEntity();
            contentGenre.setContent(content); // ë°˜ë“œì‹œ content ì„¸íŒ…
            contentGenre.setGenre(genre);
            contentGenreRepository.save(contentGenre); // ìƒˆë¡œìš´ ì¥ë¥´ ì €ì¥
            // ë¡œê·¸ë¡œ ì´ì „ ì¥ë¥´ì™€ ìˆ˜ì •ëœ ì¥ë¥´ ë¹„êµ (ì„ íƒì‚¬í•­)
            System.out.println("Old Genres: " + oldGenres);
            System.out.println("New Genres: " + newGenres);

        }
    }

    // ë³„ì  ë“±ë¡
    public void rateContent(Integer userId, Integer contentId, Integer score) {

        // ê¸°ì¡´ ë³„ì  ì¡°íšŒ
        Optional<RatingEntity> existingRating = ratingRepository.findByUserIdAndContentId(userId, contentId);

        if (existingRating.isEmpty()) {
            RatingEntity ratingEntity = new RatingEntity();
            ratingEntity.setUser(userRepository.findById(userId).get());
            ratingEntity.setContent(contentRepository.findById(contentId).get());
            ratingEntity.setScore(score);
        }
        else {
            // ê¸°ì¡´ ë³„ì ì´ ìˆëŠ” ê²½ìš° ì—…ë°ì´íŠ¸
            RatingEntity ratingEntity = existingRating.get();
            ratingEntity.setScore(score);
        }        
    }
} ë‚´ê°€ ì‘ì„±í•œê²ƒì„content ì™€ ì¥ë¥´ ì‘ì„±í–ˆìŒ   ìˆ˜ì •í• ê³³ì€ ?





ChatGPTì˜ ë§:
ì „ì²´ì ìœ¼ë¡œ ì˜ êµ¬ì„±ëœ ContentService ì½”ë“œì…ë‹ˆë‹¤. ê¸°ëŠ¥ì´ ë§ê³  ì—­í• ì´ ëª…í™•í•˜ê²Œ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë©°, íŠ¹íˆ ì¥ë¥´, í‰ì , ë™ì˜ìƒ, ì™¸ë¶€ ì„œë¹„ìŠ¤, ìƒì„¸ì¡°íšŒê¹Œì§€ ëª¨ë‘ ì»¤ë²„í•˜ê³  ìˆì–´ êµ¬ì¡°ì ìœ¼ë¡œ ì™„ì„±ë„ê°€ ë†’ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¼ë¶€ ì¤‘ë³µ, ê°œì„ , ë³´ì™„ ë˜ëŠ” ì˜¤ë¥˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë¶€ë¶„ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì•„ë˜ì— êµ¬ì²´ì ì¸ ìˆ˜ì • í¬ì¸íŠ¸ë¥¼ ì•ˆë‚´ë“œë¦´ê²Œìš”.

âœ… ìˆ˜ì •í•  ê³³ ìš”ì•½
êµ¬ë¶„	ë‚´ìš©	ìˆ˜ì • ê¶Œì¥ ì—¬ë¶€
ğŸ” ì¤‘ë³µ import	ContentCreateDTO, ContentGenreRepository	âœ… ì •ë¦¬ í•„ìš”
âŒ ì˜ëª»ëœ í‰ì  ì €ì¥	rateContent()ì—ì„œ ì €ì¥ ë¡œì§ ëˆ„ë½	âœ… ë°˜ë“œì‹œ ìˆ˜ì •
ğŸ§© update() ë¡œì§ ëˆ„ë½	update()ì—ì„œ ID ê°’ ë¯¸ì„¸íŒ… â†’ ì‹ ê·œ insert ìœ„í—˜	âœ… ìˆ˜ì •
ğŸ¯ ê°œì„  í¬ì¸íŠ¸	create(), update()ì—ì„œ ì¥ë¥´ ë“±ë¡ë„ í•¨ê»˜ ì²˜ë¦¬í•˜ë©´ ë” ì§ê´€ì 	â­ ì„ íƒì‚¬í•­
ğŸ§¹ ì½”ë“œ í´ë¦°ì—…	ë¶ˆí•„ìš”í•œ ì£¼ì„ ì •ë¦¬, ë¡œê·¸ ê°œì„ 	â­ ì„ íƒì‚¬í•­
ğŸ› ï¸ 1. ì¤‘ë³µ import ì •ë¦¬
// ì¤‘ë³µëœ import ì œê±°
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.Repository.ContentGenreRepository;
í•œ ë²ˆë§Œ importí•˜ë©´ ë©ë‹ˆë‹¤.

ğŸ§¨ 2. rateContent() ì—ì„œ ë³„ì  ì €ì¥ ëˆ„ë½
// ë¬¸ì œ ì½”ë“œ (ì €ì¥ ì—†ìŒ)
if (existingRating.isEmpty()) {
RatingEntity ratingEntity = new RatingEntity();
ratingEntity.setUser(userRepository.findById(userId).get());
ratingEntity.setContent(contentRepository.findById(contentId).get());
ratingEntity.setScore(score);
// âŒ ì €ì¥ ëˆ„ë½
}
âœ… ìˆ˜ì • ì½”ë“œ:

if (existingRating.isEmpty()) {
RatingEntity ratingEntity = new RatingEntity();
ratingEntity.setUser(userRepository.findById(userId).orElseThrow());
ratingEntity.setContent(contentRepository.findById(contentId).orElseThrow());
ratingEntity.setScore(score);
ratingRepository.save(ratingEntity); // âœ… ì €ì¥ í•„ìš”
} else {
RatingEntity ratingEntity = existingRating.get();
ratingEntity.setScore(score);
ratingRepository.save(ratingEntity); // âœ… ìˆ˜ì • ì €ì¥ í•„ìš”
}
âš ï¸ 3. update()ì—ì„œ ID ë¯¸ì„¸íŒ… â†’ insert ìœ„í—˜
ModelMapperë¥¼ í†µí•´ ContentEntityë¥¼ ìƒˆë¡œ ë§¤í•‘í•˜ë©´ì„œ idê°€ nullì¸ ê²½ìš°, insertë¡œ ì˜¤ì¸ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

âœ… ì•„ë˜ì™€ ê°™ì´ ê¸°ì¡´ entityë¥¼ ì§ì ‘ ì¡°íšŒí•´ì„œ ìˆ˜ì •í•˜ëŠ” ë°©ì‹ ì¶”ì²œ:

public ContentCreateDTO update(Integer id, ContentCreateDTO dto) {
ContentEntity contentEntity = contentRepository.findById(id)
.orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ IDì˜ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤: " + id));

    contentEntity.setTitle(dto.getTitle());
    contentEntity.setContentType(dto.getContentType());
    contentEntity.setReleaseDate(dto.getReleaseDate());
    contentEntity.setPoster(dto.getPoster());
    contentEntity.setNation(dto.getNation());
    contentEntity.setDescription(dto.getDescription());
    contentEntity.setDuration(dto.getDuration());
    contentEntity.setAge(dto.getAge());
    contentEntity.setCreatorName(dto.getCreatorName());
    contentEntity.setChannelName(dto.getChannelName());

    contentRepository.save(contentEntity);
    return modelMapper.map(contentEntity, ContentCreateDTO.class);
}
ğŸ¯ 4. create() ë° update()ì—ì„œ ì¥ë¥´ë„ í•¨ê»˜ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ ê°œì„  (ì„ íƒì‚¬í•­)
í˜„ì¬ëŠ” ì¥ë¥´ ì¶”ê°€ëŠ” ë³„ë„ ë©”ì„œë“œë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë‚˜, í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë“±ë¡ ì‹œ ì¥ë¥´ë„ ê°™ì´ ë³´ë‚´ë©´, create() ë‚´ì—ì„œ addGenres()ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì§ê´€ì ì…ë‹ˆë‹¤.

public ContentCreateDTO create(ContentCreateDTO dto) {
ContentEntity contentEntity = modelMapper.map(dto, ContentEntity.class);
contentRepository.save(contentEntity);

    // ì¥ë¥´ ë“±ë¡ ì²˜ë¦¬
    if (dto.getGenres() != null) {
        addGenres(contentEntity.getId(), dto.getGenres());
    }

    return modelMapper.map(contentEntity, ContentCreateDTO.class);
}
update()ë„ ë™ì¼í•˜ê²Œ updateGenres() í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤.

ğŸ§¹ 5. ê¸°íƒ€ ì •ë¦¬ í¬ì¸íŠ¸
ì£¼ì„ì€ ì‹¤ì œ ì‚¬ìš© ì¤‘ì¸ ì½”ë“œ ì™¸ì—ëŠ” ì œê±°í•˜ëŠ” ê²ƒì´ ê°€ë…ì„±ì— ì¢‹ìŠµë‹ˆë‹¤.

System.out.println â†’ log.info ë“±ìœ¼ë¡œ êµì²´ ê³ ë ¤ (Spring Bootì˜ @Slf4j)

âœ… ì •ë¦¬
í•­ëª©	ìƒíƒœ
ì¤‘ë³µ import	ğŸ”§ ì œê±° ê¶Œì¥
rateContent() ì €ì¥	â— ë°˜ë“œì‹œ ìˆ˜ì • í•„ìš”
update() ID ì„¸íŒ…	â— ë°˜ë“œì‹œ ìˆ˜ì • í•„ìš”
create/update â†’ ì¥ë¥´ ì²˜ë¦¬ í¬í•¨	â­ ì¶”ì²œ ê°œì„ 
ì£¼ì„, ë¡œê¹…	â­ ì„ íƒì ìœ¼ë¡œ ì •ë¦¬
í•„ìš”í•˜ë‹¤ë©´ ì´ ContentServiceë¥¼ ê¸°ë°˜ìœ¼ë¡œ Controller, DTO, Entity, Mapperê¹Œì§€ í†µí•©ì ìœ¼ë¡œ êµ¬ì„± ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‚˜ì˜ ë§:
ì£¼ìš” ìë£Œ ì˜†ìœ¼ë¡œ ì£¼ì„ ë‹¬ì•„ ë‹¤ì‹œ  ìˆ˜ì •í• ê³³ì€
ChatGPTì˜ ë§:
ì•„ë˜ëŠ” ë‹¹ì‹ ì´ ì‘ì„±í•œ ContentService ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì •ì´ í•„ìš”í•œ ì£¼ìš” ë¶€ë¶„ë“¤ì— ëŒ€í•´ ì¸ë¼ì¸ ì£¼ì„ì„ ë‹¬ì•„ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤. ìˆ˜ì • í¬ì¸íŠ¸ëŠ” ê¸°ëŠ¥ ë³´ì™„, ì˜¤ë¥˜ ë°©ì§€, ì½”ë“œ ê°œì„ ì„ ì¤‘ì‹¬ìœ¼ë¡œ í–ˆìŠµë‹ˆë‹¤.

âœ… ì£¼ìš” ìˆ˜ì • í¬ì¸íŠ¸ ë°˜ì˜ + ì¸ë¼ì¸ ì£¼ì„
@Service
@RequiredArgsConstructor
@Transactional
public class ContentService {

    // ğŸ”§ Repository ë° Mapper ì£¼ì…
    private final ContentRepository contentRepository;
    private final ContentGenreRepository contentGenreRepository;
    private final GalleryRepository galleryRepository;
    private final VideoRepository videoRepository;
    private final ExternalServiceRepository externalServiceRepository;
    private final RatingRepository ratingRepository;
    private final UserRepository userRepository;
    private final ModelMapper modelMapper;

    /**
     * âœ… ì „ì²´ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ (í˜ì´ì§• ì²˜ë¦¬)
     */
    public Page<ContentCreateDTO> getAllContents(Pageable page) {
        int currentPage = page.getPageNumber() - 1;
        int pageLimits = 10;

        Pageable pageable = PageRequest.of(currentPage, pageLimits, Sort.by(Sort.Direction.DESC, "id"));
        Page<ContentEntity> contentEntities = contentRepository.findAll(pageable);

        // ğŸ“Œ Entity â†’ DTO ë³€í™˜
        return contentEntities.map(data -> modelMapper.map(data, ContentCreateDTO.class));
    }

    /**
     * âœ… ì½˜í…ì¸  ìƒì„¸ ì¡°íšŒ (ìˆ˜ì •ìš©)
     */
    public ContentCreateDTO read(Integer id) {
        if (id == null) throw new IllegalArgumentException("idëŠ” nullì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        ContentEntity contentEntity = contentRepository.findById(id)
            .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ì½˜í…ì¸  ì—†ìŒ: " + id));
        return modelMapper.map(contentEntity, ContentCreateDTO.class);
    }

    /**
     * âœ… ì½˜í…ì¸  ë“±ë¡
     * âš ï¸ ì¥ë¥´ í¬í•¨ëœ ê²½ìš° addGenres í˜¸ì¶œ ê¶Œì¥
     */
    public ContentCreateDTO create(ContentCreateDTO dto) {
        ContentEntity contentEntity = modelMapper.map(dto, ContentEntity.class);
        contentRepository.save(contentEntity);

        // â­ ì¥ë¥´ í¬í•¨ ì‹œ í•¨ê»˜ ì €ì¥
        if (dto.getGenres() != null && !dto.getGenres().isEmpty()) {
            addGenres(contentEntity.getId(), dto.getGenres()); // â¬…ï¸ ì¶”ê°€
        }

        return modelMapper.map(contentEntity, ContentCreateDTO.class);
    }

    /**
     * âœ… ì½˜í…ì¸  ìˆ˜ì •
     * âš ï¸ idë¡œ ê¸°ì¡´ Entity ì¡°íšŒ â†’ ìˆ˜ì • ê¶Œì¥
     */
    public ContentCreateDTO update(Integer id, ContentCreateDTO dto) {
        ContentEntity contentEntity = contentRepository.findById(id)
            .orElseThrow(() -> new NoSuchElementException("ìˆ˜ì •í•  ì½˜í…ì¸  ì—†ìŒ: " + id));

        // âœï¸ í•„ë“œ ì§ì ‘ ìˆ˜ì •
        contentEntity.setTitle(dto.getTitle());
        contentEntity.setContentType(dto.getContentType());
        contentEntity.setReleaseDate(dto.getReleaseDate());
        contentEntity.setPoster(dto.getPoster());
        contentEntity.setNation(dto.getNation());
        contentEntity.setDescription(dto.getDescription());
        contentEntity.setDuration(dto.getDuration());
        contentEntity.setAge(dto.getAge());
        contentEntity.setCreatorName(dto.getCreatorName());
        contentEntity.setChannelName(dto.getChannelName());

        contentRepository.save(contentEntity);

        // â­ ì¥ë¥´ í¬í•¨ ì‹œ ìˆ˜ì •
        if (dto.getGenres() != null) {
            updateGenres(id, dto.getGenres()); // â¬…ï¸ ì¶”ê°€
        }

        return modelMapper.map(contentEntity, ContentCreateDTO.class);
    }

    /**
     * âœ… ì½˜í…ì¸  ì‚­ì œ (ì—°ê´€ ì¥ë¥´ë„ í•¨ê»˜ ì‚­ì œ)
     */
    public void delete(Integer id) {
        ContentEntity content = contentRepository.findById(id)
            .orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + id));

        contentGenreRepository.deleteByContent(content); // ğŸ“Œ ì—°ê´€ ì¥ë¥´ ë¨¼ì € ì‚­ì œ
        contentRepository.delete(content);               // ğŸ“Œ ì½˜í…ì¸  ì‚­ì œ
    }

    /**
     * âœ… ìƒì„¸ ì •ë³´ êµ¬ì„± (Gallery, Video, ì™¸ë¶€ ë§í¬ í¬í•¨)
     */
    public ContentDetailDTO getContentDetail(Integer contentId) {
        ContentDetailDTO contentDetail = new ContentDetailDTO();

        ContentResponseDTO contentResponseDTO = contentRepository.findContentWithAvgRating(contentId);
        List<GenreDTO> genres = contentGenreRepository.findByContentId(contentId);
        genres.forEach(genre -> contentResponseDTO.getGenres().add(genre.getGenre().getGenreName()));
        contentDetail.setContentInfo(contentResponseDTO);

        contentDetail.setGallery(galleryRepository.findByContentId(contentId));
        contentDetail.setVideos(videoRepository.findByContentId(contentId));
        contentDetail.setExternalServices(externalServiceRepository.findByContentId(contentId));

        return contentDetail;
    }

    /**
     * âœ… ì½˜í…ì¸ ì— ì¥ë¥´ ì¶”ê°€
     */
    @Transactional
    public void addGenres(Integer contentId, List<Genre> genres) {
        ContentEntity content = contentRepository.findById(contentId)
            .orElseThrow(() -> new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜í…ì¸  ID: " + contentId));

        List<Genre> existingGenres = getGenresByContentId(contentId);

        for (Genre genre : genres) {
            if (!existingGenres.contains(genre)) {
                ContentGenreEntity contentGenre = new ContentGenreEntity();
                contentGenre.setContent(content);
                contentGenre.setGenre(genre);
                contentGenreRepository.save(contentGenre);
            }
        }
    }

    /**
     * âœ… ì½˜í…ì¸  ì¥ë¥´ ìˆ˜ì • (ê¸°ì¡´ ì‚­ì œ í›„ ë‹¤ì‹œ ë“±ë¡)
     */
    @Transactional
    public void updateGenres(Integer contentId, List<Genre> newGenres) {
        ContentEntity content = contentRepository.findById(contentId)
            .orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));

        contentGenreRepository.deleteByContent(content);

        for (Genre genre : newGenres) {
            ContentGenreEntity contentGenre = new ContentGenreEntity();
            contentGenre.setContent(content);
            contentGenre.setGenre(genre);
            contentGenreRepository.save(contentGenre);
        }
    }

    /**
     * âœ… ì½˜í…ì¸  IDë¡œ ì¥ë¥´ ì¡°íšŒ
     */
    public List<Genre> getGenresByContentId(Integer contentId) {
        ContentEntity content = contentRepository.findById(contentId)
            .orElseThrow(() -> new NoSuchElementException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));

        return contentGenreRepository.findByContent(content).stream()
            .map(ContentGenreEntity::getGenre)
            .collect(Collectors.toList());
    }

    /**
     * âš ï¸ í‰ì  ë“±ë¡/ìˆ˜ì • â†’ ì €ì¥ ëˆ„ë½ë¨
     */
    public void rateContent(Integer userId, Integer contentId, Integer score) {
        Optional<RatingEntity> existingRating = ratingRepository.findByUserIdAndContentId(userId, contentId);

        if (existingRating.isEmpty()) {
            RatingEntity ratingEntity = new RatingEntity();
            ratingEntity.setUser(userRepository.findById(userId).orElseThrow());
            ratingEntity.setContent(contentRepository.findById(contentId).orElseThrow());
            ratingEntity.setScore(score);
            ratingRepository.save(ratingEntity); // âœ… ì €ì¥ ì¶”ê°€
        } else {
            RatingEntity ratingEntity = existingRating.get();
            ratingEntity.setScore(score);
            ratingRepository.save(ratingEntity); // âœ… ìˆ˜ì • ì €ì¥ ì¶”ê°€
        }
    }
}
âœ… ìš”ì•½: ê¼­ ìˆ˜ì •í•´ì•¼ í•  í•­ëª©
í•­ëª©	ì„¤ëª…	ì¡°ì¹˜
rateContent() ì €ì¥ ëˆ„ë½	ë³„ì  ë“±ë¡ í›„ ì €ì¥ ì•ˆ í•¨	ratingRepository.save() ì¶”ê°€
update() ë°©ì‹	modelMapper.map() ë§ê³  findById()ë¡œ ì¡°íšŒ í›„ ìˆ˜ì •	í•„ìˆ˜ ìˆ˜ì •
ì¥ë¥´ ì²˜ë¦¬	create()ì™€ update()ì—ì„œ ì¥ë¥´ ë“±ë¡/ìˆ˜ì • í¬í•¨ í•„ìš”	ì„ íƒ ê¶Œì¥
ì¤‘ë³µ import	ContentCreateDTO, ContentGenreRepository ë“±	ì œê±° ê¶Œì¥
í•„ìš”í•˜ì‹œë©´ ìœ„ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” DTOë‚˜ Mapper ì„¤ì •ë„ ì¶”ê°€ë¡œ ë„ì™€ë“œë¦´ê²Œìš”.
ë˜í•œ Video ë“±ë¡/ìˆ˜ì • ê¸°ëŠ¥ì„ ë³„ë„ Serviceë¡œ ë¶„ë¦¬í• ì§€ë„ ê³ ë ¤í•´ë³´ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

ë‚˜ì˜ ë§:
Video ë“±ë¡/ìˆ˜ì • ê¸°ëŠ¥ ìœ„ì˜ service ì¶”ê°€ìë£Œ ìš”ì²­
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤! ìœ„ì— ê¸°ë°˜í•˜ì—¬ Video ë“±ë¡/ìˆ˜ì • ê¸°ëŠ¥ì„ ìœ„í•œ Service í´ë˜ìŠ¤ ìë£Œë¥¼ ì•„ë˜ì— ì‘ì„±í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

âœ… 1. í•„ìš”í•œ ì „ì œ
ì´ë¯¸ VideoEntity, VideoDTO, VideoRepositoryëŠ” ì¡´ì¬í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

ì˜ìƒì€ íŠ¹ì • ContentEntityì— ì¢…ì†ë¨ â†’ content_idë¡œ ì—°ê´€ ì„¤ì • í•„ìš”.

âœ… 2. VideoService í´ë˜ìŠ¤ ì˜ˆì‹œ
package com.example.itview_spring.Service;

import com.example.itview_spring.DTO.VideoDTO;
import com.example.itview_spring.Entity.ContentEntity;
import com.example.itview_spring.Entity.VideoEntity;
import com.example.itview_spring.Repository.ContentRepository;
import com.example.itview_spring.Repository.VideoRepository;
import lombok.RequiredArgsConstructor;
import org.modelmapper.ModelMapper;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Transactional
public class VideoService {

    private final VideoRepository videoRepository;
    private final ContentRepository contentRepository;
    private final ModelMapper modelMapper;

    /**
     * âœ… íŠ¹ì • ì½˜í…ì¸ ì˜ ë¹„ë””ì˜¤ ì „ì²´ ëª©ë¡ ì¡°íšŒ
     */
    public List<VideoDTO> getVideosByContentId(Integer contentId) {
        return videoRepository.findByContentId(contentId).stream()
                .map(video -> modelMapper.map(video, VideoDTO.class))
                .collect(Collectors.toList());
    }

    /**
     * âœ… ë¹„ë””ì˜¤ ë‹¨ê±´ ì¡°íšŒ
     */
    public VideoDTO getVideoById(Integer videoId) {
        VideoEntity video = videoRepository.findById(videoId)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤. ID: " + videoId));
        return modelMapper.map(video, VideoDTO.class);
    }

    /**
     * âœ… ë¹„ë””ì˜¤ ë“±ë¡
     */
    public VideoDTO createVideo(Integer contentId, VideoDTO dto) {
        ContentEntity content = contentRepository.findById(contentId)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤. ID: " + contentId));

        VideoEntity video = modelMapper.map(dto, VideoEntity.class);
        video.setContent(content); // ì—°ê´€ê´€ê³„ ì„¤ì •

        videoRepository.save(video);

        return modelMapper.map(video, VideoDTO.class);
    }

    /**
     * âœ… ë¹„ë””ì˜¤ ìˆ˜ì •
     */
    public VideoDTO updateVideo(Integer videoId, VideoDTO dto) {
        VideoEntity video = videoRepository.findById(videoId)
                .orElseThrow(() -> new NoSuchElementException("í•´ë‹¹ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤. ID: " + videoId));

        // ìˆ˜ì • ê°€ëŠ¥í•œ í•„ë“œë§Œ ì—…ë°ì´íŠ¸
        video.setTitle(dto.getTitle());
        video.setImage(dto.getImage());
        video.setUrl(dto.getUrl());

        return modelMapper.map(video, VideoDTO.class);
    }

    /**
     * âœ… ë¹„ë””ì˜¤ ì‚­ì œ
     */
    public void deleteVideo(Integer videoId) {
        if (!videoRepository.existsById(videoId)) {
            throw new NoSuchElementException("ì‚­ì œí•  ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤. ID: " + videoId);
        }
        videoRepository.deleteById(videoId);
    }
}
âœ… 3. VideoDTO ì˜ˆì‹œ (í™•ì¸ìš©)
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class VideoDTO {
private Integer id;
private String title;
private String image;
private String url;
}
âœ… 4. ì¶”ê°€ ì¶”ì²œ
ê´€ë¦¬ì í™”ë©´ì—ì„œ ì˜ìƒ ì¶”ê°€ ì‹œ contentIdëŠ” í•„ìˆ˜ë¡œ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ @RequestParam ë˜ëŠ” URL ê²½ë¡œë¡œ contentIdë¥¼ ì „ë‹¬í•˜ë„ë¡ ì„¤ê³„í•˜ì„¸ìš”.

ì˜ìƒ ë“±ë¡/ìˆ˜ì • ì‹œ Validation(@Valid, @NotBlank)ë„ ê³ ë ¤í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.

í•„ìš”í•˜ì‹œë©´ Controller ì˜ˆì œ, ë˜ëŠ” ë“±ë¡/ìˆ˜ì • í™”ë©´ê³¼ ì—°ê²°í•˜ëŠ” API ë¬¸ì„œë„ í•¨ê»˜ ì‘ì„±í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ì›í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
package com.example.itview_spring.Controller.Content;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.PageInfoDTO;
import com.example.itview_spring.Service.ContentService;
import com.example.itview_spring.Util.PageInfo;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.web.servlet.error.ErrorController;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.springframework.data.jpa.domain.AbstractPersistable_.id;

@Controller
@RequiredArgsConstructor
public class ContentController {
private final ContentService contentService;
private final PageInfo pageInfo;

    // ==================== ERROR PAGE HANDLER ====================
    //    500 ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ ì»¤ìŠ¤í…€ ì˜¤ë¥˜ í˜ì´ì§€ ì¶”ê°€ ê°€ëŠ¥ (ì„ íƒ ì‚¬í•­)-----------------------------------
//    @Controller
//    public class CustomErrorController implements ErrorController {
//        @RequestMapping("/error")
//        public String handleError() {
//            return "error/customError"; // templates/error/customError.html
//        }
//    }
// ==================== CONTENT CRUD ==========================
// ë“±ë¡ í¼ ì´ë™
@GetMapping("/content/register")
public String newContent() {

        return "content/register";
    }

    // ë“±ë¡ ì²˜ë¦¬ í›„ â†’ ì¥ë¥´ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™
    @PostMapping("/content/register")
    public String newContent(ContentCreateDTO contentDTO) {
        //ë°ì´í„° ì €ì¥ì²˜ë¦¬ (Service -> Controller
        ContentCreateDTO savedContent = contentService.create(contentDTO); // ì €ì¥ í›„

        System.out.println(" 00 savedContent ==" + savedContent);
        return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ë“±ë¡ í¼ìœ¼ë¡œ ì´ë™
        //   return "redirect:/content/list";
    }


    //localhost:8080/content/list í™•ì¸í•¨(@GetMppping
    //ì „ì²´ê°•ì˜ ì¡°íšŒí›„ (list.html)ë¡œì´ë™

    /**
     * ì „ì²´ì¡°íšŒ
     *
     * @param pageable ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸
     * @param model    ê²°ì¢Œ ì „ë‹¬
     * @return í˜ì´ì§€ ì´ë™
     */
    @GetMapping("/content/list")
    // ì „ì²´ ëª©ë¡ ì¡°íšŒ
    public String listContent(@PageableDefault(page = 1) Pageable pageable, Model model) {
        //ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ
        //keyword  ì¶”ê°€ ****
        Page<ContentCreateDTO> contentDTOS = contentService.getAllContents(pageable);
        model.addAttribute("contentDTOS", contentDTOS);
        //    System.out.println("contentDTO.            ==", contentDTOS);

        PageInfoDTO pageInfoDTO = pageInfo.getPageInfo(contentDTOS);
        model.addAttribute("pageInfoDTO", pageInfoDTO);
//        model.addAttribute("contentDTOS", contentDTOS);
//        model.addAttribute("pageInfoDTO", pageInfo.getPageInfo(contentDTOS));
return "content/list";
}

    // ìƒì„¸ ë³´ê¸°
// @GetMapping("/content/{id:\\d+}")
//    @GetMapping("/content/detail")
//    @GetMapping("/content/{id}/detail")
//    public String detailContent(@PathVariable("id") Integer id, Model model) {
@GetMapping("/content/detail")
public String detailContent(Integer id, Model model) {
// URL ê²½ë¡œ ë³€ìˆ˜ì¸ {id}ë¥¼ ë°›ìœ¼ë ¤ë©´ @PathVariableì„ ì¨ì•¼ í•©ë‹ˆë‹¤.
ContentCreateDTO contentDTO = contentService.read(id);
model.addAttribute("contentDTO", contentDTO);
System.out.println("deteil id         ===>" + id);
System.out.println("deteil contentDTO ===>" + contentDTO);
return "content/detail"; // ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸ í•„ìš”
}

//
//    @GetMapping("/content/{id:\\d+}")
//    public String detail(@RequestParam("id") Integer id, Model model) {
//        ContentDetailDTO detailDTO = contentService.getContentDetail(id);
//        model.addAttribute("contentDTO", detailDTO.getContentInfo()); // ContentResponseDTO
//        model.addAttribute("gallery", detailDTO.getGallery());
//        model.addAttribute("videos", detailDTO.getVideos());
//        model.addAttribute("externalServices", detailDTO.getExternalServices());
//        return "content/detail";
//    }

    // ìˆ˜ì • í¼
    @GetMapping("/content/{id}/update")
    public String updateContent(@PathVariable("id") Integer id, Model model) {
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);
        return "content/update";
    }

    // ìˆ˜ì • ì²˜ë¦¬ (â†’ ì¥ë¥´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸)
    @PostMapping("/content/{id}/update")
    public String updateContentProc(@PathVariable("id") Integer id, ContentCreateDTO contentDTO) {
//        contentService.update(id, contentDTO);
//        return "redirect:/content/list";
ContentCreateDTO savedContent = contentService.update(id, contentDTO);
System.out.println(" 22 savedContent ==" + savedContent);
return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ìˆ˜ì • í¼ìœ¼ë¡œ ì´ë™
}

    //ì‚­ì œì²˜ë¦¬
    @GetMapping("/content/delete")
    public String deleteContent(@RequestParam("id") Integer id) {
        contentService.delete(id);
        return "redirect:/content/list";
    }

    // ==================== GENRE HANDLING ========================
    //ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì • í˜ì´ì§€ {/content/{id}/genre)
    // ì¥ë¥´ ì„ íƒ/ìˆ˜ì • í¼
    @GetMapping("/content/{contentId}/genre")

    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);

        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì´ ë©”ì„œë“œê°€ Enum List ë°˜í™˜
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList(); // âœ… ë³€í™˜

        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", Genre.values());
//        model.addAttribute("selectedGenres", genreService.getSelectedGenreNames(contentId));  // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í‘œì‹œ
//        model.addAttribute("genreTranslations", genreService.getGenreTranslations()); // í•œê¸€ ì´ë¦„ ë§µí•‘

        // í•´ë‹¹ contentIdë¡œ ContentDTO, ëª¨ë“  ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì¥ë¥´ ë²ˆì—­ ë“±ì„ ëª¨ë¸ì— ì¶”ê°€
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenres);

        Genre[] allGenres = Genre.values();

//        Map<String, String> genreTranslations = Map.of(
//                "ACTION", "ì•¡ì…˜",
//                "DRAMA", "ë“œë¼ë§ˆ",
//                "ROMANCE", "ë¡œë§¨ìŠ¤",
//                "HORROR", "í˜¸ëŸ¬",
//                "THRILLER", "ìŠ¤ë¦´ëŸ¬",
//                "COMEDY", "ì½”ë¯¸ë””",
//                "FANTASY", "íŒíƒ€ì§€",
//                "ADVENTURE", "ì–´ë“œë²¤ì²˜",
//                "NATURAL_SCIENCE", "ìì—°ê³¼í•™",
//                "KPOP", "K-POP",
//                "ANIMATION","ì• ë‹ˆë©”ì´ì…˜",
//                "SPORTS", "ìŠ¤í¬ì¸ ",
//                "MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬",
//                "DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬",
//                "SF", "SF",
//                "MUSIC", "ìŒì•…",
//                "FAMILY", "ê°€ì¡±",
//                "CONCERT", "ê³µì—°ì‹¤í™©",
//                "MUSICAL", "ë®¤ì§€ì»¬",
//                "BIOPIC", "ì „ê¸°",
//                "HISTORY", "ì—­ì‚¬",
//                "CRIME", "ë²”ì£„",
//                "KIDS", "í‚¤ì¦ˆ",
//                "VARIETY", "ì˜ˆëŠ¥",
//                "SITCOM", "ì‹œíŠ¸ì½¤",
//                "PERIOD", "ì‹œëŒ€ê·¹",
//                "ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””",
//                "BL", "BL",
//                "TEENAGER", "í‹´ì—ì´ì €",
//                "DISASTER", "ì¬ë‚œ",
//                "COMICS", "ë§Œí™”",
//                "HUMANITIES", "ì¸ë¬¸í•™",
//                "ECONOMICS", "ê²½ì œì„œ",
//                "INVESTMENT", "íˆ¬ìì„œ",
//                "NOVEL", "ì†Œì„¤",
//                "ESSAY", "ì—ì„¸ì´",
//                "SELF_HELP", "ìê¸°ê³„ë°œ",
//                "WAR", "ì „ìŸ",
//                "PLAY", "í¬ê³¡",
//                "POETRY", "ì‹œ",
//                "SLICE_OF_LIFE", "ì¼ìƒ",
//                "HIP_HOP", "í™í•©",
//                "POP", "íŒ",
//                "MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…",
//                "TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…",
//                "BALLAD", "ë°œë¼ë“œ",
//                "DANCE", "ëŒ„ìŠ¤",
//                "ROCK", "ë¡",
//                "CLASSICAL", "í´ë˜ì‹",
//                "INDIE", "ì¸ë””",
//                "ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´",
//                "JPOP", "JPOP",
//                "RNB", "ì•Œì•¤ë¹„",
//                "TROT", "íŠ¸ë¡œíŠ¸"
//        );
Map<String, String> genreTranslations = Map.of(
"ACTION", "ì•¡ì…˜",
"DRAMA", "ë“œë¼ë§ˆ",
"ROMANCE", "ë¡œë§¨ìŠ¤",
"HORROR", "í˜¸ëŸ¬",
"THRILLER", "ìŠ¤ë¦´ëŸ¬",
"COMEDY", "ì½”ë¯¸ë””",
"FANTASY", "íŒíƒ€ì§€",
"ADVENTURE", "ì–´ë“œë²¤ì²˜",
"NATURAL_SCIENCE", "ìì—°ê³¼í•™",
"KPOP", "K-POP"

        );
        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + allGenres);
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");


        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenres);
        model.addAttribute("genreTranslations", genreTranslations);

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ HTML
    }
    //********************************************************************************//

    //********************************************************************************//
    // ì¥ë¥´ ì €ì¥
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {
        if (contentId == null) {
            contentService.addGenres(contentId, genres != null ? genres :
                    List.of());
            genres = new ArrayList<>();
            System.out.println(" post null contentId  ==" + contentId);
            System.out.println(" post null genress    ==" + genres);
            System.out.println(" ---------------------");
        }

        System.out.println(" post44 contentId  ==" + contentId);
        System.out.println(" post44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸
        contentService.updateGenres(contentId, genres);

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)


        Genre[] allGenres = Genre.values();
        Map<String, String> genreTranslations = Map.of(
                "ACTION", "ì•¡ì…˜",
                "DRAMA", "ë“œë¼ë§ˆ",
                "ROMANCE", "ë¡œë§¨ìŠ¤",
                "HORROR", "í˜¸ëŸ¬",
                "THRILLER", "ìŠ¤ë¦´ëŸ¬",
                "COMEDY", "ì½”ë¯¸ë””",
                "FANTASY", "íŒíƒ€ì§€",
                "ADVENTURE", "ì–´ë“œë²¤ì²˜",
                "NATURAL_SCIENCE", "ìì—°ê³¼í•™",
                "KPOP", "K-POP"
        );

        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenreNames);
        model.addAttribute("genreTranslations", genreTranslations);

        return "redirect:/content/" + contentId + "/genre";

    }

} ìˆ˜ì •í• ê³³ê³¼ ì£¼ìš”ì‚¬í•­ ì˜†ì— ì£¼ì„ ì‘ì„±í•´ì¤˜
ChatGPTì˜ ë§:
ì½”ë“œì— ì£¼ìš”ì‚¬í•­ê³¼ ìˆ˜ì •í•  ë¶€ë¶„ì„ ì£¼ì„ìœ¼ë¡œ ë‹¬ì•„ ë“œë¦´ê²Œìš”.
ì¤‘ë³µ ì½”ë“œ, ë¡œì§ ìœ„ì¹˜, null ì²´í¬, ëª¨ë¸ ë°ì´í„° ì„¸íŒ… ë¶€ë¶„ ë“± ìœ„ì£¼ë¡œ ë‹¬ì•˜ìŠµë‹ˆë‹¤.

package com.example.itview_spring.Controller.Content;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.PageInfoDTO;
import com.example.itview_spring.Service.ContentService;
import com.example.itview_spring.Util.PageInfo;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.web.servlet.error.ErrorController;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.springframework.data.jpa.domain.AbstractPersistable_.id;

@Controller
@RequiredArgsConstructor
public class ContentController {
private final ContentService contentService;
private final PageInfo pageInfo;

    // ==================== ERROR PAGE HANDLER ====================
    // 500 ì—ëŸ¬ìš© ì»¤ìŠ¤í…€ í˜ì´ì§€ ì£¼ì„ ì²˜ë¦¬í•´ë‘  (í•„ìš”ì‹œ í™œì„±í™”)
    /*
    @Controller
    public class CustomErrorController implements ErrorController {
        @RequestMapping("/error")
        public String handleError() {
            return "error/customError"; // templates/error/customError.html
        }
    }
    */

    // ==================== CONTENT CRUD ==========================
    // ë“±ë¡ í¼ ì´ë™
    @GetMapping("/content/register")
    public String newContent() {
        return "content/register";
    }

    // ë“±ë¡ ì²˜ë¦¬ í›„ â†’ ì¥ë¥´ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™
    @PostMapping("/content/register")
    public String newContent(ContentCreateDTO contentDTO) {
        // ë°ì´í„° ì €ì¥ ì²˜ë¦¬ (Service -> Controller)
        ContentCreateDTO savedContent = contentService.create(contentDTO); // ì €ì¥ í›„

        System.out.println(" 00 savedContent ==" + savedContent);
        return "redirect:/content/" + savedContent.getId() + "/genre"; // ë“±ë¡ í›„ ì¥ë¥´ í¼ ì´ë™
        // return "redirect:/content/list"; // ë¦¬ìŠ¤íŠ¸ ì´ë™ ì˜µì…˜ (í˜„ì¬ëŠ” ì¥ë¥´ ì„ íƒ ìš°ì„ )
    }


    // ì „ì²´ê°•ì˜ ì¡°íšŒ í›„ list.htmlë¡œ ì´ë™
    /**
     * ì „ì²´ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ
     * @param pageable í˜ì´ì§• ì •ë³´ (ê¸°ë³¸ í˜ì´ì§€ 1)
     * @param model ë·°ì— ì „ë‹¬í•  ëª¨ë¸
     * @return list ë·°
     */
    @GetMapping("/content/list")
    public String listContent(@PageableDefault(page = 1) Pageable pageable, Model model) {
        // ëª¨ë“  ë°ì´í„°ë¥¼ í˜ì´ì§• ì¡°íšŒ
        Page<ContentCreateDTO> contentDTOS = contentService.getAllContents(pageable);
        model.addAttribute("contentDTOS", contentDTOS);

        // í˜ì´ì§€ ì •ë³´ ìƒì„± í›„ ëª¨ë¸ì— ì¶”ê°€
        PageInfoDTO pageInfoDTO = pageInfo.getPageInfo(contentDTOS);
        model.addAttribute("pageInfoDTO", pageInfoDTO);

        return "content/list";
    }

    // ìƒì„¸ ë³´ê¸° (id íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ, @PathVariable ëŒ€ì‹  @RequestParam í˜•ì‹)
    @GetMapping("/content/detail")
    public String detailContent(Integer id, Model model) {
        // URL ê²½ë¡œ ë³€ìˆ˜ë¡œ ë°›ëŠ”ê²Œ ì¼ë°˜ì ì„(@PathVariable ì¶”ì²œ)
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);

        System.out.println("detail id         ===>" + id);
        System.out.println("detail contentDTO ===>" + contentDTO);

        return "content/detail"; // ë·° ê²½ë¡œ í™•ì¸ í•„ìš”
    }

    // ìˆ˜ì • í¼ ì´ë™
    @GetMapping("/content/{id}/update")
    public String updateContent(@PathVariable("id") Integer id, Model model) {
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);
        return "content/update";
    }

    // ìˆ˜ì • ì²˜ë¦¬ (ì¥ë¥´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸)
    @PostMapping("/content/{id}/update")
    public String updateContentProc(@PathVariable("id") Integer id, ContentCreateDTO contentDTO) {
        // Serviceì—ì„œ ìˆ˜ì • ì²˜ë¦¬ í›„ ì €ì¥ëœ DTO ë°˜í™˜ ë°›ìŒ
        ContentCreateDTO savedContent = contentService.update(id, contentDTO);
        System.out.println(" 22 savedContent ==" + savedContent);
        // ìˆ˜ì • í›„ ë°”ë¡œ ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
        return "redirect:/content/" + savedContent.getId() + "/genre";
    }

    // ì‚­ì œ ì²˜ë¦¬ (idë¥¼ @RequestParam ìœ¼ë¡œ ë°›ìŒ)
    @GetMapping("/content/delete")
    public String deleteContent(@RequestParam("id") Integer id) {
        contentService.delete(id);
        return "redirect:/content/list";
    }

    // ==================== GENRE HANDLING ========================

    // ì¥ë¥´ ì„ íƒ/ìˆ˜ì • í¼
    @GetMapping("/content/{contentId}/genre")
    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);

        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList();

        // ì¤‘ë³µëœ addAttribute ì œê±° (allGenres 2ë²ˆ, contentId 2ë²ˆ ì¶”ê°€ë¨ â†’ ì•„ë˜ìª½ í•˜ë‚˜ë§Œ ìœ ì§€í•˜ëŠ”ê²Œ ì¢‹ìŒ)
        model.addAttribute("contentId", contentId);
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenres);

        // ì¥ë¥´ í•œê¸€ëª… ë§¤í•‘ - Map.of() ì‚¬ìš©
        Map<String, String> genreTranslations = Map.of(
                "ACTION", "ì•¡ì…˜",
                "DRAMA", "ë“œë¼ë§ˆ",
                "ROMANCE", "ë¡œë§¨ìŠ¤",
                "HORROR", "í˜¸ëŸ¬",
                "THRILLER", "ìŠ¤ë¦´ëŸ¬",
                "COMEDY", "ì½”ë¯¸ë””",
                "FANTASY", "íŒíƒ€ì§€",
                "ADVENTURE", "ì–´ë“œë²¤ì²˜",
                "NATURAL_SCIENCE", "ìì—°ê³¼í•™",
                "KPOP", "K-POP"
        );

        // ë””ë²„ê¹…ìš© ì¶œë ¥ (í•„ìš” ì—†ìœ¼ë©´ ì‚­ì œ ê°€ëŠ¥)
        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + Arrays.toString(Genre.values()));
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");

        model.addAttribute("genreTranslations", genreTranslations);

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ í™”ë©´
    }


    // ì¥ë¥´ ì €ì¥ ì²˜ë¦¬
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {
        // [ìˆ˜ì •í•„ìš”] contentId null ì²´í¬ê°€ ì´ìƒí•¨ â†’ nullì´ë©´ ì²˜ë¦¬ ì•ˆë˜ë„ë¡ ìˆ˜ì • í•„ìš”
        if (contentId == null) {
            // contentIdê°€ nullì¸ë° serviceì— ë„˜ê¸°ê³  ìˆìŒ â†’ NullPointerException ìœ„í—˜
            // ì•„ë˜ ë¡œì§ì€ contentIdê°€ nullì¼ ë•ŒëŠ” ë™ì‘í•˜ì§€ ì•Šë„ë¡ ë¶„ê¸° ìˆ˜ì • í•„ìš”
            contentService.addGenres(contentId, genres != null ? genres : List.of());
            genres = new ArrayList<>();
            System.out.println(" post null contentId  ==" + contentId);
            System.out.println(" post null genress    ==" + genres);
            System.out.println(" ---------------------");
        }

        // ì •ìƒ ë¡œì§
        System.out.println(" post44 contentId  ==" + contentId);
        System.out.println(" post44 genress    ==" + genres);
        System.out.println(" ---------------------");

        // ì¥ë¥´ ì—…ë°ì´íŠ¸ ì„œë¹„ìŠ¤ í˜¸ì¶œ (nullì¼ ê°€ëŠ¥ì„± ì œê±° í›„ í˜¸ì¶œ ê¶Œì¥)
        contentService.updateGenres(contentId, genres);

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš©ì„ ë‹¤ì‹œ ì½ì–´ì„œ ëª¨ë¸ì— ë‹´ìŒ (í•˜ì§€ë§Œ ì´ ë©”ì„œë“œëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ëª¨ë¸ê°’ ì „ë‹¬ ì•ˆë¨)
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());

        // ëª¨ë¸ì— ë‹¤ì‹œ ë‹´ëŠ”ë° â†’ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œ ëª¨ë¸ê°’ì´ ìœ ì§€ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ URLë¡œë§Œ ì²˜ë¦¬í•˜ë©´ ë¨
        Genre[] allGenres = Genre.values();
        Map<String, String> genreTranslations = Map.of(
                "ACTION", "ì•¡ì…˜",
                "DRAMA", "ë“œë¼ë§ˆ",
                "ROMANCE", "ë¡œë§¨ìŠ¤",
                "HORROR", "í˜¸ëŸ¬",
                "THRILLER", "ìŠ¤ë¦´ëŸ¬",
                "COMEDY", "ì½”ë¯¸ë””",
                "FANTASY", "íŒíƒ€ì§€",
                "ADVENTURE", "ì–´ë“œë²¤ì²˜",
                "NATURAL_SCIENCE", "ìì—°ê³¼í•™",
                "KPOP", "K-POP"
        );

        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenreNames);
        model.addAttribute("genreTranslations", genreTranslations);

        // [ê¶Œì¥] ì—¬ê¸°ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ì‹œ ëª¨ë¸ ë°ì´í„°ëŠ” ì˜ë¯¸ì—†ìœ¼ë¯€ë¡œ ë°”ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë§Œ ë‚¨ê¹€
        return "redirect:/content/" + contentId + "/genre";
    }

}
ì£¼ìš” ìˆ˜ì •/í™•ì¸ ì‚¬í•­
ì¤‘ë³µëœ model.addAttribute ì œê±°:
showGenreForm()ì—ì„œ contentId, allGenresë¥¼ ë‘ ë²ˆì”© ë„£ëŠ” ë¶€ë¶„ ì •ë¦¬ ê¶Œì¥.

contentId == null ì²´í¬ ë¡œì§ ìˆ˜ì • í•„ìš”:
submitGenres()ì—ì„œ contentIdê°€ nullì¼ ë•Œ ë™ì‘í•˜ëŠ” ë¶€ë¶„ì€ ë…¼ë¦¬ìƒ ë§ì§€ ì•ŠìŒ. ì‹¤ì œë¡œ nullì´ë©´ ì²˜ë¦¬ ì¤‘ë‹¨ ë˜ëŠ” 400 ì˜¤ë¥˜ ì²˜ë¦¬ ì¶”ì²œ.

submitGenres()ì—ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œ ëª¨ë¸ê°’ ì˜ë¯¸ ì—†ìŒ:
ë¦¬ë‹¤ì´ë ‰íŠ¸ëŠ” ìƒˆë¡œìš´ ìš”ì²­ì´ë¯€ë¡œ ëª¨ë¸ê°’ì´ ìœ ì§€ë˜ì§€ ì•ŠìŒ. ë¶ˆí•„ìš”í•œ ëª¨ë¸ ì„¸íŒ…ì€ ì‚­ì œí•´ë„ ë¬´ë°©.

detailContent()ì—ì„œ @PathVariable ì‚¬ìš© ê¶Œì¥:
URL ê²½ë¡œ ë³€ìˆ˜ë¡œ id ë°›ëŠ” ê²Œ ëª…í™•. í˜„ì¬ëŠ” Integer idë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ.

genreTranslations ë§µì€ ì¤‘ë³µ ì •ì˜:
ë§µì„ í´ë˜ìŠ¤ ìƒë‹¨ ìƒìˆ˜ë¡œ ëº„ì§€, ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ê´€ë¦¬í•˜ëŠ”ê²Œ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ìŒ.

ë””ë²„ê¹…ìš© System.out.println ì œê±° ê³ ë ¤:
í•„ìš”ì‹œ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¶Œì¥.

í•„ìš”í•˜ë©´ submitGenres null ì²˜ë¦¬ ê°œì„  ì˜ˆì‹œë‚˜, detailContent ìˆ˜ì • ì˜ˆì‹œë„ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”!

ë‚˜ì˜ ë§:
Map<String, String> genreTranslations = Map.of(
"ACTION", "ì•¡ì…˜",
"DRAMA", "ë“œë¼ë§ˆ",
"ROMANCE", "ë¡œë§¨ìŠ¤",
"HORROR", "í˜¸ëŸ¬",
"THRILLER", "ìŠ¤ë¦´ëŸ¬",
"COMEDY", "ì½”ë¯¸ë””",
"FANTASY", "íŒíƒ€ì§€",
"ADVENTURE", "ì–´ë“œë²¤ì²˜",
"NATURAL_SCIENCE", "ìì—°ê³¼í•™",
"KPOP", "K-POP",
"ANIMATION","ì• ë‹ˆë©”ì´ì…˜",
"SPORTS", "ìŠ¤í¬ì¸ ",
"MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬",
"DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬",
"SF", "SF",
"MUSIC", "ìŒì•…",
"FAMILY", "ê°€ì¡±",
"CONCERT", "ê³µì—°ì‹¤í™©",
"MUSICAL", "ë®¤ì§€ì»¬",
"BIOPIC", "ì „ê¸°",
"HISTORY", "ì—­ì‚¬",
"CRIME", "ë²”ì£„",
"KIDS", "í‚¤ì¦ˆ",
"VARIETY", "ì˜ˆëŠ¥",
"SITCOM", "ì‹œíŠ¸ì½¤",
"PERIOD", "ì‹œëŒ€ê·¹",
"ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””",
"BL", "BL",
"TEENAGER", "í‹´ì—ì´ì €",
"DISASTER", "ì¬ë‚œ",
"COMICS", "ë§Œí™”",
"HUMANITIES", "ì¸ë¬¸í•™",
"ECONOMICS", "ê²½ì œì„œ",
"INVESTMENT", "íˆ¬ìì„œ",
"NOVEL", "ì†Œì„¤",
"ESSAY", "ì—ì„¸ì´",
"SELF_HELP", "ìê¸°ê³„ë°œ",
"WAR", "ì „ìŸ",
"PLAY", "í¬ê³¡",
"POETRY", "ì‹œ",
"SLICE_OF_LIFE", "ì¼ìƒ",
"HIP_HOP", "í™í•©",
"POP", "íŒ",
"MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…",
"TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…",
"BALLAD", "ë°œë¼ë“œ",
"DANCE", "ëŒ„ìŠ¤",
"ROCK", "ë¡",
"CLASSICAL", "í´ë˜ì‹",
"INDIE", "ì¸ë””",
"ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´",
"JPOP", "JPOP",
"RNB", "ì•Œì•¤ë¹„",
"TROT", "íŠ¸ë¡œíŠ¸");  ìˆ˜ì •í• ê³³ì€
ChatGPTì˜ ë§:
ì´ genreTranslations Mapì€ ì¥ë¥´(enum ì´ë¦„)ì™€ í•œê¸€ ë²ˆì—­ì„ ë§¤í•‘í•˜ëŠ” ì—­í• ì„ í•˜ë‹ˆ, ì£¼ë¡œ ë‹¤ìŒ ë¶€ë¶„ì—ì„œ ìˆ˜ì •í•˜ê±°ë‚˜ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤:

1. ì¤‘ë³µ ì •ì˜ ë¬¸ì œ í•´ê²°
   ì½”ë“œ ë‚´ ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì¼í•œ genreTranslations Mapì„ ë°˜ë³µ ì„ ì–¸í•˜ê³  ìˆìŠµë‹ˆë‹¤.
   â†’ í•œ ê³³ì—ì„œë§Œ ì„ ì–¸í•˜ê³  ì¬ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•˜ì„¸ìš”.

2. ìƒìˆ˜ ë˜ëŠ” ë³„ë„ í´ë˜ìŠ¤ ë¶„ë¦¬ ê¶Œì¥
   ì¥ë¥´ ë²ˆì—­ì´ ë§ìœ¼ë‹ˆ, ë³„ë„ì˜ GenreTranslation ìœ í‹¸ í´ë˜ìŠ¤ í˜¹ì€ ìƒìˆ˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²Œ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ìŠµë‹ˆë‹¤.

public class GenreTranslation {
public static final Map<String, String> TRANSLATIONS = Map.ofEntries(
Map.entry("ACTION", "ì•¡ì…˜"),
Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
// ... ì´í•˜ ìƒëµ
);
}
ê·¸ë¦¬ê³  Controllerì—ì„œëŠ”

model.addAttribute("genreTranslations", GenreTranslation.TRANSLATIONS);
3. enum í™œìš© ê°€ëŠ¥ ì—¬ë¶€
   Genre enum ë‚´ë¶€ì— í•„ë“œë¡œ í•œê¸€ëª… ì €ì¥í•´ë‘ê³ , getterë¡œ êº¼ë‚´ëŠ” ë°©ì‹ë„ ê¶Œì¥

public enum Genre {
ACTION("ì•¡ì…˜"),
DRAMA("ë“œë¼ë§ˆ"),
// ...
;

    private final String koreanName;

    Genre(String koreanName) {
        this.koreanName = koreanName;
    }

    public String getKoreanName() {
        return koreanName;
    }
}
â†’ ê·¸ëŸ¬ë©´ genreTranslations Map ì—†ì´ë„ Genre.ACTION.getKoreanName() ì‹ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

4. ì‚¬ìš©ì²˜ë³„ ìˆ˜ì • í•„ìš” ìœ„ì¹˜
   showGenreForm() ë©”ì„œë“œ ë‚´ì—ì„œ Map ì •ì˜í•˜ëŠ” ë¶€ë¶„

submitGenres() ë©”ì„œë“œ ë‚´ì—ì„œ Map ì •ì˜í•˜ëŠ” ë¶€ë¶„
â†’ ìœ„ ë‘ ê³³ì—ì„œ ì¤‘ë³µ ì œê±° ë° ìœ„ 1~3ë²ˆ ë‚´ìš©ì— ë”°ë¼ ìˆ˜ì • í•„ìš”

5. ê¸°íƒ€
   Mapì— ì—†ëŠ” ì¥ë¥´ê°€ enumì— ì¶”ê°€ë˜ë©´ ëˆ„ë½ë  ìœ„í—˜ ìˆìŒ â†’ enum ë‚´ë¶€ í•„ë“œ ê´€ë¦¬ ì¶”ì²œ

Map.of()ëŠ” ìµœëŒ€ 10ê°œ ìŒê¹Œì§€ë§Œ í—ˆìš© â†’ 50ê°œ ì´ìƒì€ Map.ofEntries() ì‚¬ìš© ë˜ëŠ” HashMap ìƒì„± í›„ put() í˜¸ì¶œ ì‚¬ìš© ê¶Œì¥

ìš”ì•½
ìˆ˜ì • í¬ì¸íŠ¸	ì„¤ëª…
ì¤‘ë³µ ì œê±°	genreTranslations ì—¬ëŸ¬ ë²ˆ ì •ì˜ë˜ì–´ ìˆìŒ â†’ í•œ ê³³ìœ¼ë¡œ í†µí•©
ìƒìˆ˜í™”	ìƒìˆ˜ í´ë˜ìŠ¤ ë˜ëŠ” enum í•„ë“œë¡œ í•œê¸€ëª… ê´€ë¦¬ ê¶Œì¥
enum í•„ë“œ ì¶”ê°€	Genre enumì— í•œê¸€ëª… í•„ë“œ ì¶”ê°€í•´ì„œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì´ ê°€ì¥ ê¹”ë”
Map í¬ê¸° ì œí•œ	Map.of 10ìŒ ì œí•œì— ê±¸ë¦¼ â†’ Map.ofEntries ë“±ìœ¼ë¡œ ë³€ê²½ í•„ìš”
í•„ìš”í•˜ë©´ ìœ„ ì‘ì—…ì— ë§ê²Œ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•´ë“œë¦´ ìˆ˜ë„ ìˆì–´ìš”!

ë‚˜ì˜ ë§:
<!DOCTYPE html>
<html lang="kr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<main layout:fragment="content">
    <!--    <h1>Welcome to the Dashboard</h1>-->
    <!--    <p>This is your main content area.</p>-->

    <div class="container mt-5">
        <h2>ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì •</h2>

        <!--        <form th:action="@{|/content/${contentId}/genre|}" method="post">-->
        <form th:action="@{/content/{contentId}/genre(contentId=${contentDTO.id})}" method="post">
            <!-- âœ… CSRF í† í° ì¶”ê°€ (Spring Security ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•„ìˆ˜) -->
            <!--            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
            <input id="id" th:value="${contentDTO.id}" value="post" hidden>
            <!--            <input type="hidden" name="_method" value="post" />-->

            <div class="mb-3">
                <label class="form-label">ì¥ë¥´ ì„ íƒ</label>
                <!-- âœ… ê° ì¥ë¥´ ì²´í¬ë°•ìŠ¤ ë°˜ë³µ ì¶œë ¥ -->
                <!--                <div>-->
                <!--                    <ul>-->
                <!--                        &lt;!&ndash; ì¥ë¥´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ &ndash;&gt;-->
                <!--                        <c:forEach var="genre" items="${allGenres}">-->
                <!--                            <li>-->
                <!--                                <input type="checkbox" id="genre_${genre}" name="genres" value="${genre}"-->
                <!--                                <c:if test="${selectedGenres.contains(genre.name)}">checked</c:if> />-->
                <!--                                <label for="genre_${genre}">${genreTranslations[genre]}</label>-->
                <!--                            </li>-->
                <!--                        </c:forEach>-->
                <!--                    </ul>-->
                <!--                </div>-->
                <div class="form-check" th:each="genre : ${allGenres}">
                    <input class="form-check-input" type="checkbox" name="genres"
                           th:id="${'genre-' + genre.name()}"
                           th:value="${genre.name()}"
                           th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}"/>

                    <label class="form-check-label"
                           th:for="${'genre-' + genre.name()}"
                           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
                </div>


                <!--                       th:text="${genre.genreName}">ì¥ë¥´ëª…</label>-->

                <!-- âœ… í•œê¸€ëª… ë³€í™˜ì€ ì„ íƒì ìœ¼ë¡œ ENUMì— ë©”ì„œë“œ ì¶”ê°€ -->
                <!--                    <label class="form-check-label"-->
                <!--                           th:for="${'genre-' + genre.name()}"-->
                <!--                              th:text="${genre.genreName}">-->
                <!--                           th:text="${#strings.equalsIgnoreCase(genre.name(), 'ACTION') ? 'ì•¡ì…˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ADVENTURE') ? 'ì–´ë“œë²¤ì²˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'COMEDY') ? 'ì½”ë¯¸ë””' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'DRAMA') ? 'ë“œë¼ë§ˆ' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'THRILLER') ? 'ìŠ¤ë¦´ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'HORROR') ? 'í˜¸ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'FANTASY') ? 'íŒíƒ€ì§€' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ROMANCE') ? 'ë¡œë§¨ìŠ¤' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'NATURAL_SCIENCE') ? 'ìì—°ê³¼í•™' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'KPOP') ? 'K-POP' :-->
                <!--                                      genre.name())))))))))">-->
                <!--                            <span th:text="${genre.genreName}">ì¥ë¥´</span>-->
                <!--                            ì¥ë¥´ëª…-->
                <!--                    </label>-->

            </div>

            <button type="submit" class="btn btn-primary">ì €ì¥</button>
            <a th:href="@{/content/list}" class="btn btn-secondary">ì·¨ì†Œ</a>
        </form>
        <!-- ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° -->
        <h3>ì„ íƒí•œ ì¥ë¥´ </h3>
        <ul>
            <th:block th:each="genre : ${selectedGenres}">
                <li th:text="${genreTranslations[genre.name()]}"></li>
            </th:block>
        </ul>

<!--        &lt;!&ndash; ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° &ndash;&gt;-->
<!--        <h3>ì„ íƒëœ ì¥ë¥´</h3>-->
<!--        <ul>-->
<!--            <c:forEach var="genre" items="${selectedGenres}">-->
<!--                <li>${genre}</li>-->
<!--            </c:forEach>-->
<!--        </ul>-->
<!--        -->

    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</main>
</body>
</html>


ì´ê±¸ ìˆ˜ì •í˜ì´ì§€ë¡œ ë„˜ì–´ì™”ì„ë•Œ
ì²´í¬ë°•ìŠ¤ ì²´í¬ ë˜ì–´ìˆê²Œ ë³´ì—¬ì£¼ê³ ì‹¶ì€ë° ì–´ë–¡í• ê¹Œ

ChatGPTì˜ ë§:
ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€ë¡œ ë„˜ì–´ì™”ì„ ë•Œ, ê¸°ì¡´ì— ì„ íƒëœ ì¥ë¥´(ì¦‰, DBì— ì €ì¥ëœ ì¥ë¥´ ëª©ë¡)ê°€ ì²´í¬ë°•ìŠ¤ì— ìë™ìœ¼ë¡œ ì²´í¬ë˜ì–´ ë³´ì´ë„ë¡ í•˜ê³  ì‹¶ë‹¤ë©´, í˜„ì¬ ì½”ë“œì—ì„œë„ ê±°ì˜ ë‹¤ ì˜ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ëª‡ ê°€ì§€ ì£¼ì˜í•  ì  ë° í™•ì¸ í¬ì¸íŠ¸ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš”.

âœ… í•µì‹¬ ì •ë¦¬
í˜„ì¬ ì½”ë“œ ì¤‘ ì²´í¬ë°•ìŠ¤ ê´€ë ¨ ë¶€ë¶„:
<input class="form-check-input" type="checkbox" name="genres"
th:id="${'genre-' + genre.name()}"
th:value="${genre.name()}"
th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}"/>
ì´ í‘œí˜„ì‹ì€ ì˜¬ë°”ë¥´ê²Œ ì²´í¬ ì—¬ë¶€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.

âœ… ë‹¤ë§Œ, selectedGenresê°€ Genre íƒ€ì…ì˜ ë¦¬ìŠ¤íŠ¸ì¸ì§€, String ë¦¬ìŠ¤íŠ¸ì¸ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ğŸ” 1. selectedGenres íƒ€ì… í™•ì¸ì´ ë¨¼ì €ì…ë‹ˆë‹¤
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë„˜ê²¨ì£¼ëŠ” selectedGenresì˜ íƒ€ì…ì´ ë‹¤ìŒ ì¤‘ ì–´ëŠ ìª½ì¸ì§€ í™•ì¸í•˜ì„¸ìš”:

âœ… (1) List<Genre>ì¸ ê²½ìš°
model.addAttribute("selectedGenres", List<Genre>);
â†’ ìœ„ ì½”ë“œì—ì„œëŠ” ë‹¤ìŒì²˜ëŸ¼ ì²´í¬:

th:checked="${selectedGenres.contains(genre)}"
âŒ (2) List<String>ì¸ ê²½ìš° (genre.name() ì‚¬ìš© ì¤‘ì´ë¼ë©´ ì´ìª½ì¼ ê°€ëŠ¥ì„± í¼)
model.addAttribute("selectedGenres", List<String>);
â†’ ìœ„ ì½”ë“œì—ì„œëŠ” ë‹¤ìŒì²˜ëŸ¼ ì²´í¬:

th:checked="${selectedGenres.contains(genre.name())}"
í˜„ì¬ ì½”ë“œëŠ” ë‘ ë²ˆì§¸ ë°©ì‹ì¸ë° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë„ List<String>ìœ¼ë¡œ ë„˜ê¸°ê³  ìˆëŠ”ì§€ ê¼­ í™•ì¸í•˜ì„¸ìš”:

List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList();

model.addAttribute("selectedGenres", selectedGenreNames);
ì´ë ‡ê²Œ ë„˜ê¸°ê³  ìˆë‹¤ë©´, ì§€ê¸ˆ HTML ì½”ë“œëŠ” ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•©ë‹ˆë‹¤. (ì•„ë˜ ì˜ˆì‹œ ê¸°ì¤€)

âœ… ì „ì²´ ì²´í¬ë°•ìŠ¤ HTML ì˜ˆì‹œ (String ê¸°ë°˜ìœ¼ë¡œ ì‘ë™)
<div class="form-check" th:each="genre : ${allGenres}">
    <input class="form-check-input" type="checkbox" name="genres"
           th:id="${'genre-' + genre.name()}"
           th:value="${genre.name()}"
           th:checked="${selectedGenres.contains(genre.name())}"/>

    <label class="form-check-label"
           th:for="${'genre-' + genre.name()}"
           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
</div>
ğŸ›  ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸
ì²´í¬í•­ëª©	ì„¤ëª…
selectedGenresê°€ String ë¦¬ìŠ¤íŠ¸ì¸ê°€?	genre.name()ê³¼ ë¹„êµí•˜ê³  ìˆìœ¼ë¯€ë¡œ ê¼­ í™•ì¸ í•„ìš”
th:checked ì¡°ê±´	contains(genre.name()) ë˜ëŠ” contains(genre)
ì²´í¬ë°•ìŠ¤ì˜ value	th:value="${genre.name()}" ìœ¼ë¡œ ì¼ì¹˜í•´ì•¼ í•¨
ì„ íƒëœ ê°’ì´ ì˜ ë„˜ì–´ì˜¤ëŠ”ê°€?	submitGenres() ë©”ì„œë“œì—ì„œ ì˜ ë°›ê³  ìˆëŠ”ì§€ í™•ì¸
ğŸ§ª ë””ë²„ê¹… íŒ
í˜ì´ì§€ ì§„ì… ì‹œ ë‹¤ìŒì„ ì¶œë ¥í•´ë³´ë©´ ì²´í¬ ë¡œì§ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤:

<!-- ë””ë²„ê¹…ìš© ì¶œë ¥ -->
<p th:text="${selectedGenres}">ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸</p>
âœ… ê²°ë¡ 
í˜„ì¬ ì½”ë“œëŠ” List<String> í˜•íƒœë¡œ selectedGenresë¥¼ ë„˜ê¸´ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë¨

ë§Œì•½ ì²´í¬ê°€ ì•ˆ ë³´ì¸ë‹¤ë©´:

selectedGenresê°€ ë¹„ì–´ ìˆê±°ë‚˜

genre.name() ê³¼ ë§¤ì¹­ì´ ì•ˆ ë˜ëŠ” ê°’ì¼ ìˆ˜ ìˆìŒ

ì œëŒ€ë¡œ ë³´ì´ë ¤ë©´ selectedGenres.contains(genre.name()) ì¡°ê±´ì´ ë§ì•„ì•¼ í•¨

í•„ìš”í•˜ì‹œë©´, Controllerë‚˜ Service ì½”ë“œë¥¼ í•¨ê»˜ í™•ì¸í•´ì„œ ì •í•©ì„±ë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”.

ë‚˜ì˜ ë§:
@GetMapping("/content/{contentId}/genre")

    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);
        // ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì´ ë©”ì„œë“œê°€ Enum List ë°˜í™˜
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList(); // âœ… ë³€í™˜

        // ì¤‘ë³µëœ addAttribute ì œê±°


//        model.addAttribute("selectedGenres", genreService.getSelectedGenreNames(contentId));  // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í‘œì‹œ
//        model.addAttribute("genreTranslations", genreService.getGenreTranslations()); // í•œê¸€ ì´ë¦„ ë§µí•‘

        // í•´ë‹¹ contentIdë¡œ ContentDTO, ëª¨ë“  ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì¥ë¥´ ë²ˆì—­ ë“±ì„ ëª¨ë¸ì— ì¶”ê°€
        model.addAttribute("contentId", contentId);
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenres);

        Genre[] allGenres = Genre.values();

        Map<String, String> genreTranslations = Map.of(
                "ACTION", "ì•¡ì…˜",
                "DRAMA", "ë“œë¼ë§ˆ",
                "ROMANCE", "ë¡œë§¨ìŠ¤",
                "HORROR", "í˜¸ëŸ¬",
                "THRILLER", "ìŠ¤ë¦´ëŸ¬",
                "COMEDY", "ì½”ë¯¸ë””",
                "FANTASY", "íŒíƒ€ì§€",
                "ADVENTURE", "ì–´ë“œë²¤ì²˜",
                "NATURAL_SCIENCE", "ìì—°ê³¼í•™",
                "KPOP", "K-POP");
// Map í¬ê¸° ì œí•œ
//Map.of 10ìŒ ì œí•œì— ê±¸ë¦¼ â†’ Map.ofEntries ë“±ìœ¼ë¡œ ë³€ê²½ í•„ìš”
//                "ANIMATION","ì• ë‹ˆë©”ì´ì…˜",
//                "SPORTS", "ìŠ¤í¬ì¸ ",
//                "MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬",
//                "DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬",
//                "SF", "SF",
//                "MUSIC", "ìŒì•…",
//                "FAMILY", "ê°€ì¡±",
//                "CONCERT", "ê³µì—°ì‹¤í™©",
//                "MUSICAL", "ë®¤ì§€ì»¬",
//                "BIOPIC", "ì „ê¸°",
//                "HISTORY", "ì—­ì‚¬",
//                "CRIME", "ë²”ì£„",
//                "KIDS", "í‚¤ì¦ˆ",
//                "VARIETY", "ì˜ˆëŠ¥",
//                "SITCOM", "ì‹œíŠ¸ì½¤",
//                "PERIOD", "ì‹œëŒ€ê·¹",
//                "ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””",
//                "BL", "BL",
//                "TEENAGER", "í‹´ì—ì´ì €",
//                "DISASTER", "ì¬ë‚œ",
//                "COMICS", "ë§Œí™”",
//                "HUMANITIES", "ì¸ë¬¸í•™",
//                "ECONOMICS", "ê²½ì œì„œ",
//                "INVESTMENT", "íˆ¬ìì„œ",
//                "NOVEL", "ì†Œì„¤",
//                "ESSAY", "ì—ì„¸ì´",
//                "SELF_HELP", "ìê¸°ê³„ë°œ",
//                "WAR", "ì „ìŸ",
//                "PLAY", "í¬ê³¡",
//                "POETRY", "ì‹œ",
//                "SLICE_OF_LIFE", "ì¼ìƒ",
//                "HIP_HOP", "í™í•©",
//                "POP", "íŒ",
//                "MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…",
//                "TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…",
//                "BALLAD", "ë°œë¼ë“œ",
//                "DANCE", "ëŒ„ìŠ¤",
//                "ROCK", "ë¡",
//                "CLASSICAL", "í´ë˜ì‹",
//                "INDIE", "ì¸ë””",
//                "ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´",
//                "JPOP", "JPOP",
//                "RNB", "ì•Œì•¤ë¹„",
//                "TROT", "íŠ¸ë¡œíŠ¸");

        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + allGenres);
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");


        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenres);
        model.addAttribute("genreTranslations", genreTranslations);

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ HTML
    }
    //********************************************************************************//

    //********************************************************************************//
    // ì¥ë¥´ ì €ì¥
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {
        if (contentId == null) {
            contentService.addGenres(contentId, genres != null ? genres :
                    List.of());
            genres = new ArrayList<>();
            System.out.println(" post null contentId  ==" + contentId);
            System.out.println(" post null genress    ==" + genres);
            System.out.println(" ---------------------");
        }

        System.out.println(" post44 contentId  ==" + contentId);
        System.out.println(" post44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸
        contentService.updateGenres(contentId, genres);

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)


        Genre[] allGenres = Genre.values();
Map<String, String> genreTranslations = Map.of(
"ACTION", "ì•¡ì…˜",
"DRAMA", "ë“œë¼ë§ˆ",
"ROMANCE", "ë¡œë§¨ìŠ¤",
"HORROR", "í˜¸ëŸ¬",
"THRILLER", "ìŠ¤ë¦´ëŸ¬",
"COMEDY", "ì½”ë¯¸ë””",
"FANTASY", "íŒíƒ€ì§€",
"ADVENTURE", "ì–´ë“œë²¤ì²˜",
"NATURAL_SCIENCE", "ìì—°ê³¼í•™",
"KPOP", "K-POP"
// Map í¬ê¸° ì œí•œ
//Map.of 10ìŒ ì œí•œì— ê±¸ë¦¼ â†’ Map.ofEntries ë“±ìœ¼ë¡œ ë³€ê²½ í•„ìš”
"ANIMATION","ì• ë‹ˆë©”ì´ì…˜",
"SPORTS", "ìŠ¤í¬ì¸ ",
"MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬",
"DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬",
"SF", "SF",
"MUSIC", "ìŒì•…",
"FAMILY", "ê°€ì¡±",
"CONCERT", "ê³µì—°ì‹¤í™©",
"MUSICAL", "ë®¤ì§€ì»¬",
"BIOPIC", "ì „ê¸°",
"HISTORY", "ì—­ì‚¬",
"CRIME", "ë²”ì£„",
"KIDS", "í‚¤ì¦ˆ",
"VARIETY", "ì˜ˆëŠ¥",
"SITCOM", "ì‹œíŠ¸ì½¤",
"PERIOD", "ì‹œëŒ€ê·¹",
"ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””",
"BL", "BL",
"TEENAGER", "í‹´ì—ì´ì €",
"DISASTER", "ì¬ë‚œ",
"COMICS", "ë§Œí™”",
"HUMANITIES", "ì¸ë¬¸í•™",
"ECONOMICS", "ê²½ì œì„œ",
"INVESTMENT", "íˆ¬ìì„œ",
"NOVEL", "ì†Œì„¤",
"ESSAY", "ì—ì„¸ì´",
"SELF_HELP", "ìê¸°ê³„ë°œ",
"WAR", "ì „ìŸ",
"PLAY", "í¬ê³¡",
"POETRY", "ì‹œ",
"SLICE_OF_LIFE", "ì¼ìƒ",
"HIP_HOP", "í™í•©",
"POP", "íŒ",
"MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…",
"TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…",
"BALLAD", "ë°œë¼ë“œ",
"DANCE", "ëŒ„ìŠ¤",
"ROCK", "ë¡",
"CLASSICAL", "í´ë˜ì‹",
"INDIE", "ì¸ë””",
"ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´",
"JPOP", "JPOP",
"RNB", "ì•Œì•¤ë¹„",
"TROT", "íŠ¸ë¡œíŠ¸");

        );

        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenreNames);
        model.addAttribute("genreTranslations", genreTranslations);

        return "redirect:/content/" + contentId + "/genre";

    } ìˆ˜ì •í• ê³³ì€ ìˆ˜ì •ì „ê³¼ í›„ ë¹„êµí•´ì¤˜
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤. ì •ë¦¬í•´ë“œë¦´ê²Œìš”.
ì§€ê¸ˆ ì‘ì„±í•˜ì‹  ì½”ë“œëŠ” ì¥ë¥´ ìˆ˜ì • í¼ ì¡°íšŒ(GET) ê³¼ ì¥ë¥´ ìˆ˜ì • ì €ì¥(POST) ë¡œì§ì¸ë°,
"ìˆ˜ì •ëœ í›„ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ë„ë¡" ë§Œë“¤ê¸° ìœ„í•œ ë¡œì§ì…ë‹ˆë‹¤.

ì „ì²´ì ìœ¼ë¡œ ì˜ êµ¬í˜„ë˜ì–´ ìˆì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ë¶ˆì¼ì¹˜ í¬ì¸íŠ¸ ë•Œë¬¸ì— ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤:

âœ… í•µì‹¬ ë¬¸ì œ ìš”ì•½
ğŸ”´ GET ë©”ì„œë“œì—ì„œëŠ”:
selectedGenresë¥¼ List<Genre> íƒ€ì…ìœ¼ë¡œ ëª¨ë¸ì— ì¶”ê°€í•¨

List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
model.addAttribute("selectedGenres", selectedGenres); // âš ï¸ íƒ€ì…: List<Genre>
ğŸ”´ POST ë©”ì„œë“œì—ì„œëŠ”:
selectedGenresë¥¼ List<String> íƒ€ì…ìœ¼ë¡œ ë°”ê¿”ì„œ ëª¨ë¸ì— ì¶”ê°€í•¨

List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());
model.addAttribute("selectedGenres", selectedGenreNames); // âš ï¸ íƒ€ì…: List<String>
âœ… ì´ë¡œ ì¸í•´ ìƒê¸°ëŠ” ë¬¸ì œ
Thymeleafì—ì„œ ì²´í¬ë°•ìŠ¤ ì²´í¬ ì¡°ê±´:

th:checked="${selectedGenres.contains(genre.name())}"
ì´ ì½”ë“œëŠ” selectedGenresê°€ List<String>ì¼ ë•Œë§Œ ì‘ë™í•©ë‹ˆë‹¤!

ê·¸ëŸ°ë° GETì—ì„œëŠ” List<Genre>ë¼ì„œ .contains(genre.name()) â†’ ì²´í¬ ì•ˆ ë¨ âŒ

âœ… í•´ê²° ë°©ë²•: í†µì¼!
ğŸ¯ ì„ íƒì§€ 1: selectedGenresë¥¼ í•­ìƒ List<String>ìœ¼ë¡œ ì „ë‹¬ (ê°€ì¥ ê°„ë‹¨í•˜ê³  ì¶”ì²œ)
âœ” GET ìˆ˜ì •
List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList(); // âœ… ì¶”ê°€

model.addAttribute("selectedGenres", selectedGenreNames); // âœ… ìˆ˜ì •: í•­ìƒ String ë¦¬ìŠ¤íŠ¸ë¡œ
âœ” POSTëŠ” ì´ë¯¸ ì´ë ‡ê²Œ ë˜ì–´ ìˆìœ¼ë‹ˆ OK âœ…
âœ… ì„ íƒì§€ 2: í…œí”Œë¦¿ì—ì„œ ë¹„êµë§Œ ë³€ê²½ (ë³„ë¡œ ì¶”ì²œí•˜ì§€ ì•ŠìŒ)
th:checked="${selectedGenres.contains(genre)}"
ì´ê±´ selectedGenresê°€ List<Genre>ì¼ ë•Œë§Œ ë™ì‘

í•˜ì§€ë§Œ POSTì—ì„œëŠ” ë‹¤ì‹œ List<String>ë¡œ ë°”ê¾¸ì–´ì•¼ í•˜ë¯€ë¡œ ì½”ë“œ ìœ ì§€ê°€ ì–´ë µê³  í˜¼ë€ ìœ ë°œ

âœ… ìš”ì•½: ìˆ˜ì • ì „/í›„ ë¹„êµ
ìœ„ì¹˜	ìˆ˜ì • ì „	ìˆ˜ì • í›„
GET	model.addAttribute("selectedGenres", selectedGenres); (â†’ List<Genre>)	model.addAttribute("selectedGenres", selectedGenreNames); (â†’ List<String>)
HTML	th:checked="${selectedGenres.contains(genre.name())}"	ë³€ê²½ ì—†ìŒ âœ…
POST	ì´ë¯¸ List<String> ë¡œ ì „ë‹¬ ì¤‘	ë³€ê²½ ì—†ìŒ âœ…
ğŸ’¡ ì¶”ê°€: Map.of(...) ë¬¸ì œ í•´ê²°
í˜„ì¬ ì•„ë˜ì²˜ëŸ¼ Map.of(...)ë¡œ 10ê°œ ì´ìƒ í•­ëª© ì •ì˜í•´ì„œ ì—ëŸ¬ ë°œìƒí•  ìˆ˜ ìˆì–´ìš”:

Map<String, String> genreTranslations = Map.of(
"ACTION", "ì•¡ì…˜",
...
"KPOP", "K-POP",
"ANIMATION", "ì• ë‹ˆë©”ì´ì…˜", // âš ï¸ 11ê°œ ì´ìƒ â†’ ëŸ°íƒ€ì„ ì˜ˆì™¸ ë°œìƒ
);
âœ… ìˆ˜ì • ë°©ë²• â†’ Map.ofEntries(...) ì‚¬ìš©:
Map<String, String> genreTranslations = Map.ofEntries(
Map.entry("ACTION", "ì•¡ì…˜"),
Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
Map.entry("HORROR", "í˜¸ëŸ¬"),
Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
Map.entry("COMEDY", "ì½”ë¯¸ë””"),
Map.entry("FANTASY", "íŒíƒ€ì§€"),
Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
Map.entry("KPOP", "K-POP"),
Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
// ... ìƒëµ
);
âœ… ê²°ë¡  (í•œ ì¤„ ìš”ì•½)
selectedGenresëŠ” í•­ìƒ List<String> í˜•íƒœë¡œ ëª¨ë¸ì— ë„£ê³ ,

th:checked="${selectedGenres.contains(genre.name())}" ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.

í•„ìš”í•˜ë©´ ë‚´ê°€ ìˆ˜ì •ëœ GET ë©”ì„œë“œ ì½”ë“œ í•œ ë²ˆì— ì •ë¦¬í•´ë“œë¦´ê²Œìš”.

ë‚˜ì˜ ë§:
GET ë©”ì„œë“œ ì½”ë“œ í•œ ë²ˆì— ì •ë¦¬
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤! ì•„ë˜ëŠ” ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€(GET) ìš”ì²­ ì‹œ ì‚¬ìš©í•˜ëŠ” @GetMapping ë©”ì„œë“œë¥¼ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•œ ë²„ì „ì…ë‹ˆë‹¤.

âœ… ëª©ì :
selectedGenresë¥¼ í•­ìƒ List<String>ìœ¼ë¡œ í†µì¼

Map.ofEntriesë¡œ ë²ˆì—­ ë§µ ì˜ˆì™¸ ì—†ì´ ì •ì˜

ì¤‘ë³µëœ addAttribute ì œê±°

âœ… ìˆ˜ì •ëœ @GetMapping("/content/{contentId}/genre") ì „ì²´ ì½”ë“œ:
@GetMapping("/content/{contentId}/genre")
public String showGenreForm(@PathVariable Integer contentId, Model model) {
// ì½˜í…ì¸  ì •ë³´ ì¡°íšŒ
ContentCreateDTO contentDTO = contentService.read(contentId);

    // ì„ íƒëœ ì¥ë¥´ (List<Genre>) â†’ List<String>ìœ¼ë¡œ ë³€í™˜
    List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
    List<String> selectedGenreNames = selectedGenres.stream()
            .map(Enum::name)
            .toList(); // âœ… í…œí”Œë¦¿ì—ì„œ ì²´í¬í•˜ê¸° ì¢‹ê²Œ

    // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
    Map<String, String> genreTranslations = Map.ofEntries(
            Map.entry("ACTION", "ì•¡ì…˜"),
            Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
            Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
            Map.entry("HORROR", "í˜¸ëŸ¬"),
            Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
            Map.entry("COMEDY", "ì½”ë¯¸ë””"),
            Map.entry("FANTASY", "íŒíƒ€ì§€"),
            Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
            Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
            Map.entry("KPOP", "K-POP"),
            Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
            Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
            Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
            Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
            Map.entry("SF", "SF"),
            Map.entry("MUSIC", "ìŒì•…"),
            Map.entry("FAMILY", "ê°€ì¡±"),
            Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
            Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
            Map.entry("BIOPIC", "ì „ê¸°"),
            Map.entry("HISTORY", "ì—­ì‚¬"),
            Map.entry("CRIME", "ë²”ì£„"),
            Map.entry("KIDS", "í‚¤ì¦ˆ"),
            Map.entry("VARIETY", "ì˜ˆëŠ¥"),
            Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
            Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
            Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
            Map.entry("BL", "BL"),
            Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
            Map.entry("DISASTER", "ì¬ë‚œ"),
            Map.entry("COMICS", "ë§Œí™”"),
            Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
            Map.entry("ECONOMICS", "ê²½ì œì„œ"),
            Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
            Map.entry("NOVEL", "ì†Œì„¤"),
            Map.entry("ESSAY", "ì—ì„¸ì´"),
            Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
            Map.entry("WAR", "ì „ìŸ"),
            Map.entry("PLAY", "í¬ê³¡"),
            Map.entry("POETRY", "ì‹œ"),
            Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
            Map.entry("HIP_HOP", "í™í•©"),
            Map.entry("POP", "íŒ"),
            Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
            Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
            Map.entry("BALLAD", "ë°œë¼ë“œ"),
            Map.entry("DANCE", "ëŒ„ìŠ¤"),
            Map.entry("ROCK", "ë¡"),
            Map.entry("CLASSICAL", "í´ë˜ì‹"),
            Map.entry("INDIE", "ì¸ë””"),
            Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
            Map.entry("JPOP", "JPOP"),
            Map.entry("RNB", "ì•Œì•¤ë¹„"),
            Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
    );

    // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ì „ë‹¬
    model.addAttribute("contentDTO", contentDTO);
    model.addAttribute("contentId", contentId);
    model.addAttribute("allGenres", Genre.values());
    model.addAttribute("selectedGenres", selectedGenreNames); // âœ… String ë¦¬ìŠ¤íŠ¸ë¡œ!
    model.addAttribute("genreTranslations", genreTranslations);

    return "content/genreForm";
}
âœ… ì´ë ‡ê²Œ í•˜ë©´ í…œí”Œë¦¿ë„ ì˜ ì‘ë™í•©ë‹ˆë‹¤:
<input type="checkbox" name="genres"
th:value="${genre.name()}"
th:checked="${selectedGenres.contains(genre.name())}"/>
âœ”ï¸ selectedGenresëŠ” ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸ì´ë¯€ë¡œ genre.name()ìœ¼ë¡œ ë¹„êµ ê°€ëŠ¥

í•„ìš”í•˜ë‹¤ë©´ POSTë„ ë™ì¼í•˜ê²Œ selectedGenresë¥¼ List<String>ìœ¼ë¡œ ìœ ì§€í•˜ì„¸ìš”.
ì¶”ê°€ ì§ˆë¬¸ ìˆìœ¼ë©´ ì–¸ì œë“ ì§€!

ë‚˜ì˜ ë§:
@PostMapping("/content/{contentId}/genre")
public String submitGenres(@PathVariable("contentId") Integer contentId,
@RequestParam(value = "genres", required = false) List<Genre> genres,
Model model) {
if (contentId == null) {
contentService.addGenres(contentId, genres != null ? genres :
List.of());
genres = new ArrayList<>();
System.out.println(" post null contentId  ==" + contentId);
System.out.println(" post null genress    ==" + genres);
System.out.println(" ---------------------");
}

        System.out.println(" post 44 contentId  ==" + contentId);
        System.out.println(" post 44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸
        contentService.updateGenres(contentId, genres);

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)


        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );

        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", allGenres);
        model.addAttribute("selectedGenres", selectedGenreNames);
        model.addAttribute("genreTranslations", genreTranslations);

        return "redirect:/content/" + contentId + "/genre";

    }  ìˆ˜ì •í• ê³³ ì „ê³¼ í›„ ë¹„êµ ìë£Œ
ChatGPTì˜ ë§:
ì•„ë˜ëŠ” ì£¼ì‹  @PostMapping("/content/{contentId}/genre") ë©”ì„œë“œì— ëŒ€í•´ **ì „(before)**ê³¼ **í›„(after)**ë¥¼ ë¹„êµí•˜ë©° ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ì •ë¦¬ëœ í‘œì™€ í•¨ê»˜ ë³´ì—¬ë“œë¦´ê²Œìš”.

âœ… ì „ì²´ì ì¸ ëª©ì 
ë¶ˆí•„ìš”í•œ ì¡°ê±´ë¬¸ ì œê±° (contentId == null)

ì¤‘ë³µ ì½”ë“œ ì œê±°

ì¼ê´€ì„± ìˆê²Œ selectedGenres â†’ List<String> ì‚¬ìš©

redirect ì´í›„ì— model.addAttribute ë¶ˆí•„ìš”í•˜ë¯€ë¡œ ì œê±°

âœ… ìˆ˜ì • ì „ vs ìˆ˜ì • í›„ ë¹„êµ
í•­ëª©	ìˆ˜ì • ì „ ì½”ë“œ (Before)	ìˆ˜ì • í›„ ì½”ë“œ (After)
âŒ if (contentId == null)	ì˜ëª»ëœ ì¡°ê±´ë¬¸: ì‹¤ì œë¡œëŠ” nullì¼ ìˆ˜ ì—†ê³ , ì˜ë¯¸ ì—†ëŠ” ì²˜ë¦¬ (addGenres)	ğŸ”¥ ì œê±°. contentIdëŠ” URL path variableì´ë¯€ë¡œ null ë°©ì§€ë¨
âœ… ì½˜ì†” ë¡œê·¸	System.out.println()ì´ ê³¼ë„í•˜ê²Œ ì‚¬ìš©ë¨	âš ï¸ ê°œë°œ ì¤‘ ë””ë²„ê¹…ì—” OK, ë°°í¬ ì „ì—ëŠ” logback/slf4jë¡œ ëŒ€ì²´ ì¶”ì²œ
âœ… ì¥ë¥´ ì—…ë°ì´íŠ¸	contentService.updateGenres(contentId, genres); ì •ìƒ ì‘ë™	ìœ ì§€
âŒ ëª¨ë¸ ì¬ì…‹íŒ… (model.add...)	redirect:/content/... í˜¸ì¶œí•˜ë©´ì„œë„ model.addAttribute ë‹¤ì‹œ ì„¤ì •í•¨ (ë°˜ì˜ ì•ˆë¨)	ğŸ”¥ ì œê±° â€” redirect í›„ì—ëŠ” modelì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ
âœ… genreTranslations	Map.of â†’ Map.ofEntriesë¡œ ì´ë¯¸ ì˜ ì‘ì„±ë¨	ìœ ì§€
âœ… ë¦¬íŒ©í† ë§ëœ ìµœì¢… ì½”ë“œ
@PostMapping("/content/{contentId}/genre")
public String submitGenres(@PathVariable("contentId") Integer contentId,
@RequestParam(value = "genres", required = false) List<Genre> genres) {

    System.out.println("post - contentId: " + contentId);
    System.out.println("post - genres: " + genres);

    // ì¥ë¥´ ì—…ë°ì´íŠ¸ (null í—ˆìš©, ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ í¬í•¨)
    contentService.updateGenres(contentId, genres != null ? genres : List.of());

    // âœ… redirect ì´í›„ model ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, addAttribute ìƒëµ
    return "redirect:/content/" + contentId + "/genre";
}
ğŸ“Œ ë·°ì—ì„œëŠ” ì–´ë–»ê²Œ ìœ ì§€ë¨?
redirectëœ í›„, GET /content/{contentId}/genreê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ë¯€ë¡œ
ê·¸ ì•ˆì—ì„œ ë‹¤ìŒì²˜ëŸ¼ ë°ì´í„°ê°€ ìƒˆë¡­ê²Œ ì„¸íŒ…ë¨:

model.addAttribute("selectedGenres", selectedGenreNames); // List<String>
model.addAttribute("allGenres", Genre.values());
model.addAttribute("genreTranslations", genreTranslations);
ê·¸ë˜ì„œ <input type="checkbox"... th:checked="${selectedGenres.contains(genre.name())}" /> ë„ ì˜ ì‘ë™í•©ë‹ˆë‹¤.

âœ… ìš”ì•½
ê°œì„  í•­ëª©	ì ìš© ì—¬ë¶€
contentId == null ì œê±°	âœ…
ì¤‘ë³µëœ addAttribute ì œê±° (POST ë‚´)	âœ…
ì½˜ì†” ë¡œê·¸ â†’ logback êµì²´ (ì¶”ì²œ)	ğŸŸ¡ ê°œë°œ ì¤‘ì—” OK
ë¦¬ë””ë ‰ì…˜ í›„ ë‹¤ì‹œ GETì—ì„œ ëª¨ë¸ ì²˜ë¦¬	âœ…
í•„ìš”í•˜ì‹œë©´ Service ìª½ ì½”ë“œ (updateGenres, getGenresByContentId)ê¹Œì§€ë„ ë¦¬ë·°í•´ë“œë¦´ê²Œìš”.

ë‚˜ì˜ ë§:
ë¦¬ë””ë ‰ì…˜ í›„ ë‹¤ì‹œ GETì—ì„œ ëª¨ë¸ ì²˜ë¦¬
Service ìª½ ì½”ë“œ (updateGenres, getGenresByContentId)ê¹Œì§€ë„ ìˆ˜ì •í• ê³³ ì „í›„ ë¹„êµìë£Œ ?
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ ë¦¬ë””ë ‰ì…˜ í›„ GETì—ì„œ ëª¨ë¸ ì²˜ë¦¬ê°€ ì™œ ì¤‘ìš”í•œì§€ ìš”ì•½í•œ ë’¤, ìš”ì²­í•˜ì‹  updateGenres ì™€ getGenresByContentId ì„œë¹„ìŠ¤ ë©”ì„œë“œì˜ ìˆ˜ì • ì „/í›„ ë¹„êµ ìë£Œë¥¼ ìƒì„¸íˆ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.

âœ… ì™œ ë¦¬ë””ë ‰ì…˜ í›„ GETì—ì„œ ëª¨ë¸ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ê°€?
ğŸ” POST â†’ Redirect â†’ GET (PRG íŒ¨í„´)
í¼ ì „ì†¡ í›„ redirectë¥¼ ì‚¬ìš©í•˜ë©´ ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ ì‹œ ì¤‘ë³µ ì „ì†¡ ë°©ì§€ë¨.

POSTì—ì„œ model.addAttribute()ë¥¼ í•´ë„, redirect í›„ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŒ.

ë”°ë¼ì„œ, GET í•¸ë“¤ëŸ¬ì—ì„œ ëª¨ë¸ì„ ë‹¤ì‹œ ì„¸íŒ…í•´ì•¼ í•¨.

ğŸ‘‰ ê·¸ëŸ¬ë¯€ë¡œ, GET /content/{contentId}/genreì—ì„œ ë‹¤ìŒì„ ë°˜ë“œì‹œ í•´ì¤˜ì•¼ í•¨:
model.addAttribute("contentDTO", contentDTO);
model.addAttribute("allGenres", Genre.values());
model.addAttribute("selectedGenres", selectedGenres); // or List<String>
model.addAttribute("genreTranslations", genreTranslations);
âœ… contentService.updateGenres(...) ìˆ˜ì • ì „/í›„ ë¹„êµ
âœ” Before (ìˆ˜ì • ì „)
public void updateGenres(Integer contentId, List<Genre> genres) {
// ê¸°ì¡´ ì¥ë¥´ ë‹¤ ì§€ìš°ê³  ìƒˆë¡œ ì¶”ê°€
contentGenreRepository.deleteByContentId(contentId);

    for (Genre genre : genres) {
        ContentGenre cg = new ContentGenre(contentId, genre);
        contentGenreRepository.save(cg);
    }
}
âŒ ë¬¸ì œì 
genresê°€ nullì¼ ê²½ìš° NullPointerException

ê¸°ì¡´ì— genres == nullì´ë©´ ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ â†’ ì´ì „ ì¥ë¥´ê°€ ë‚¨ì•„ ìˆìŒ (ì˜ë„ì™€ ë‹¤ë¦„)

íŠ¸ëœì­ì…˜ ë³´ì¥ ì—¬ë¶€ ë¶ˆëª…í™•

âœ… After (ìˆ˜ì • í›„)
@Transactional
public void updateGenres(Integer contentId, List<Genre> genres) {
// ê¸°ì¡´ ì¥ë¥´ ì „ë¶€ ì‚­ì œ
contentGenreRepository.deleteByContentId(contentId);

    // ì¥ë¥´ê°€ nullì´ê±°ë‚˜ ë¹„ì–´ìˆì„ ê²½ìš° ê·¸ëƒ¥ ë¦¬í„´
    if (genres == null || genres.isEmpty()) return;

    // ìƒˆë¡œìš´ ì¥ë¥´ ì¶”ê°€
    List<ContentGenre> newGenres = genres.stream()
            .map(genre -> new ContentGenre(contentId, genre))
            .toList();

    contentGenreRepository.saveAll(newGenres);
}
âœ… ê°œì„  ì‚¬í•­
í•­ëª©	ê°œì„  ë‚´ìš©
null/ë¹ˆ ì²´í¬	null ë˜ëŠ” ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°©ì§€ë¨
íŠ¸ëœì­ì…˜ ì²˜ë¦¬	@Transactionalìœ¼ë¡œ ë¬¶ì–´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
ì„±ëŠ¥ í–¥ìƒ	ë°˜ë³µ ì €ì¥ â†’ saveAll() ì‚¬ìš©
ì½”ë“œ ê°„ê²°í™”	stream().map() ì‚¬ìš©
âœ… contentService.getGenresByContentId(...) ìˆ˜ì • ì „/í›„ ë¹„êµ
âœ” Before (ìˆ˜ì • ì „)
public List<Genre> getGenresByContentId(Integer contentId) {
List<ContentGenre> contentGenres = contentGenreRepository.findByContentId(contentId);
return contentGenres.stream()
.map(ContentGenre::getGenre)
.collect(Collectors.toList());
}
âš  ë¬¸ì œì 
í° ë¬¸ì œëŠ” ì—†ìœ¼ë‚˜, ì¡°ê¸ˆ ë” ëª…í™•í•˜ê³  ì½ê¸° ì‰¬ìš´ ë°©ì‹ìœ¼ë¡œ ê°œì„  ê°€ëŠ¥

Collectors.toList() â†’ Java 16+ ì´ìƒì´ë©´ .toList() ì‚¬ìš© ê°€ëŠ¥

âœ… After (ìˆ˜ì • í›„)
public List<Genre> getGenresByContentId(Integer contentId) {
return contentGenreRepository.findByContentId(contentId).stream()
.map(ContentGenre::getGenre)
.toList(); // Java 16+ë¶€í„° ê°€ëŠ¥
}
ğŸ“Œ ì •ë¦¬: ì„œë¹„ìŠ¤ ë ˆì´ì–´ ìˆ˜ì • ìš”ì•½í‘œ
ë©”ì„œë“œ	ìˆ˜ì • ì „ ë¬¸ì œì 	ìˆ˜ì • í›„ ê°œì„  ë‚´ìš©
updateGenres(...)	- null ì²´í¬ ì—†ìŒ
- save ë°˜ë³µ	- null/empty ì²´í¬
- saveAll ì‚¬ìš©
- íŠ¸ëœì­ì…˜ ì²˜ë¦¬
  getGenresByContentId(...)	- í° ë¬¸ì œëŠ” ì—†ìœ¼ë‚˜ ì½”ë“œå†—é•·	- ê°„ê²°í•˜ê²Œ stream ì •ë¦¬
  âœ¨ ì„ íƒì  ê°œì„  ì œì•ˆ (ë³´ë„ˆìŠ¤)
  Genre â†” String ë³€í™˜ì´ ë¹ˆë²ˆí•˜ë‹¤ë©´, ë³„ë„ì˜ GenreUtils í´ë˜ìŠ¤ë‚˜ ë©”ì„œë“œ ìƒì„±

genreTranslations ë§µë„ enum ë‚´ë¶€ ë©”ì„œë“œë¡œ ì´ë™ ê°€ëŠ¥

ì˜ˆì‹œ:

public enum Genre {
ACTION("ì•¡ì…˜"), DRAMA("ë“œë¼ë§ˆ"), ...;

    private final String displayName;

    Genre(String displayName) {
        this.displayName = displayName;
    }

    public String getDisplayName() {
        return displayName;
    }
}
í•„ìš”í•˜ë©´ ìœ„ì™€ ê°™ì€ Enum ë¦¬íŒ©í† ë§ë„ ì „ì²´ êµ¬ì¡°ì™€ í•¨ê»˜ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”.

ë‚˜ì˜ ë§:
@Transactional
public void updateGenres(Integer contentId, List<Genre> newGenres) {
ContentEntity content = contentRepository.findById(contentId)
.orElseThrow(() -> new IllegalArgumentException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));

        // ê¸°ì¡´ ì¥ë¥´ ì‚­ì œ
        List<Genre> oldGenres = getGenresByContentId(contentId);  // ê¸°ì¡´ ì¥ë¥´ ê°€ì ¸ì˜¤ê¸°
        contentGenreRepository.deleteByContent(content);  // ê¸°ì¡´ ì¥ë¥´ ì‚­ì œ

        // ì¥ë¥´ê°€ nullì´ê±°ë‚˜ ë¹„ì–´ìˆì„ ê²½ìš° ê·¸ëƒ¥ ë¦¬í„´
//        if (genres == null || genres.isEmpty()) return;

        // ìƒˆë¡œìš´ ì¥ë¥´ ì¶”ê°€
        for (Genre genre : newGenres) {
//            System.out.println(" update contentId :"+contentId);
//            System.out.println(" update content :"+content);
//            System.out.println(" update genre :"+genre);
//            System.out.println(" -----------------");

            ContentGenreEntity contentGenre = new ContentGenreEntity();
            contentGenre.setContent(content); // ë°˜ë“œì‹œ content ì„¸íŒ…
            contentGenre.setGenre(genre);
            contentGenreRepository.save(contentGenre); // ìƒˆë¡œìš´ ì¥ë¥´ ì €ì¥
            // ë¡œê·¸ë¡œ ì´ì „ ì¥ë¥´ì™€ ìˆ˜ì •ëœ ì¥ë¥´ ë¹„êµ (ì„ íƒì‚¬í•­)
            System.out.println("Old Genres: " + oldGenres);
            System.out.println("New Genres: " + newGenres);

        }
//       ë‹¤ë¥¸ ë°©ë²•ì„
//        public void updateGenres(Integer contentId, List<Genre> genres) {
//            // ê¸°ì¡´ ì¥ë¥´ ì „ë¶€ ì‚­ì œ
//            contentGenreRepository.deleteByContentId(contentId);
//
//            // ì¥ë¥´ê°€ nullì´ê±°ë‚˜ ë¹„ì–´ìˆì„ ê²½ìš° ê·¸ëƒ¥ ë¦¬í„´
//            if (genres == null || genres.isEmpty()) return;
//
//            // ìƒˆë¡œìš´ ì¥ë¥´ ì¶”ê°€
//            List<ContentGenre> newGenres = genres.stream()
//                    .map(genre -> new ContentGenre(contentId, genre))
//                    .toList();
//
//            contentGenreRepository.saveAll(newGenres);
//        }


    }

    /**
     * âœ… ì½˜í…ì¸  IDë¡œ ì¥ë¥´ ì¡°íšŒ
     */
    @Transactional
    public List<Genre> getGenresByContentId(Integer contentId) {
//        ContentEntity content = contentRepository.findById(contentId)
//                .orElseThrow(() -> new NoSuchElementException("ì½˜í…ì¸  IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id: " + contentId));
//
//        List<ContentGenreEntity> genreEntities = contentGenreRepository.findByContent(content);
//
//        return genreEntities.stream()
//                .map(ContentGenreEntity::getGenre)
//                .collect(Collectors.toList()); //Java 16+ ì´ìƒì´ë©´ .toList() ì‚¬ìš© ê°€ëŠ¥
return contentGenreRepository.findByContentId(contentId).stream()
.map(ContentGenre::getGenre)
.toList(); // Java 16+ë¶€í„° ê°€ëŠ¥

    }  dptj  .map(ContentGenreEntity::getGenre)  ì–´ë–»ê²Œ ìˆ˜ì •í•´
ChatGPTì˜ ë§:
ì•„ë˜ëŠ” ì§ˆë¬¸í•˜ì‹  ë¶€ë¶„ì— ëŒ€í•œ ì •í™•í•œ ì„¤ëª…ê³¼ ì½”ë“œ ìˆ˜ì •ì…ë‹ˆë‹¤:

ğŸ” ì§ˆë¬¸ ìš”ì§€ ìš”ì•½
return contentGenreRepository.findByContentId(contentId).stream()
.map(ContentGenre::getGenre)
.toList();
ì—¬ê¸°ì„œ ContentGenre::getGenreë¥¼ ContentGenreEntity::getGenreë¡œ ë°”ê¾¸ê³  ì‹¶ì€ ê²½ìš°, ì´ëŠ” contentGenreRepository.findByContentId(...)ê°€ ë°˜í™˜í•˜ëŠ” íƒ€ì…ì´ ContentGenreEntityì¼ ê²½ìš°ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

âœ… ìƒí™© ì •ë¦¬
1. í˜„ì¬ ì‚¬ìš©í•˜ëŠ” Entity í´ë˜ìŠ¤ ì´ë¦„ í™•ì¸
   ì§ˆë¬¸ ì½”ë“œì—ì„œëŠ” ContentGenreEntityë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒ

ê·¸ëŸ¬ë‚˜ .map(ContentGenre::getGenre)ì²˜ëŸ¼ ContentGenreë¼ëŠ” ì´ë¦„ë„ ì„ì—¬ ìˆìŒ
â†’ ì•„ë§ˆ ì´ì „ì— ì“°ë˜ í´ë˜ìŠ¤ ì´ë¦„ ë˜ëŠ” DTOì¼ ê°€ëŠ¥ì„± ìˆìŒ

âœ… ìˆ˜ì • í¬ì¸íŠ¸
í˜„ì¬ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ê°€ ContentGenreEntityë¼ë©´, .map() ì•ˆë„ ë‹¤ìŒì²˜ëŸ¼ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤:

âœ”ï¸ ë³€ê²½ ì „ (í‹€ë¦´ ìˆ˜ ìˆìŒ)
return contentGenreRepository.findByContentId(contentId).stream()
.map(ContentGenre::getGenre)
.toList();
âœ”ï¸ ë³€ê²½ í›„ (Entity í´ë˜ìŠ¤ëª… ë§ì¶¤)
return contentGenreRepository.findByContentId(contentId).stream()
.map(ContentGenreEntity::getGenre)
.toList();
ğŸ”„ ì •ë¦¬: Entity í´ë˜ìŠ¤ ì´ë¦„ í˜¼ë™ ì •ë¦¬
ì˜ëª»ëœ í´ë˜ìŠ¤ëª… ì‚¬ìš© ì‹œ	ì˜¬ë°”ë¥¸ í´ë˜ìŠ¤ëª… ì‚¬ìš© ì‹œ
ContentGenre::getGenre	ContentGenreEntity::getGenre
ContentGenreê°€ ì‹¤ì œ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ DTOë©´ ì˜¤ë¥˜ ë°œìƒ	ContentGenreEntityë¡œ ì¼ì¹˜ì‹œì¼œì•¼ ì •ìƒ ì‘ë™
ğŸ”§ Tip: ë ˆí¬ì§€í† ë¦¬ ë°˜í™˜ê°’ë„ ì¼ì¹˜ì‹œì¼œì•¼ í•¨
// Repository
List<ContentGenreEntity> findByContentId(Integer contentId);
ì´ì²˜ëŸ¼ ë¦¬í„´ íƒ€ì…ì´ ContentGenreEntityì¼ ê²½ìš°ì—ë§Œ .map(ContentGenreEntity::getGenre)ì´ ë™ì‘í•©ë‹ˆë‹¤.

í•„ìš”í•˜ë‹¤ë©´, ContentGenreEntity í´ë˜ìŠ¤ ì •ì˜ë¥¼ ë³´ì—¬ì£¼ì‹œë©´ ì¶”ê°€ë¡œ í™•ì¸í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”.

ë‚˜ì˜ ë§:
OR 2972 --- [itview_spring] [nio-8080-exec-1] org.thymeleaf.TemplateEngine             : [THYMELEAF][http-nio-8080-exec-1] Exception processing template "content/genreForm": An error happened during template parsing (template: "class path resource [templates/content/genreForm.html]")   <!DOCTYPE html>
<html lang="kr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<main layout:fragment="content">
    <!--    <h1>Welcome to the Dashboard</h1>-->
    <!--    <p>This is your main content area.</p>-->

    <div class="container mt-5">
        <h2>ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì •</h2>

        <!--        <form th:action="@{|/content/${contentId}/genre|}" method="post">-->
        <form th:action="@{/content/{contentId}/genre(contentId=${contentDTO.id})}" method="post">
            <!-- âœ… CSRF í† í° ì¶”ê°€ (Spring Security ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•„ìˆ˜) -->
            <!--            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
            <input id="id" th:value="${contentDTO.id}" value="post" hidden>
            <!--            <input type="hidden" name="_method" value="post" />-->

            <div class="mb-3">
                <label class="form-label">ì¥ë¥´ ì„ íƒ</label>
                <!-- âœ… ê° ì¥ë¥´ ì²´í¬ë°•ìŠ¤ ë°˜ë³µ ì¶œë ¥ -->
                <!--                <div>-->
                <!--                    <ul>-->
                <!--                        &lt;!&ndash; ì¥ë¥´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ &ndash;&gt;-->
                <!--                        <c:forEach var="genre" items="${allGenres}">-->
                <!--                            <li>-->
                <!--                                <input type="checkbox" id="genre_${genre}" name="genres" value="${genre}"-->
                <!--                                <c:if test="${selectedGenres.contains(genre.name)}">checked</c:if> />-->
                <!--                                <label for="genre_${genre}">${genreTranslations[genre]}</label>-->
                <!--                            </li>-->
                <!--                        </c:forEach>-->
                <!--                    </ul>-->
                <!--                </div>-->
                <div class="form-check" th:each="genre : ${allGenres}">
                    <input class="form-check-input" type="checkbox" name="genres"
                           th:id="${'genre-' + genre.name()}"
                           th:value="${genre.name()}"
                           th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}"/>

                    <label class="form-check-label"
                           th:for="${'genre-' + genre.name()}"
                           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
                </div>


                <!--                       th:text="${genre.genreName}">ì¥ë¥´ëª…</label>-->

                <!-- âœ… í•œê¸€ëª… ë³€í™˜ì€ ì„ íƒì ìœ¼ë¡œ ENUMì— ë©”ì„œë“œ ì¶”ê°€ -->
                <!--                    <label class="form-check-label"-->
                <!--                           th:for="${'genre-' + genre.name()}"-->
                <!--                              th:text="${genre.genreName}">-->
                <!--                           th:text="${#strings.equalsIgnoreCase(genre.name(), 'ACTION') ? 'ì•¡ì…˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ADVENTURE') ? 'ì–´ë“œë²¤ì²˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'COMEDY') ? 'ì½”ë¯¸ë””' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'DRAMA') ? 'ë“œë¼ë§ˆ' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'THRILLER') ? 'ìŠ¤ë¦´ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'HORROR') ? 'í˜¸ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'FANTASY') ? 'íŒíƒ€ì§€' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ROMANCE') ? 'ë¡œë§¨ìŠ¤' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'NATURAL_SCIENCE') ? 'ìì—°ê³¼í•™' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'KPOP') ? 'K-POP' :-->
                <!--                                      genre.name())))))))))">-->
                <!--                            <span th:text="${genre.genreName}">ì¥ë¥´</span>-->
                <!--                            ì¥ë¥´ëª…-->
                <!--                    </label>-->

            </div>

            <button type="submit" class="btn btn-primary">ì €ì¥</button>
            <a th:href="@{/content/list}" class="btn btn-secondary">ì·¨ì†Œ</a>
        </form>
        <!-- ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° -->
        <h3>ì„ íƒí•œ ì¥ë¥´ </h3>
        <ul>
            <th:block th:each="genre : ${selectedGenres}">
                <li th:text="${genreTranslations[genre.name()]}"></li>
            </th:block>
        </ul>

<!--        &lt;!&ndash; ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° &ndash;&gt;-->
<!--        <h3>ì„ íƒëœ ì¥ë¥´</h3>-->
<!--        <ul>-->
<!--            <c:forEach var="genre" items="${selectedGenres}">-->
<!--                <li>${genre}</li>-->
<!--            </c:forEach>-->
<!--        </ul>-->
<!--        -->

    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</main>
</body>
</html> ìˆ˜ì •í• ê³³ì€  
ChatGPTì˜ ë§:
Thymeleaf í…œí”Œë¦¿ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ ë¡œê·¸ê°€ ë°œìƒí–ˆì„ ë•Œ:

Exception processing template "content/genreForm": An error happened during template parsing
ì´ ê²½ìš°ëŠ” ëŒ€ë¶€ë¶„ ë¬¸ë²• ì˜¤ë¥˜ë‚˜ Modelì—ì„œ ëˆ„ë½ëœ ì†ì„± ì ‘ê·¼, ë˜ëŠ” Thymeleafì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” í‘œí˜„ì‹ì´ ì›ì¸ì…ë‹ˆë‹¤.

ğŸ” ì£¼ìš” ì›ì¸ ì¶”ì •
âœ… ë¬¸ì œ í•µì‹¬ ì˜ì‹¬ ì§€ì :
<li th:text="${genreTranslations[genre.name()]}"></li>
ìœ„ í‘œí˜„ì—ì„œ genreëŠ” Stringì¸ë° .name()ì„ í˜¸ì¶œí•˜ë ¤ê³  í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ğŸ¯ ì‹¤ì œ ë¬¸ì œ ì •ë¦¬
<th:block th:each="genre : ${selectedGenres}">
<li th:text="${genreTranslations[genre.name()]}"></li>
</th:block>
ì—¬ê¸°ì„œ selectedGenresì˜ íƒ€ì…ì´ List<String>ì´ë¼ë©´,
genre.name()ì€ ë¶ˆê°€ëŠ¥í•˜ê³  ë‹¨ìˆœíˆ genreë¥¼ ì¨ì•¼ í•©ë‹ˆë‹¤.

âœ… ìˆ˜ì • ì½”ë“œ
<th:block th:each="genre : ${selectedGenres}">
<li th:text="${genreTranslations[genre]}">ì¥ë¥´ëª…</li>
</th:block>
ğŸ”§ ì„¤ëª…
genreê°€ Enumì´ë©´ genre.name() í•„ìš”

genreê°€ Stringì´ë©´ genre.name() ì—†ì´ ë°”ë¡œ ì‚¬ìš©

ğŸ“Œ ì¶”ê°€ë¡œ í™•ì¸í•  ì‚¬í•­
Controllerì—ì„œ ë„£ì€ selectedGenres íƒ€ì…ì„ í™•ì¸
List<Genre>ì¸ì§€ List<String>ì¸ì§€ì— ë”°ë¼ .name() ì‚¬ìš© ì—¬ë¶€ê°€ ë‹¬ë¼ì§

model.addAttribute("selectedGenres", selectedGenres); // List<Genre>
ë˜ëŠ”

List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).toList();
model.addAttribute("selectedGenres", selectedGenreNames); // List<String>
allGenres ë°˜ë³µ ë¶€ë¶„ì€ ë¬¸ì œ ì—†ìŒ
ì•„ë˜ ë¶€ë¶„ì€ Enum ê¸°ë°˜ì´ë¼ .name() ì‚¬ìš©ì´ ë§ìŠµë‹ˆë‹¤:

<div class="form-check" th:each="genre : ${allGenres}">
    <input class="form-check-input" type="checkbox" name="genres"
           th:id="${'genre-' + genre.name()}"
           th:value="${genre.name()}"
           th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}"/>

    <label class="form-check-label"
           th:for="${'genre-' + genre.name()}"
           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
</div>
âœ… ìš”ì•½: ìˆ˜ì •í•  ë¶€ë¶„
ğŸ”§ ìˆ˜ì • ì „
<li th:text="${genreTranslations[genre.name()]}"></li>
ğŸ”§ ìˆ˜ì • í›„
<li th:text="${genreTranslations[genre]}"></li>
âœ” ìœ„ ìˆ˜ì •ìœ¼ë¡œ íŒŒì‹± ì—ëŸ¬ í•´ê²°ë©ë‹ˆë‹¤.

í•„ìš”í•˜ë©´ Controller ìª½ selectedGenres íƒ€ì…ë„ ê°™ì´ í™•ì¸í•´ ë“œë¦´ê²Œìš”.

ë‚˜ì˜ ë§:
package com.example.itview_spring.Controller.Content;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.PageInfoDTO;
import com.example.itview_spring.Service.ContentService;
import com.example.itview_spring.Util.PageInfo;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.web.servlet.error.ErrorController;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.springframework.data.jpa.domain.AbstractPersistable_.id;

@Controller
@RequiredArgsConstructor
public class ContentController {
private final ContentService contentService;
private final PageInfo pageInfo;

    // ==================== ERROR PAGE HANDLER ====================
    //    500 ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ ì»¤ìŠ¤í…€ ì˜¤ë¥˜ í˜ì´ì§€ ì¶”ê°€ ê°€ëŠ¥ (ì„ íƒ ì‚¬í•­)-----------------------------------
//    @Controller
//    public class CustomErrorController implements ErrorController {
//        @RequestMapping("/error")
//        public String handleError() {
//            return "error/customError"; // templates/error/customError.html
//        }
//    }
// ==================== CONTENT CRUD ==========================
// ë“±ë¡ í¼ ì´ë™
@GetMapping("/content/register")
public String newContent() {

        return "content/register";
    }

    // ë“±ë¡ ì²˜ë¦¬ í›„ â†’ ì¥ë¥´ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™
    @PostMapping("/content/register")
    public String newContent(ContentCreateDTO contentDTO) {
        //ë°ì´í„° ì €ì¥ì²˜ë¦¬ (Service -> Controller
        ContentCreateDTO savedContent = contentService.create(contentDTO); // ì €ì¥ í›„

        System.out.println(" 00 savedContent ==" + savedContent);
        return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ë“±ë¡ í¼ìœ¼ë¡œ ì´ë™
        //   return "redirect:/content/list";  // ë¦¬ìŠ¤íŠ¸ ì´ë™ ì˜µì…˜ (í˜„ì¬ëŠ” ì¥ë¥´ ì„ íƒ ìš°ì„ )
    }


    //localhost:8080/content/list í™•ì¸í•¨(@GetMppping
    //ì „ì²´ê°•ì˜ ì¡°íšŒí›„ (list.html)ë¡œì´ë™

    /**
     * ì „ì²´ì¡°íšŒ
     *
     * @param pageable ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸ /í˜ì´ì§• ì •ë³´ (ê¸°ë³¸ í˜ì´ì§€ 1)
     * @param model    ê²°ì¢Œ ì „ë‹¬ /ë·°ì— ì „ë‹¬í•  ëª¨ë¸
     * @return í˜ì´ì§€ ì´ë™ /ë·°
     */
    @GetMapping("/content/list")
    // ì „ì²´ ëª©ë¡ ì¡°íšŒ
    public String listContent(@PageableDefault(page = 1) Pageable pageable, Model model) {
        //ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ
        //keyword  ì¶”ê°€ ****
        Page<ContentCreateDTO> contentDTOS = contentService.getAllContents(pageable);
        model.addAttribute("contentDTOS", contentDTOS);
        //    System.out.println("contentDTO.            ==", contentDTOS);

        // í˜ì´ì§€ ì •ë³´ ìƒì„± í›„ ëª¨ë¸ì— ì¶”ê°€
        PageInfoDTO pageInfoDTO = pageInfo.getPageInfo(contentDTOS);
        model.addAttribute("pageInfoDTO", pageInfoDTO);
//        model.addAttribute("contentDTOS", contentDTOS);
//        model.addAttribute("pageInfoDTO", pageInfo.getPageInfo(contentDTOS));
return "content/list";
}

    // ìƒì„¸ ë³´ê¸° (id íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ, @PathVariable ëŒ€ì‹  @RequestParam í˜•ì‹)
// @GetMapping("/content/{id:\\d+}")
//    @GetMapping("/content/detail")
//    @GetMapping("/content/{id}/detail")
//    public String detailContent(@PathVariable("id") Integer id, Model model) {
@GetMapping("/content/detail")
public String detailContent(Integer id, Model model) {
// URL ê²½ë¡œ ë³€ìˆ˜ì¸ {id}ë¥¼ ë°›ìœ¼ë ¤ë©´ @PathVariableì„ ì¨ì•¼ í•©ë‹ˆë‹¤.
ContentCreateDTO contentDTO = contentService.read(id);
model.addAttribute("contentDTO", contentDTO);
System.out.println("deteil id         ===>" + id);
System.out.println("deteil contentDTO ===>" + contentDTO);
return "content/detail"; // ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸ í•„ìš”
}

//
//    @GetMapping("/content/{id:\\d+}")
//    public String detail(@RequestParam("id") Integer id, Model model) {
//        ContentDetailDTO detailDTO = contentService.getContentDetail(id);
//        model.addAttribute("contentDTO", detailDTO.getContentInfo()); // ContentResponseDTO
//        model.addAttribute("gallery", detailDTO.getGallery());
//        model.addAttribute("videos", detailDTO.getVideos());
//        model.addAttribute("externalServices", detailDTO.getExternalServices());
//        return "content/detail";
//    }

    // ìˆ˜ì • í¼ ì´ë™
    @GetMapping("/content/{id}/update")
    public String updateContent(@PathVariable("id") Integer id, Model model) {
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);
        return "content/update";
    }

    // ìˆ˜ì • ì²˜ë¦¬ (â†’ ì¥ë¥´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸)
    @PostMapping("/content/{id}/update")
    public String updateContentProc(@PathVariable("id") Integer id, ContentCreateDTO contentDTO) {
//        contentService.update(id, contentDTO);
//        return "redirect:/content/list";
// Serviceì—ì„œ ìˆ˜ì • ì²˜ë¦¬ í›„ ì €ì¥ëœ DTO ë°˜í™˜ ë°›ìŒ
ContentCreateDTO savedContent = contentService.update(id, contentDTO);
//        System.out.println(" 22 savedContent ==" + savedContent);
// ìˆ˜ì • í›„ ë°”ë¡œ ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ìˆ˜ì • í¼ìœ¼ë¡œ ì´ë™
}

    // ì‚­ì œ ì²˜ë¦¬ (idë¥¼ @RequestParam ìœ¼ë¡œ ë°›ìŒ)
    @GetMapping("/content/delete")
    public String deleteContent(@RequestParam("id") Integer id) {
        contentService.delete(id);
        return "redirect:/content/list";
    }

    // ==================== GENRE HANDLING ========================
    //ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì • í˜ì´ì§€ {/content/{id}/genre)
    // ì¥ë¥´ ì„ íƒ/ìˆ˜ì • í¼
    @GetMapping("/content/{contentId}/genre")

    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);
        // ì„ íƒëœ ì¥ë¥´ (List<Genre>) â†’ List<String>ìœ¼ë¡œ ë³€í™˜
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì´ ë©”ì„œë“œê°€ Enum List ë°˜í™˜
        List<String> selectedGenreNames = selectedGenres.stream()
                .map(Enum::name)
                .toList(); // âš ï¸ íƒ€ì…: List<Genre>// âœ… í…œí”Œë¦¿ì—ì„œ ì²´í¬í•˜ê¸° ì¢‹ê²Œ
        model.addAttribute("selectedGenres", selectedGenres); // âš ï¸ íƒ€ì…: List<Genre>
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… ìˆ˜ì •: í•­ìƒ String ë¦¬ìŠ¤íŠ¸ë¡œ
        // ì¤‘ë³µëœ addAttribute ì œê±°

//        model.addAttribute("selectedGenres", genreService.getSelectedGenreNames(contentId));  // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í‘œì‹œ
//        model.addAttribute("genreTranslations", genreService.getGenreTranslations()); // í•œê¸€ ì´ë¦„ ë§µí•‘


        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );

        // í•´ë‹¹ contentIdë¡œ ContentDTO, ëª¨ë“  ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì¥ë¥´ ë²ˆì—­ ë“±ì„ ëª¨ë¸ì— ì¶”ê°€
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ì „ë‹¬
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… String ë¦¬ìŠ¤íŠ¸ë¡œ!
        model.addAttribute("genreTranslations", genreTranslations);


        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + allGenres);
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ HTML
    }
    //********************************************************************************//

    //********************************************************************************//
    // ì¥ë¥´ ì €ì¥
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {

        System.out.println(" post 44 contentId  ==" + contentId);
        System.out.println(" post 44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸ (null í—ˆìš©, ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ í¬í•¨)
        contentService.updateGenres(contentId, genres != null ? genres : List.of());

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream().map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)
        // âœ… redirect ì´í›„ model ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, addAttribute ìƒëµ

        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );

//        model.addAttribute("contentDTO", contentDTO);
//        model.addAttribute("contentId", contentId);
//        model.addAttribute("allGenres", allGenres);
//        model.addAttribute("selectedGenres", selectedGenreNames);// List<String>
//        model.addAttribute("genreTranslations", genreTranslations);

        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("selectedGenres", selectedGenreNames); // List<String>
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("genreTranslations", genreTranslations);

        return "redirect:/content/" + contentId + "/genre";

    }

}  cotroller ê³¼ html ìˆ˜ì •í• ê³³ê³¼ ìˆ˜ì •ì „ê³¼ í›„ ë¹„êµì¶œë ¥
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤! í˜„ì¬ ìš”ì²­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

ğŸ¯ "Controllerì™€ HTMLì—ì„œ ìˆ˜ì •í•  ë¶€ë¶„ê³¼ ìˆ˜ì • ì „í›„ ë¹„êµë¥¼ ì •ë¦¬í•´ë‹¬ë¼"
ì¦‰, Thymeleaf ë Œë”ë§ ì˜¤ë¥˜, ë°ì´í„° ì „ë‹¬ ë°©ì‹ ë¬¸ì œ, ì¤‘ë³µ model.addAttribute ì œê±°, ê·¸ë¦¬ê³  í…œí”Œë¦¿ ì½”ë“œ ì •ë¦¬ ë“±ì„ í¬í•¨í•œ ì •ë¦¬ì…ë‹ˆë‹¤.

âœ… ì „ì²´ ëª©ì 
ğŸ” POST â†’ ë¦¬ë””ë ‰ì…˜ â†’ GET íŒ¨í„´ ì •ë¦¬ (PRG)

ğŸ§¹ Model ì „ë‹¬ ì¤‘ë³µ ì œê±°

âœ… List<Genre> vs List<String> ë¶ˆì¼ì¹˜ í•´ê²°

ğŸ› ï¸ HTML ë‚´ genre.name() í˜¸ì¶œ ì˜¤ë¥˜ ìˆ˜ì •

1ï¸âƒ£ Controller â€“ ìˆ˜ì • ì „ vs í›„
ğŸ”§ ë¬¸ì œ ì½”ë“œ: @GetMapping("/content/{contentId}/genre")
(ì¤‘ë³µëœ model, í˜¼ë€ì„ ì£¼ëŠ” ë°ì´í„° íƒ€ì…)

âœ–ï¸ ìˆ˜ì • ì „
model.addAttribute("selectedGenres", selectedGenres); // List<Genre>
model.addAttribute("selectedGenres", selectedGenreNames); // List<String> (ë®ì–´ì”€)
âœ… ìˆ˜ì • í›„
// ì¤‘ë³µ ì œê±°, String íƒ€ì…ë§Œ ì‚¬ìš©
List<String> selectedGenreNames = selectedGenres.stream()
.map(Enum::name)
.toList();
model.addAttribute("selectedGenres", selectedGenreNames); // âœ… í…œí”Œë¦¿ì—ì„œëŠ” name ê¸°ë°˜ìœ¼ë¡œ ì²´í¬
ğŸ”§ ë¬¸ì œ ì½”ë“œ: @PostMapping("/content/{contentId}/genre")
âœ–ï¸ ìˆ˜ì • ì „
model.addAttribute("contentDTO", contentDTO);
model.addAttribute("selectedGenres", selectedGenreNames);
model.addAttribute("allGenres", Genre.values());
model.addAttribute("genreTranslations", genreTranslations);
return "redirect:/content/" + contentId + "/genre";
âŒ redirect: í›„ model.addAttribute()ëŠ” ë¬´ì˜ë¯¸í•¨

âŒ ê²°êµ­ GET ìš”ì²­ìœ¼ë¡œ ì´ë™ë˜ë¯€ë¡œ, model ë°ì´í„°ëŠ” ì‚¬ë¼ì§

âœ… ìˆ˜ì • í›„
// ğŸ”¥ ë¦¬ë””ë ‰ì…˜ì—ì„œëŠ” model ì‚¬ìš© ì•ˆí•¨ â€” ì œê±°
return "redirect:/content/" + contentId + "/genre";
2ï¸âƒ£ HTML (Thymeleaf) ìˆ˜ì •
ğŸ”§ ë¬¸ì œ 1: ì„ íƒëœ ì¥ë¥´ í‘œì‹œ íŒŒíŠ¸
âœ–ï¸ ìˆ˜ì • ì „
<ul>
    <th:block th:each="genre : ${selectedGenres}">
        <li th:text="${genreTranslations[genre.name()]}"></li>
    </th:block>
</ul>
âŒ selectedGenresê°€ List<String>ì´ë©´ genre.name() í˜¸ì¶œ ë¶ˆê°€ â†’ ì˜¤ë¥˜ ë°œìƒ

âœ… ìˆ˜ì • í›„
<ul>
    <th:block th:each="genre : ${selectedGenres}">
        <li th:text="${genreTranslations[genre]}"></li>
    </th:block>
</ul>
ğŸ”§ ë¬¸ì œ 2: ì¥ë¥´ ì²´í¬ë°•ìŠ¤ íŒŒíŠ¸
âœ… ê¸°ì¡´ êµ¬ì¡° (ì¢‹ìŒ)
<div class="form-check" th:each="genre : ${allGenres}">
    <input class="form-check-input" type="checkbox" name="genres"
           th:id="${'genre-' + genre.name()}"
           th:value="${genre.name()}"
           th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}" />

    <label class="form-check-label"
           th:for="${'genre-' + genre.name()}"
           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
</div>
âœ… genreëŠ” Enum â†’ .name() ì‚¬ìš© ì ì ˆ

âœ… selectedGenresëŠ” List<String> â†’ contains(genre.name()) ê°€ëŠ¥

âœ… genreTranslationsë„ Map<String, String>ì´ë¼ keyë¡œ ì‚¬ìš© ê°€ëŠ¥

ğŸ”§ ë³„ë„ ìˆ˜ì • í•„ìš” ì—†ìŒ

âœ… ìˆ˜ì • ì „ vs í›„ ìš”ì•½ ë¹„êµ
ìœ„ì¹˜	ìˆ˜ì • ì „	ìˆ˜ì • í›„
Controller model.addAttribute	selectedGenres ë‘ ë²ˆ ì„¤ì • (List<Genre> & List<String>)	List<String> í•˜ë‚˜ë¡œ í†µì¼
POST í›„ redirectì—ì„œ model.addAttribute()	ì‚¬ìš©ë¨ (ë¶ˆí•„ìš”)	ì œê±°
HTML ì¥ë¥´ ì¶œë ¥ (genre.name())	genre.name() ì‚¬ìš© (List<String>ì¼ ë•Œ ì˜¤ë¥˜)	genreë§Œ ì‚¬ìš©
HTML ì¥ë¥´ ì²´í¬ë°•ìŠ¤	ë¬¸ì œ ì—†ìŒ	ìœ ì§€
âœ¨ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸
í•­ëª©	ìƒíƒœ
âœ… Controllerì—ì„œ ì¤‘ë³µëœ ëª¨ë¸ ì†ì„± ì œê±°	ì™„ë£Œ
âœ… redirect ì´í›„ model.addAttribute ì œê±°	ì™„ë£Œ
âœ… selectedGenres íƒ€ì… ì¼ê´€ì„± ìœ ì§€ (List<String>)	ì™„ë£Œ
âœ… Thymeleaf .name() ë¬¸ì œ ìˆ˜ì •	ì™„ë£Œ
âœ… ì¥ë¥´ ì²´í¬ë°•ìŠ¤ì™€ ì¶œë ¥ ì¼ê´€ì„± ìœ ì§€	ì™„ë£Œ
í•„ìš”í•˜ë‹¤ë©´ ì „ì²´ ì½”ë“œ ì •ë¦¬ëœ ë²„ì „ë„ ì œê³µí•  ìˆ˜ ìˆì–´ìš”.
ì›í•˜ì‹œë©´ ë§ì”€ ì£¼ì„¸ìš”!

ë‚˜ì˜ ë§:
ì›ì¸: org.hibernate.exception.DataException: ëª…ë ¹ë¬¸ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. [ì—´ "('ACTION', 'ADVENTURE', 'COMEDY', 'DRAMA', 'FANTASY', 'HORROR', 'KPOP', 'NATURAL_SCIENCE', 'ROMANCE', 'THRILLER')"ì— í—ˆìš©ë˜ì§€ ì•ŠëŠ” ê°’: "ANIMATION"; SQL ëª…ë ¹ë¬¸:
content_genre_entity(content_id,genre,id)ì— ê°’ì„ ì‚½ì…í•©ë‹ˆë‹¤(?,?,default) [22030-232]] [content_genre_entity(content_id,genre,id)ì— ê°’ì„ ì‚½ì…í•©ë‹ˆë‹¤(?,?,default)]
org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:55)ì—ì„œ ìˆ˜ì •í•  package com.example.itview_spring.Controller.Content;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.PageInfoDTO;
import com.example.itview_spring.Service.ContentService;
import com.example.itview_spring.Util.PageInfo;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.web.servlet.error.ErrorController;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.springframework.data.jpa.domain.AbstractPersistable_.id;

@Controller
@RequiredArgsConstructor
public class ContentController {
private final ContentService contentService;
private final PageInfo pageInfo;

    // ==================== ERROR PAGE HANDLER ====================
    //    500 ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ ì»¤ìŠ¤í…€ ì˜¤ë¥˜ í˜ì´ì§€ ì¶”ê°€ ê°€ëŠ¥ (ì„ íƒ ì‚¬í•­)-----------------------------------
//    @Controller
//    public class CustomErrorController implements ErrorController {
//        @RequestMapping("/error")
//        public String handleError() {
//            return "error/customError"; // templates/error/customError.html
//        }
//    }
// ==================== CONTENT CRUD ==========================
// ë“±ë¡ í¼ ì´ë™
@GetMapping("/content/register")
public String newContent() {

        return "content/register";
    }

    // ë“±ë¡ ì²˜ë¦¬ í›„ â†’ ì¥ë¥´ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™
    @PostMapping("/content/register")
    public String newContent(ContentCreateDTO contentDTO) {
        //ë°ì´í„° ì €ì¥ì²˜ë¦¬ (Service -> Controller
        ContentCreateDTO savedContent = contentService.create(contentDTO); // ì €ì¥ í›„

        System.out.println(" 00 savedContent ==" + savedContent);
        return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ë“±ë¡ í¼ìœ¼ë¡œ ì´ë™
        //   return "redirect:/content/list";  // ë¦¬ìŠ¤íŠ¸ ì´ë™ ì˜µì…˜ (í˜„ì¬ëŠ” ì¥ë¥´ ì„ íƒ ìš°ì„ )
    }


    //localhost:8080/content/list í™•ì¸í•¨(@GetMppping
    //ì „ì²´ê°•ì˜ ì¡°íšŒí›„ (list.html)ë¡œì´ë™

    /**
     * ì „ì²´ì¡°íšŒ
     *
     * @param pageable ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸ /í˜ì´ì§• ì •ë³´ (ê¸°ë³¸ í˜ì´ì§€ 1)
     * @param model    ê²°ì¢Œ ì „ë‹¬ /ë·°ì— ì „ë‹¬í•  ëª¨ë¸
     * @return í˜ì´ì§€ ì´ë™ /ë·°
     */
    @GetMapping("/content/list")
    // ì „ì²´ ëª©ë¡ ì¡°íšŒ
    public String listContent(@PageableDefault(page = 1) Pageable pageable, Model model) {
        //ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ
        //keyword  ì¶”ê°€ ****
        Page<ContentCreateDTO> contentDTOS = contentService.getAllContents(pageable);
        model.addAttribute("contentDTOS", contentDTOS);
        //    System.out.println("contentDTO.            ==", contentDTOS);

        // í˜ì´ì§€ ì •ë³´ ìƒì„± í›„ ëª¨ë¸ì— ì¶”ê°€
        PageInfoDTO pageInfoDTO = pageInfo.getPageInfo(contentDTOS);
        model.addAttribute("pageInfoDTO", pageInfoDTO);
//        model.addAttribute("contentDTOS", contentDTOS);
//        model.addAttribute("pageInfoDTO", pageInfo.getPageInfo(contentDTOS));
return "content/list";
}

    // ìƒì„¸ ë³´ê¸° (id íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ, @PathVariable ëŒ€ì‹  @RequestParam í˜•ì‹)
// @GetMapping("/content/{id:\\d+}")
//    @GetMapping("/content/detail")
//    @GetMapping("/content/{id}/detail")
//    public String detailContent(@PathVariable("id") Integer id, Model model) {
@GetMapping("/content/detail")
public String detailContent(Integer id, Model model) {
// URL ê²½ë¡œ ë³€ìˆ˜ì¸ {id}ë¥¼ ë°›ìœ¼ë ¤ë©´ @PathVariableì„ ì¨ì•¼ í•©ë‹ˆë‹¤.
ContentCreateDTO contentDTO = contentService.read(id);
model.addAttribute("contentDTO", contentDTO);
System.out.println("deteil id         ===>" + id);
System.out.println("deteil contentDTO ===>" + contentDTO);
return "content/detail"; // ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸ í•„ìš”
}

//
//    @GetMapping("/content/{id:\\d+}")
//    public String detail(@RequestParam("id") Integer id, Model model) {
//        ContentDetailDTO detailDTO = contentService.getContentDetail(id);
//        model.addAttribute("contentDTO", detailDTO.getContentInfo()); // ContentResponseDTO
//        model.addAttribute("gallery", detailDTO.getGallery());
//        model.addAttribute("videos", detailDTO.getVideos());
//        model.addAttribute("externalServices", detailDTO.getExternalServices());
//        return "content/detail";
//    }

    // ìˆ˜ì • í¼ ì´ë™
    @GetMapping("/content/{id}/update")
    public String updateContent(@PathVariable("id") Integer id, Model model) {
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);
        return "content/update";
    }

    // ìˆ˜ì • ì²˜ë¦¬ (â†’ ì¥ë¥´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸)
    @PostMapping("/content/{id}/update")
    public String updateContentProc(@PathVariable("id") Integer id, ContentCreateDTO contentDTO) {
//        contentService.update(id, contentDTO);
//        return "redirect:/content/list";
// Serviceì—ì„œ ìˆ˜ì • ì²˜ë¦¬ í›„ ì €ì¥ëœ DTO ë°˜í™˜ ë°›ìŒ
ContentCreateDTO savedContent = contentService.update(id, contentDTO);
//        System.out.println(" 22 savedContent ==" + savedContent);
// ìˆ˜ì • í›„ ë°”ë¡œ ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ìˆ˜ì • í¼ìœ¼ë¡œ ì´ë™
}

    // ì‚­ì œ ì²˜ë¦¬ (idë¥¼ @RequestParam ìœ¼ë¡œ ë°›ìŒ)
    @GetMapping("/content/delete")
    public String deleteContent(@RequestParam("id") Integer id) {
        contentService.delete(id);
        return "redirect:/content/list";
    }

    // ==================== GENRE HANDLING ========================
    //ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì • í˜ì´ì§€ {/content/{id}/genre)
    // ì¥ë¥´ ì„ íƒ/ìˆ˜ì • í¼
    @GetMapping("/content/{contentId}/genre")

    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);
        // ì„ íƒëœ ì¥ë¥´ (List<Genre>) â†’ List<String>ìœ¼ë¡œ ë³€í™˜
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì´ ë©”ì„œë“œê°€ Enum List ë°˜í™˜
        List<String> selectedGenreNames = selectedGenres.stream()
                .map(Enum::name)
                .toList(); // âš ï¸ íƒ€ì…: List<Genre>// âœ… í…œí”Œë¦¿ì—ì„œ ì²´í¬í•˜ê¸° ì¢‹ê²Œ
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… ìˆ˜ì •: í•­ìƒ String ë¦¬ìŠ¤íŠ¸ë¡œ
        // ì¤‘ë³µëœ addAttribute ì œê±°

//        model.addAttribute("selectedGenres", genreService.getSelectedGenreNames(contentId));  // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í‘œì‹œ
//        model.addAttribute("genreTranslations", genreService.getGenreTranslations()); // í•œê¸€ ì´ë¦„ ë§µí•‘


        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );

        // í•´ë‹¹ contentIdë¡œ ContentDTO, ëª¨ë“  ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì¥ë¥´ ë²ˆì—­ ë“±ì„ ëª¨ë¸ì— ì¶”ê°€
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ì „ë‹¬
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… String ë¦¬ìŠ¤íŠ¸ë¡œ!
        model.addAttribute("genreTranslations", genreTranslations);


        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + allGenres);
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ HTML
    }
    //********************************************************************************//

    //********************************************************************************//
    // ì¥ë¥´ ì €ì¥
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {

        System.out.println(" post 44 contentId  ==" + contentId);
        System.out.println(" post 44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸ (null í—ˆìš©, ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ í¬í•¨)
        contentService.updateGenres(contentId, genres != null ? genres : List.of());

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream()
                .map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)
        // âœ… redirect ì´í›„ model ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, addAttribute ìƒëµ

        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );
       // redirect: í›„ model.addAttribute()ëŠ” ë¬´ì˜ë¯¸í•¨


        return "redirect:/content/" + contentId + "/genre";

    }

}package com.example.itview_spring.Controller.Content;

import com.example.itview_spring.Constant.Genre;
import com.example.itview_spring.DTO.ContentCreateDTO;
import com.example.itview_spring.DTO.ContentDetailDTO;
import com.example.itview_spring.DTO.PageInfoDTO;
import com.example.itview_spring.Service.ContentService;
import com.example.itview_spring.Util.PageInfo;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.web.servlet.error.ErrorController;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.web.PageableDefault;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.springframework.data.jpa.domain.AbstractPersistable_.id;

@Controller
@RequiredArgsConstructor
public class ContentController {
private final ContentService contentService;
private final PageInfo pageInfo;

    // ==================== ERROR PAGE HANDLER ====================
    //    500 ì—ëŸ¬ê°€ ë‚˜ë”ë¼ë„ ì»¤ìŠ¤í…€ ì˜¤ë¥˜ í˜ì´ì§€ ì¶”ê°€ ê°€ëŠ¥ (ì„ íƒ ì‚¬í•­)-----------------------------------
//    @Controller
//    public class CustomErrorController implements ErrorController {
//        @RequestMapping("/error")
//        public String handleError() {
//            return "error/customError"; // templates/error/customError.html
//        }
//    }
// ==================== CONTENT CRUD ==========================
// ë“±ë¡ í¼ ì´ë™
@GetMapping("/content/register")
public String newContent() {

        return "content/register";
    }

    // ë“±ë¡ ì²˜ë¦¬ í›„ â†’ ì¥ë¥´ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™
    @PostMapping("/content/register")
    public String newContent(ContentCreateDTO contentDTO) {
        //ë°ì´í„° ì €ì¥ì²˜ë¦¬ (Service -> Controller
        ContentCreateDTO savedContent = contentService.create(contentDTO); // ì €ì¥ í›„

        System.out.println(" 00 savedContent ==" + savedContent);
        return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ë“±ë¡ í¼ìœ¼ë¡œ ì´ë™
        //   return "redirect:/content/list";  // ë¦¬ìŠ¤íŠ¸ ì´ë™ ì˜µì…˜ (í˜„ì¬ëŠ” ì¥ë¥´ ì„ íƒ ìš°ì„ )
    }


    //localhost:8080/content/list í™•ì¸í•¨(@GetMppping
    //ì „ì²´ê°•ì˜ ì¡°íšŒí›„ (list.html)ë¡œì´ë™

    /**
     * ì „ì²´ì¡°íšŒ
     *
     * @param pageable ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸ /í˜ì´ì§• ì •ë³´ (ê¸°ë³¸ í˜ì´ì§€ 1)
     * @param model    ê²°ì¢Œ ì „ë‹¬ /ë·°ì— ì „ë‹¬í•  ëª¨ë¸
     * @return í˜ì´ì§€ ì´ë™ /ë·°
     */
    @GetMapping("/content/list")
    // ì „ì²´ ëª©ë¡ ì¡°íšŒ
    public String listContent(@PageableDefault(page = 1) Pageable pageable, Model model) {
        //ëª¨ë“  ë°ì´í„°ë¥¼ ì¡°íšŒ
        //keyword  ì¶”ê°€ ****
        Page<ContentCreateDTO> contentDTOS = contentService.getAllContents(pageable);
        model.addAttribute("contentDTOS", contentDTOS);
        //    System.out.println("contentDTO.            ==", contentDTOS);

        // í˜ì´ì§€ ì •ë³´ ìƒì„± í›„ ëª¨ë¸ì— ì¶”ê°€
        PageInfoDTO pageInfoDTO = pageInfo.getPageInfo(contentDTOS);
        model.addAttribute("pageInfoDTO", pageInfoDTO);
//        model.addAttribute("contentDTOS", contentDTOS);
//        model.addAttribute("pageInfoDTO", pageInfo.getPageInfo(contentDTOS));
return "content/list";
}

    // ìƒì„¸ ë³´ê¸° (id íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ, @PathVariable ëŒ€ì‹  @RequestParam í˜•ì‹)
// @GetMapping("/content/{id:\\d+}")
//    @GetMapping("/content/detail")
//    @GetMapping("/content/{id}/detail")
//    public String detailContent(@PathVariable("id") Integer id, Model model) {
@GetMapping("/content/detail")
public String detailContent(Integer id, Model model) {
// URL ê²½ë¡œ ë³€ìˆ˜ì¸ {id}ë¥¼ ë°›ìœ¼ë ¤ë©´ @PathVariableì„ ì¨ì•¼ í•©ë‹ˆë‹¤.
ContentCreateDTO contentDTO = contentService.read(id);
model.addAttribute("contentDTO", contentDTO);
System.out.println("deteil id         ===>" + id);
System.out.println("deteil contentDTO ===>" + contentDTO);
return "content/detail"; // ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸ í•„ìš”
}

//
//    @GetMapping("/content/{id:\\d+}")
//    public String detail(@RequestParam("id") Integer id, Model model) {
//        ContentDetailDTO detailDTO = contentService.getContentDetail(id);
//        model.addAttribute("contentDTO", detailDTO.getContentInfo()); // ContentResponseDTO
//        model.addAttribute("gallery", detailDTO.getGallery());
//        model.addAttribute("videos", detailDTO.getVideos());
//        model.addAttribute("externalServices", detailDTO.getExternalServices());
//        return "content/detail";
//    }

    // ìˆ˜ì • í¼ ì´ë™
    @GetMapping("/content/{id}/update")
    public String updateContent(@PathVariable("id") Integer id, Model model) {
        ContentCreateDTO contentDTO = contentService.read(id);
        model.addAttribute("contentDTO", contentDTO);
        return "content/update";
    }

    // ìˆ˜ì • ì²˜ë¦¬ (â†’ ì¥ë¥´ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸)
    @PostMapping("/content/{id}/update")
    public String updateContentProc(@PathVariable("id") Integer id, ContentCreateDTO contentDTO) {
//        contentService.update(id, contentDTO);
//        return "redirect:/content/list";
// Serviceì—ì„œ ìˆ˜ì • ì²˜ë¦¬ í›„ ì €ì¥ëœ DTO ë°˜í™˜ ë°›ìŒ
ContentCreateDTO savedContent = contentService.update(id, contentDTO);
//        System.out.println(" 22 savedContent ==" + savedContent);
// ìˆ˜ì • í›„ ë°”ë¡œ ì¥ë¥´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
return "redirect:/content/" + savedContent.getId() + "/genre";     // ì¥ë¥´ ìˆ˜ì • í¼ìœ¼ë¡œ ì´ë™
}

    // ì‚­ì œ ì²˜ë¦¬ (idë¥¼ @RequestParam ìœ¼ë¡œ ë°›ìŒ)
    @GetMapping("/content/delete")
    public String deleteContent(@RequestParam("id") Integer id) {
        contentService.delete(id);
        return "redirect:/content/list";
    }

    // ==================== GENRE HANDLING ========================
    //ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì • í˜ì´ì§€ {/content/{id}/genre)
    // ì¥ë¥´ ì„ íƒ/ìˆ˜ì • í¼
    @GetMapping("/content/{contentId}/genre")

    public String showGenreForm(@PathVariable Integer contentId, Model model) {
        ContentCreateDTO contentDTO = contentService.read(contentId);
        // ì„ íƒëœ ì¥ë¥´ (List<Genre>) â†’ List<String>ìœ¼ë¡œ ë³€í™˜
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId); // ì´ ë©”ì„œë“œê°€ Enum List ë°˜í™˜
        List<String> selectedGenreNames = selectedGenres.stream()
                .map(Enum::name)
                .toList(); // âš ï¸ íƒ€ì…: List<Genre>// âœ… í…œí”Œë¦¿ì—ì„œ ì²´í¬í•˜ê¸° ì¢‹ê²Œ
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… ìˆ˜ì •: í•­ìƒ String ë¦¬ìŠ¤íŠ¸ë¡œ
        // ì¤‘ë³µëœ addAttribute ì œê±°

//        model.addAttribute("selectedGenres", genreService.getSelectedGenreNames(contentId));  // ì´ë¯¸ ì„ íƒëœ ê²½ìš° í‘œì‹œ
//        model.addAttribute("genreTranslations", genreService.getGenreTranslations()); // í•œê¸€ ì´ë¦„ ë§µí•‘


        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );

        // í•´ë‹¹ contentIdë¡œ ContentDTO, ëª¨ë“  ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì„ íƒëœ ì¥ë¥´ ë¦¬ìŠ¤íŠ¸, ì¥ë¥´ ë²ˆì—­ ë“±ì„ ëª¨ë¸ì— ì¶”ê°€
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ì „ë‹¬
        model.addAttribute("contentDTO", contentDTO);
        model.addAttribute("contentId", contentId);
        model.addAttribute("allGenres", Genre.values());
        model.addAttribute("selectedGenres", selectedGenreNames); // âœ… String ë¦¬ìŠ¤íŠ¸ë¡œ!
        model.addAttribute("genreTranslations", genreTranslations);


        System.out.println(" get33 contentDTO ==" + contentDTO);
        System.out.println(" get33 contentId ==" + contentId);
        System.out.println(" get33 allGenres ==" + allGenres);
        System.out.println(" get33 selectedGenres ==" + selectedGenres);
        System.out.println(" get33 genreTranslations ==" + genreTranslations);
        System.out.println(" ---------------------");

        return "content/genreForm"; // ì¥ë¥´ ì„ íƒ HTML
    }
    //********************************************************************************//

    //********************************************************************************//
    // ì¥ë¥´ ì €ì¥
    @PostMapping("/content/{contentId}/genre")
    public String submitGenres(@PathVariable("contentId") Integer contentId,
                               @RequestParam(value = "genres", required = false) List<Genre> genres,
                               Model model) {

        System.out.println(" post 44 contentId  ==" + contentId);
        System.out.println(" post 44 genress    ==" + genres);
        System.out.println(" ---------------------");
//        contentService.updateGenres(contentId, genres != null ? genres :
//                List.of());

        // ì¥ë¥´ ì—…ë°ì´íŠ¸ (null í—ˆìš©, ë¹ˆ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ í¬í•¨)
        contentService.updateGenres(contentId, genres != null ? genres : List.of());

        // ì—…ë°ì´íŠ¸ëœ ë‚´ìš© í™”ë©´ì— ì „ë‹¬
        ContentCreateDTO contentDTO = contentService.read(contentId);
        List<Genre> selectedGenres = contentService.getGenresByContentId(contentId);
        List<String> selectedGenreNames = selectedGenres.stream()
                .map(Enum::name).collect(Collectors.toList());
        // ëª¨ë¸ì— í•„ìš”í•œ ë°ì´í„° ë‹¤ì‹œ ë‹´ê¸° (âœ… ì¤‘ìš”)
        // âœ… redirect ì´í›„ model ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, addAttribute ìƒëµ

        Genre[] allGenres = Genre.values();
        // ì¥ë¥´ ë²ˆì—­ ë§µ (10ê°œ ì´ˆê³¼ì´ë¯€ë¡œ Map.ofEntries ì‚¬ìš©)
        Map<String, String> genreTranslations = Map.ofEntries(
                Map.entry("ACTION", "ì•¡ì…˜"),
                Map.entry("DRAMA", "ë“œë¼ë§ˆ"),
                Map.entry("ROMANCE", "ë¡œë§¨ìŠ¤"),
                Map.entry("HORROR", "í˜¸ëŸ¬"),
                Map.entry("THRILLER", "ìŠ¤ë¦´ëŸ¬"),
                Map.entry("COMEDY", "ì½”ë¯¸ë””"),
                Map.entry("FANTASY", "íŒíƒ€ì§€"),
                Map.entry("ADVENTURE", "ì–´ë“œë²¤ì²˜"),
                Map.entry("NATURAL_SCIENCE", "ìì—°ê³¼í•™"),
                Map.entry("KPOP", "K-POP"),
                Map.entry("ANIMATION", "ì• ë‹ˆë©”ì´ì…˜"),
                Map.entry("SPORTS", "ìŠ¤í¬ì¸ "),
                Map.entry("MYSTERY", "ë¯¸ìŠ¤í„°ë¦¬"),
                Map.entry("DOCUMENTARY", "ë‹¤íë©˜í„°ë¦¬"),
                Map.entry("SF", "SF"),
                Map.entry("MUSIC", "ìŒì•…"),
                Map.entry("FAMILY", "ê°€ì¡±"),
                Map.entry("CONCERT", "ê³µì—°ì‹¤í™©"),
                Map.entry("MUSICAL", "ë®¤ì§€ì»¬"),
                Map.entry("BIOPIC", "ì „ê¸°"),
                Map.entry("HISTORY", "ì—­ì‚¬"),
                Map.entry("CRIME", "ë²”ì£„"),
                Map.entry("KIDS", "í‚¤ì¦ˆ"),
                Map.entry("VARIETY", "ì˜ˆëŠ¥"),
                Map.entry("SITCOM", "ì‹œíŠ¸ì½¤"),
                Map.entry("PERIOD", "ì‹œëŒ€ê·¹"),
                Map.entry("ROMANTIC_COMEDY", "ë¡œë§¨í‹± ì½”ë¯¸ë””"),
                Map.entry("BL", "BL"),
                Map.entry("TEENAGER", "í‹´ì—ì´ì €"),
                Map.entry("DISASTER", "ì¬ë‚œ"),
                Map.entry("COMICS", "ë§Œí™”"),
                Map.entry("HUMANITIES", "ì¸ë¬¸í•™"),
                Map.entry("ECONOMICS", "ê²½ì œì„œ"),
                Map.entry("INVESTMENT", "íˆ¬ìì„œ"),
                Map.entry("NOVEL", "ì†Œì„¤"),
                Map.entry("ESSAY", "ì—ì„¸ì´"),
                Map.entry("SELF_HELP", "ìê¸°ê³„ë°œ"),
                Map.entry("WAR", "ì „ìŸ"),
                Map.entry("PLAY", "í¬ê³¡"),
                Map.entry("POETRY", "ì‹œ"),
                Map.entry("SLICE_OF_LIFE", "ì¼ìƒ"),
                Map.entry("HIP_HOP", "í™í•©"),
                Map.entry("POP", "íŒ"),
                Map.entry("MOVIE_SOUNDTRACK", "ì˜í™”ìŒì•…"),
                Map.entry("TV_SOUNDTRACK", "ë“œë¼ë§ˆìŒì•…"),
                Map.entry("BALLAD", "ë°œë¼ë“œ"),
                Map.entry("DANCE", "ëŒ„ìŠ¤"),
                Map.entry("ROCK", "ë¡"),
                Map.entry("CLASSICAL", "í´ë˜ì‹"),
                Map.entry("INDIE", "ì¸ë””"),
                Map.entry("ELECTRONICA", "ì¼ë ‰íŠ¸ë¡œë‹ˆì¹´"),
                Map.entry("JPOP", "JPOP"),
                Map.entry("RNB", "ì•Œì•¤ë¹„"),
                Map.entry("TROT", "íŠ¸ë¡œíŠ¸")
        );
       // redirect: í›„ model.addAttribute()ëŠ” ë¬´ì˜ë¯¸í•¨


        return "redirect:/content/" + contentId + "/genre";

    }

}<!DOCTYPE html>
<html lang="kr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/mainlayout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<main layout:fragment="content">
    <!--    <h1>Welcome to the Dashboard</h1>-->
    <!--    <p>This is your main content area.</p>-->

    <div class="container mt-5">
        <h2>ì½˜í…ì¸  ì¥ë¥´ ë“±ë¡/ìˆ˜ì •</h2>

        <!--        <form th:action="@{|/content/${contentId}/genre|}" method="post">-->
        <form th:action="@{/content/{contentId}/genre(contentId=${contentDTO.id})}" method="post">
            <!-- âœ… CSRF í† í° ì¶”ê°€ (Spring Security ì‚¬ìš©í•˜ëŠ” ê²½ìš° í•„ìˆ˜) -->
            <!--            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
            <input id="id" th:value="${contentDTO.id}" value="post" hidden>
            <!--            <input type="hidden" name="_method" value="post" />-->

            <div class="mb-3">
                <label class="form-label">ì¥ë¥´ ì„ íƒ</label>
                <!-- âœ… ê° ì¥ë¥´ ì²´í¬ë°•ìŠ¤ ë°˜ë³µ ì¶œë ¥ -->
                <!--                <div>-->
                <!--                    <ul>-->
                <!--                        &lt;!&ndash; ì¥ë¥´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ &ndash;&gt;-->
                <!--                        <c:forEach var="genre" items="${allGenres}">-->
                <!--                            <li>-->
                <!--                                <input type="checkbox" id="genre_${genre}" name="genres" value="${genre}"-->
                <!--                                <c:if test="${selectedGenres.contains(genre.name)}">checked</c:if> />-->
                <!--                                <label for="genre_${genre}">${genreTranslations[genre]}</label>-->
                <!--                            </li>-->
                <!--                        </c:forEach>-->
                <!--                    </ul>-->
                <!--                </div>-->
                <div class="form-check" th:each="genre : ${allGenres}">
                    <input class="form-check-input" type="checkbox" name="genres"
                           th:id="${'genre-' + genre.name()}"
                           th:value="${genre.name()}"
                           th:checked="${selectedGenres != null and selectedGenres.contains(genre.name())}"/>

                    <label class="form-check-label"
                           th:for="${'genre-' + genre.name()}"
                           th:text="${genreTranslations[genre.name()]}">ì¥ë¥´ëª…</label>
                </div>


                <!--                       th:text="${genre.genreName}">ì¥ë¥´ëª…</label>-->

                <!-- âœ… í•œê¸€ëª… ë³€í™˜ì€ ì„ íƒì ìœ¼ë¡œ ENUMì— ë©”ì„œë“œ ì¶”ê°€ -->
                <!--                    <label class="form-check-label"-->
                <!--                           th:for="${'genre-' + genre.name()}"-->
                <!--                              th:text="${genre.genreName}">-->
                <!--                           th:text="${#strings.equalsIgnoreCase(genre.name(), 'ACTION') ? 'ì•¡ì…˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ADVENTURE') ? 'ì–´ë“œë²¤ì²˜' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'COMEDY') ? 'ì½”ë¯¸ë””' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'DRAMA') ? 'ë“œë¼ë§ˆ' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'THRILLER') ? 'ìŠ¤ë¦´ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'HORROR') ? 'í˜¸ëŸ¬' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'FANTASY') ? 'íŒíƒ€ì§€' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'ROMANCE') ? 'ë¡œë§¨ìŠ¤' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'NATURAL_SCIENCE') ? 'ìì—°ê³¼í•™' :-->
                <!--                                      #strings.equalsIgnoreCase(genre.name(), 'KPOP') ? 'K-POP' :-->
                <!--                                      genre.name())))))))))">-->
                <!--                            <span th:text="${genre.genreName}">ì¥ë¥´</span>-->
                <!--                            ì¥ë¥´ëª…-->
                <!--                    </label>-->

            </div>

            <button type="submit" class="btn btn-primary">ì €ì¥</button>
            <a th:href="@{/content/list}" class="btn btn-secondary">ì·¨ì†Œ</a>
        </form>
        <!-- ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° -->
        <h3>ì„ íƒí•œ ì¥ë¥´ </h3>
        <ul>
            <th:block th:each="genre : ${selectedGenres}">
<!--               selectedGenresê°€ List<String>ì´ë©´ genre.name() í˜¸ì¶œ ë¶ˆê°€ â†’ ì˜¤ë¥˜ ë°œìƒ-->
<!--                <li th:text="${genreTranslations[genre.name()]}"></li>-->
                <li th:text="${genreTranslations[genre]}"></li>
            </th:block>
        </ul>

<!--        &lt;!&ndash; ìˆ˜ì •ëœ í›„ ë°ì´í„° ë³´ê¸° &ndash;&gt;-->
<!--        <h3>ì„ íƒëœ ì¥ë¥´</h3>-->
<!--        <ul>-->
<!--            <c:forEach var="genre" items="${selectedGenres}">-->
<!--                <li>${genre}</li>-->
<!--            </c:forEach>-->
<!--        </ul>-->
<!--        -->

    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</main>
</body>
</html>  controller service html    ìˆ˜ì •í• ê³³ ì „ê³¼ í›„ ë¹„êµ ìë£Œ í™•ì¸í•´ì¤˜ 


ChatGPTì˜ ë§:
ì œì¶œí•œ ë©”ì‹œì§€ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ìˆ˜ì •í•´ ë‹¤ì‹œ ì œì¶œí•˜ì„¸ìš”.


ë‹¤ì‹œ ì‹œë„



ì²¨ë¶€

ê²€ìƒ‰

í•™ìŠµí•˜ê¸°

ìŒì„±
ì„ íƒëœ íŒŒì¼ ì—†ìŒì„ íƒëœ íŒŒì¼ ì—†ìŒ
ChatGPTëŠ” ì‹¤ìˆ˜ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¤‘ìš”í•œ ì •ë³´ëŠ” ì¬ì°¨ í™•ì¸í•˜ì„¸ìš”.
